<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>games101 HomeWork3 | zhywyt's blog</title><noscript>å¼€å¯JavaScriptæ‰èƒ½è®¿é—®æœ¬ç«™å“¦~</noscript><link rel="icon" href="/solitude/img/pwa/favicon.png"><!-- index.css--><link rel="stylesheet" href="/solitude/css/index.css?v=3.0.15"><!-- inject head--><link rel="canonical" href="https://hexothemedemo.github.io/solitude/posts/55574/index.html"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><!-- aplayer--><!-- swiper--><!-- fancybox ui--><!-- katex--><!-- Open Graph--><meta name="description" content="Games101 HomeWork3å¯¼èˆªå¯¼èˆª ä½œä¸šè¦æ±‚ç¬¬ä¸‰æ¬¡ä½œä¸šæ‰æ˜¯çœŸæ­£ä¸Šå¼ºåº¦çš„ä½œä¸šï¼Œä½œä¸šè¦æ±‚å’Œè´¨é‡éƒ½ç‰¹åˆ«é«˜ï¼Œå…ˆæ¥çœ‹çœ‹æ‰€æœ‰çš„è¦æ±‚ï¼š 1 . ä¿®æ”¹å‡½æ•°rasterize_triangle(const Triangle&amp;amp; t) in rasterizer.cpp: åœ¨æ­¤å¤„å®ç°ä¸ä½œä¸š 2 ç±»"><!-- pwa--><meta name="apple-mobile-web-app-capable" content="zhywyt's blog"><meta name="theme-color" content="var(--efu-main)"><meta name="apple-mobile-web-app-status-bar-style" content="var(--efu-main)"><link rel="bookmark" href="/solitude/img/pwa/favicon.png"><link rel="apple-touch-icon" href="/solitude/img/pwa/favicon.png" sizes="180x180"><script>console.log(' %c Solitude %c ' + '3.0.15' + ' %c https://github.com/everfu/hexo-theme-solitude',
    'background:#35495e ; padding: 1px; border-radius: 3px 0 0 3px;  color: #fff',
    'background:#ff9a9a ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff',
    'background:unset ; padding: 1px; border-radius: 0 3px 3px 0;  color: #fff')
</script><script>(()=>{
        const saveToLocal = {
            set: function setWithExpiry(key, value, ttl) {
                if (ttl === 0)
                    return
                const now = new Date()
                const expiryDay = ttl * 86400000
                const item = {
                    value: value,
                    expiry: now.getTime() + expiryDay
                }
                localStorage.setItem(key, JSON.stringify(item))
            },
            get: function getWithExpiry(key) {
                const itemStr = localStorage.getItem(key)

                if (!itemStr) {
                    return undefined
                }
                const item = JSON.parse(itemStr)
                const now = new Date()

                if (now.getTime() > item.expiry) {
                    localStorage.removeItem(key)
                    return undefined
                }
                return item.value
            }
        };
        window.utils = {
            saveToLocal: saveToLocal,
            getCSS: (url, id = false) => new Promise((resolve, reject) => {
              const link = document.createElement('link')
              link.rel = 'stylesheet'
              link.href = url
              if (id) link.id = id
              link.onerror = reject
              link.onload = link.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                link.onload = link.onreadystatechange = null
                resolve()
              }
              document.head.appendChild(link)
            }),
            getScript: (url, attr = {}) => new Promise((resolve, reject) => {
              const script = document.createElement('script')
              script.src = url
              script.async = true
              script.onerror = reject
              script.onload = script.onreadystatechange = function() {
                const loadState = this.readyState
                if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
                script.onload = script.onreadystatechange = null
                resolve()
              }

              Object.keys(attr).forEach(key => {
                script.setAttribute(key, attr[key])
              })

              document.head.appendChild(script)
            }),
            addGlobalFn: (key, fn, name = false, parent = window) => {
                const globalFn = parent.globalFn || {}
                const keyObj = globalFn[key] || {}

                if (name && keyObj[name]) return

                name = name || Object.keys(keyObj).length
                keyObj[name] = fn
                globalFn[key] = keyObj
                parent.globalFn = globalFn
            },
            addEventListenerPjax: (ele, event, fn, option = false) => {
              ele.addEventListener(event, fn, option)
              utils.addGlobalFn('pjax', () => {
                  ele.removeEventListener(event, fn, option)
              })
          },
        }
    })()</script><!-- theme--><script>initTheme = () => {
    let isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const cachedMode = utils.saveToLocal.get('theme');
    if (cachedMode === undefined) {
        const nowMode =
            isDarkMode ? 'dark' : 'light'
        document.documentElement.setAttribute('data-theme', nowMode);
    } else {
        document.documentElement.setAttribute('data-theme', cachedMode);
    }
    typeof rm === 'object' && rm.mode(cachedMode === 'dark' && isDarkMode)
}
initTheme()</script><!-- global head--><script>const GLOBAL_CONFIG = {
    root: '/solitude/',
    algolia: undefined,
    localsearch: undefined,
    runtime: '2023-04-20 00:00:00',
    lazyload: {
        enable: false,
        error: '/img/error_load.avif'
    },
    copyright: false,
    highlight: {"limit":200,"expand":true,"copy":true,"syntax":"highlight.js"},
    randomlink: false,
    lang: {"theme":{"dark":"å·²åˆ‡æ¢è‡³æ·±è‰²æ¨¡å¼","light":"å·²åˆ‡æ¢è‡³æµ…è‰²æ¨¡å¼"},"copy":{"success":"å¤åˆ¶æˆåŠŸ","error":"å¤åˆ¶å¤±è´¥"},"backtop":"è¿”å›é¡¶éƒ¨","time":{"day":"å¤©å‰","hour":"å°æ—¶å‰","just":"åˆšåˆš","min":"åˆ†é’Ÿå‰","month":"ä¸ªæœˆå‰"},"day":" å¤©","f12":"å¼€å‘è€…æ¨¡å¼å·²æ‰“å¼€ï¼Œè¯·éµå¾ªGPLåè®®ã€‚","totalk":"æ— éœ€åˆ é™¤ç©ºè¡Œï¼Œç›´æ¥è¾“å…¥è¯„è®ºå³å¯"},
    aside: {
        state: {
            morning: "âœ¨ æ—©ä¸Šå¥½ï¼Œæ–°çš„ä¸€å¤©å¼€å§‹äº†",
            noon: "ğŸ² åˆé¤æ—¶é—´",
            afternoon: "ğŸŒ ä¸‹åˆå¥½",
            night: "æ—©ç‚¹ä¼‘æ¯",
            goodnight: "æ™šå®‰ ğŸ˜´",
        },
        witty_words: [],
        witty_comment: {
            prefix: 'å¥½ä¹…ä¸è§ï¼Œ',
            back: 'æ¬¢è¿å†æ¬¡å›æ¥ï¼Œ',
        },
    },
    covercolor: {
        enable: false
    },
    comment: false,
    lightbox: 'null',
    right_menu: false,
    translate: {"translateDelay":0,"defaultEncoding":2},
    lure: false,
    expire: false,
};</script><!-- page-config head--><script id="config-diff">var PAGE_CONFIG = {
    is_post: true,
    is_page: false,
    is_home: false,
    page: '',
    toc: true,
    comment: false,
    ai_text: false,
    color: false,
}</script></head><body id="body"><!-- universe--><!-- background img--><!-- loading--><!-- console--><!-- sidebar--><div id="sidebar" style="zoom: 1;"><div id="menu-mask" style="display: none;"></div><div id="sidebar-menus"><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/solitude/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">84</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/solitude/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">10</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/solitude/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">5</div></a></div></div></div><span class="sidebar-menu-item-title">åŠŸèƒ½</span><div class="sidebar-menu-item"><span class="darkmode_switchbutton menu-child" onclick="sco.switchDarkMode()"><i class="solitude fas fa-circle-half-stroke"></i><span>æ˜¾ç¤ºæ¨¡å¼</span></span></div><span class="sidebar-menu-item-title">æ ‡ç­¾</span><div class="card-tags"><div class="card-tag-cloud"><a href="/solitude/tags/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/">æŠ€æœ¯æ–‡æ¡£<sup>18</sup></a><a href="/solitude/tags/encrypt/">encrypt<sup>1</sup></a><a href="/solitude/tags/%E5%8D%9A%E5%AE%A2/">åšå®¢<sup>1</sup></a><a href="/solitude/tags/%E8%AF%97%E4%B8%8E%E6%95%A3%E6%96%87/">è¯—ä¸æ•£æ–‡<sup>1</sup></a><a href="/solitude/tags/%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3/">é”™è¯¯è§£å†³<sup>5</sup></a></div></div></div></div><!-- keyboard--><!-- righhtside--><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav class="show" id="nav"><div id="nav-group"><div id="blog_name"><a id="site-name" href="/solitude/" title="è¿”å›åšå®¢ä¸»é¡µ"><span class="title">Solitude</span><i class="solitude fas fa-home"></i></a></div><div id="page-name-mask"><div id="page-name"><a id="page-name-text" onclick="sco.toTop()">games101 HomeWork3</a></div></div><div id="menus"></div><div id="nav-left"></div><div id="nav-right"><div class="nav-button" id="nav-totop" onclick="sco.toTop()"><a class="totopbtn"><i class="solitude fas fa-arrow-up"></i><span id="percent">0</span></a></div><div id="toggle-menu"><a class="site-page"><i class="solitude fas fa-bars"></i></a></div></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original" title="è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®">åŸåˆ›</a><span class="post-meta-categories"><a class="post-meta-categories" href="/solitude/categories/CG/">CG</a></span><div class="tag_share"><div class="post-meta__tag-list"></div></div></div></div><h1 class="post-title">games101 HomeWork3</h1><div id="post-meta"><div class="meta-secondline"></div></div></div><div id="post-info-bottom"></div><article class="post-content article-container"><span id="more"></span>

<h1 id="Games101-HomeWork3"><a href="#Games101-HomeWork3" class="headerlink" title="Games101 HomeWork3"></a>Games101 HomeWork3</h1><h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="ä½œä¸šè¦æ±‚"><a href="#ä½œä¸šè¦æ±‚" class="headerlink" title="ä½œä¸šè¦æ±‚"></a>ä½œä¸šè¦æ±‚</h2><p><strong>ç¬¬ä¸‰æ¬¡ä½œä¸šæ‰æ˜¯çœŸæ­£ä¸Šå¼ºåº¦çš„ä½œä¸šï¼Œä½œä¸šè¦æ±‚å’Œè´¨é‡éƒ½ç‰¹åˆ«é«˜ï¼Œå…ˆæ¥çœ‹çœ‹æ‰€æœ‰çš„è¦æ±‚ï¼š</strong></p>
<ul>
<li><strong>1 . ä¿®æ”¹å‡½æ•°rasterize_triangle(const Triangle&amp; t) in rasterizer.cpp: åœ¨æ­¤å¤„å®ç°ä¸ä½œä¸š 2 ç±»ä¼¼çš„æ’å€¼ç®—æ³•ï¼Œå®ç°æ³•å‘é‡ã€é¢œè‰²ã€çº¹ç†é¢œè‰²çš„æ’å€¼ã€‚</strong></li>
<li><strong>2 . ä¿®æ”¹å‡½æ•° get_projection_matrix() in main.cpp: å°†ä½ è‡ªå·±åœ¨ä¹‹å‰çš„å®éªŒä¸­å®ç°çš„æŠ•å½±çŸ©é˜µå¡«åˆ°æ­¤å¤„ï¼Œæ­¤æ—¶ä½ å¯ä»¥è¿è¡Œ.&#x2F;Rasterizer output.png normalæ¥è§‚å¯Ÿæ³•å‘é‡å®ç°ç»“æœã€‚</strong></li>
<li><strong>3 . ä¿®æ”¹å‡½æ•° phong_fragment_shader() in main.cpp: å®ç° Blinn-Phong æ¨¡å‹è®¡ç®— Fragment Color.</strong></li>
<li><strong>4 . ä¿®æ”¹å‡½æ•° texture_fragment_shader() in main.cpp: åœ¨å®ç° Blinn-Phongçš„åŸºç¡€ä¸Šï¼Œå°†çº¹ç†é¢œè‰²è§†ä¸ºå…¬å¼ä¸­çš„ kdï¼Œå®ç° Texture Shading FragmentShader.</strong></li>
<li><strong>5 . ä¿®æ”¹å‡½æ•° bump_fragment_shader() in main.cpp: åœ¨å®ç° Blinn-Phong çš„åŸºç¡€ä¸Šï¼Œä»”ç»†é˜…è¯»è¯¥å‡½æ•°ä¸­çš„æ³¨é‡Šï¼Œå®ç° Bump mapping.</strong></li>
<li><strong>6 . ä¿®æ”¹å‡½æ•° displacement_fragment_shader() in main.cpp: åœ¨å®ç° Bumpmapping çš„åŸºç¡€ä¸Šï¼Œå®ç° displacement mapping.</strong><br><code>æé«˜é¢˜</code></li>
<li><strong>7 .å°è¯•æ›´å¤šæ¨¡å‹</strong></li>
<li><strong>8 .åŒçº¿æ€§çº¹ç†æ’å€¼</strong><br>ä¸è¦æ…Œå¼ ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥ã€‚å…ˆçœ‹ç¬¬ä¸€é¢˜</li>
</ul>
<h3 id="rasterize-triangleä¸­çš„æ’å€¼"><a href="#rasterize-triangleä¸­çš„æ’å€¼" class="headerlink" title="rasterize_triangleä¸­çš„æ’å€¼"></a>rasterize_triangleä¸­çš„æ’å€¼</h3><p><strong>æˆ‘ä»¬åœ¨ç¬¬äºŒé¢˜2x2çš„è¶…é‡‡æ ·çš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œå…ˆçœ‹çœ‹é¢˜ç›®çš„æç¤ºï¼š</strong></p>
<p>rasterize_triangle å‡½æ•°ä¸ä½ åœ¨ä½œä¸š2 ä¸­å®ç°çš„å†…å®¹ç›¸ä¼¼ã€‚ä¸åŒä¹‹å¤„åœ¨äºè¢«<br>è®¾å®šçš„æ•°å€¼å°†ä¸å†æ˜¯<strong>å¸¸æ•°</strong>ï¼Œè€Œæ˜¯æŒ‰ç…§ Barycentric Coordinates å¯¹æ³•å‘é‡ã€é¢œ<br>è‰²ã€çº¹ç†é¢œè‰²ä¸åº•çº¹é¢œè‰²(Shading Colors) è¿›è¡Œæ’å€¼ã€‚å›å¿†æˆ‘ä»¬ä¸Šæ¬¡ä¸ºäº†è®¡ç®—<br>z value è€Œæä¾›çš„**[alpha, beta, gamma]<strong>ï¼Œè¿™æ¬¡ä½ å°†éœ€è¦å°†å…¶åº”ç”¨åœ¨</strong>å…¶ä»–å‚<br>æ•°<strong>çš„æ’å€¼ä¸Šã€‚ä½ éœ€è¦åšçš„æ˜¯</strong>è®¡ç®—æ’å€¼åçš„é¢œè‰²**ï¼Œå¹¶å°†Fragment Shader è®¡ç®—å¾—<br>åˆ°çš„é¢œè‰²å†™å…¥ framebufferï¼Œè¿™è¦æ±‚ä½ <strong>é¦–å…ˆä½¿ç”¨æ’å€¼å¾—åˆ°çš„ç»“æœè®¾ç½® fragment<br>shader payload</strong>ï¼Œå¹¶<strong>è°ƒç”¨ fragment shader</strong> å¾—åˆ°è®¡ç®—ç»“æœã€‚<br><strong>å¯ä»¥çœ‹è§ï¼Œè¿™é‡ŒåŸºæœ¬ç»™å‡ºäº†æ’å€¼çš„æ“ä½œæ­¥éª¤ï¼Œè¿™é‡Œå¯¹ä¸€ä¸ªé‡å¿ƒåæ ‡åšä¸€ä¸ªè§£é‡Šï¼š</strong></p>
<h4 id="é‡å¿ƒåæ ‡ï¼ˆBarycentric-Coordinatesï¼‰"><a href="#é‡å¿ƒåæ ‡ï¼ˆBarycentric-Coordinatesï¼‰" class="headerlink" title="é‡å¿ƒåæ ‡ï¼ˆBarycentric Coordinatesï¼‰"></a>é‡å¿ƒåæ ‡ï¼ˆBarycentric Coordinatesï¼‰</h4><p><strong>ç»™å®šä¸‰è§’å½¢çš„ä¸‰ç‚¹åæ ‡A, B, Cï¼Œè¯¥å¹³é¢å†…ä¸€ç‚¹(x,y)å¯ä»¥å†™æˆè¿™ä¸‰ç‚¹åæ ‡çš„çº¿æ€§ç»„åˆå½¢å¼ï¼Œå³ \((x,y)&#x3D;\alpha A+\beta B+\gamma C\) å¹¶ä¸”æœ‰\(\alpha + \beta +\gamma &#x3D;1\)ç‚¹\((\alpha ,\beta ,\gamma )\)å°±æ˜¯è¿™ä¸ªç‚¹çš„é‡å¿ƒåæ ‡ã€‚å…³äºé‡å¿ƒåæ ‡çš„æ±‚æ³•ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºä»£ç ï¼Œä¸åšæ¨å¯¼ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é‡å¿ƒåæ ‡çš„æ±‚è§£</span></span><br><span class="line"><span class="type">static</span> <span class="built_in">std</span>::tuple&lt;<span class="type">float</span>, <span class="type">float</span>, <span class="type">float</span>&gt; <span class="title function_">computeBarycentric2D</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">const</span> Vector4f* v)</span>&#123;</span><br><span class="line">    <span class="type">float</span> c1 = (x*(v[<span class="number">1</span>].y() - v[<span class="number">2</span>].y()) + (v[<span class="number">2</span>].x() - v[<span class="number">1</span>].x())*y + v[<span class="number">1</span>].x()*v[<span class="number">2</span>].y() - v[<span class="number">2</span>].x()*v[<span class="number">1</span>].y()) / (v[<span class="number">0</span>].x()*(v[<span class="number">1</span>].y() - v[<span class="number">2</span>].y()) + (v[<span class="number">2</span>].x() - v[<span class="number">1</span>].x())*v[<span class="number">0</span>].y() + v[<span class="number">1</span>].x()*v[<span class="number">2</span>].y() - v[<span class="number">2</span>].x()*v[<span class="number">1</span>].y());</span><br><span class="line">    <span class="type">float</span> c2 = (x*(v[<span class="number">2</span>].y() - v[<span class="number">0</span>].y()) + (v[<span class="number">0</span>].x() - v[<span class="number">2</span>].x())*y + v[<span class="number">2</span>].x()*v[<span class="number">0</span>].y() - v[<span class="number">0</span>].x()*v[<span class="number">2</span>].y()) / (v[<span class="number">1</span>].x()*(v[<span class="number">2</span>].y() - v[<span class="number">0</span>].y()) + (v[<span class="number">0</span>].x() - v[<span class="number">2</span>].x())*v[<span class="number">1</span>].y() + v[<span class="number">2</span>].x()*v[<span class="number">0</span>].y() - v[<span class="number">0</span>].x()*v[<span class="number">2</span>].y());</span><br><span class="line">    <span class="type">float</span> c3 = (x*(v[<span class="number">0</span>].y() - v[<span class="number">1</span>].y()) + (v[<span class="number">1</span>].x() - v[<span class="number">0</span>].x())*y + v[<span class="number">0</span>].x()*v[<span class="number">1</span>].y() - v[<span class="number">1</span>].x()*v[<span class="number">0</span>].y()) / (v[<span class="number">2</span>].x()*(v[<span class="number">0</span>].y() - v[<span class="number">1</span>].y()) + (v[<span class="number">1</span>].x() - v[<span class="number">0</span>].x())*v[<span class="number">2</span>].y() + v[<span class="number">0</span>].x()*v[<span class="number">1</span>].y() - v[<span class="number">1</span>].x()*v[<span class="number">0</span>].y());</span><br><span class="line">    <span class="keyword">return</span> &#123;c1,c2,c3&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724150810522-1121172651_1726324407642.png" alt="image"></p>
<h4 id="æ’å€¼"><a href="#æ’å€¼" class="headerlink" title="æ’å€¼"></a>æ’å€¼</h4><p><strong>æœ‰äº†é‡å¿ƒå…¬å¼ï¼Œå°±å¯ä»¥å¯¹å„ä¸ªå±æ€§è¿›è¡Œæ’å€¼äº†ï¼Œå…ˆå†™ä¸€ä¸ªå·¥å…·å‡½æ•°<code>è¿™é‡Œæ¡†æ¶ç»™å‡ºäº†ï¼Œç›´æ¥è°ƒç”¨å°±å¥½</code>ï¼Œæ¥è®¡ç®—å„ç§æ’å€¼ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸‰ç»´å‘é‡ç‰ˆæœ¬ï¼Œé¢œè‰²ã€æ³•çº¿ã€view_pos</span></span><br><span class="line"><span class="type">static</span> Eigen::Vector3f <span class="title function_">interpolate</span><span class="params">(<span class="type">float</span> alpha, <span class="type">float</span> beta, <span class="type">float</span> gamma, <span class="type">const</span> Eigen::Vector3f&amp; vert1, <span class="type">const</span> Eigen::Vector3f&amp; vert2, <span class="type">const</span> Eigen::Vector3f&amp; vert3, <span class="type">float</span> weight)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (alpha * vert1 + beta * vert2 + gamma * vert3) / weight;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//äºŒç»´å‘é‡ç‰ˆæœ¬ï¼Œç”¨äºçº¹ç†åæ ‡</span></span><br><span class="line"><span class="type">static</span> Eigen::Vector2f <span class="title function_">interpolate</span><span class="params">(<span class="type">float</span> alpha, <span class="type">float</span> beta, <span class="type">float</span> gamma, <span class="type">const</span> Eigen::Vector2f&amp; vert1, <span class="type">const</span> Eigen::Vector2f&amp; vert2, <span class="type">const</span> Eigen::Vector2f&amp; vert3, <span class="type">float</span> weight)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> u = (alpha * vert1[<span class="number">0</span>] + beta * vert2[<span class="number">0</span>] + gamma * vert3[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">auto</span> v = (alpha * vert1[<span class="number">1</span>] + beta * vert2[<span class="number">1</span>] + gamma * vert3[<span class="number">1</span>]);</span><br><span class="line">    u /= weight;</span><br><span class="line">    v /= weight;</span><br><span class="line">    <span class="keyword">return</span> Eigen::Vector2f(u, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç„¶åå°±æ˜¯æ’å€¼çš„å®ç°äº†ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span>[alpha, beta, gamma] = computeBarycentric2D(i+<span class="number">0.5f</span>, j+<span class="number">0.5f</span>, t.v);</span><br><span class="line"><span class="keyword">auto</span> interpolated_color=interpolate(alpha,beta,gamma,t.color[<span class="number">0</span>],t.color[<span class="number">1</span>],t.color[<span class="number">2</span>],<span class="number">1</span>);</span><br><span class="line"><span class="keyword">auto</span> interpolated_normal=interpolate(alpha,beta,gamma,t.normal[<span class="number">0</span>],t.normal[<span class="number">1</span>],t.normal[<span class="number">2</span>],<span class="number">1</span>).normalized();</span><br><span class="line"><span class="keyword">auto</span> interpolated_shadingcoords=interpolate(alpha,beta,gamma,view_pos[<span class="number">0</span>],view_pos[<span class="number">1</span>],view_pos[<span class="number">2</span>],<span class="number">1</span>);</span><br><span class="line"><span class="comment">//äºŒç»´ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">auto</span> interpolated_texcoords=interpolate(alpha,beta,gamma,t.tex_coords[<span class="number">0</span>],t.tex_coords[<span class="number">1</span>],t.tex_coords[<span class="number">2</span>],<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>æœ€åè°ƒç”¨<code>fragment_shader</code>è®¡ç®—æœ€åçš„é¢œè‰²å€¼</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload.view_pos = interpolated_shadingcoords;</span><br><span class="line"><span class="keyword">auto</span> pixel_color = fragment_shader(payload);</span><br><span class="line"><span class="comment">// check zbuff</span></span><br><span class="line">set_pixel(Eigen::Vector2i(i,j),pixel_color*IsInTriangleCount/<span class="number">4.0f</span>);</span><br></pre></td></tr></table></figure>

<h3 id="get-projection-matrix-æŠ•å½±çŸ©é˜µ"><a href="#get-projection-matrix-æŠ•å½±çŸ©é˜µ" class="headerlink" title="get_projection_matrix() æŠ•å½±çŸ©é˜µ"></a>get_projection_matrix() æŠ•å½±çŸ©é˜µ</h3><p><strong>å‰é¢æè¿‡äº†ï¼Œè¿™é‡Œåªç»™å‡ºä»£ç ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Matrix4f <span class="title function_">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::Identity();</span><br><span class="line">    eye_fov=eye_fov/<span class="number">180</span>*MY_PI;</span><br><span class="line">    projection&lt;&lt;<span class="number">1</span>/(aspect_ratio*<span class="built_in">tan</span>(eye_fov/<span class="number">2.0f</span>)) ,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">1</span>/<span class="built_in">tan</span>(eye_fov/<span class="number">2.0f</span>),<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">0</span>,-(zFar+zNear)/(zFar-zNear),<span class="number">2</span>*zFar*zNear/(zNear-zFar),</span><br><span class="line">                <span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> projection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-normal-png-normal"><a href="#è¿è¡Œ-Rasterizer-normal-png-normal" class="headerlink" title="è¿è¡Œ ./Rasterizer normal.png normal"></a>è¿è¡Œ <code>./Rasterizer normal.png normal</code></h4><p>normal.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724153730332-1148351579_1726324407642.png" alt="image"></p>
<h3 id="phong-fragment-shader-å…‰ç…§æ¨¡å‹"><a href="#phong-fragment-shader-å…‰ç…§æ¨¡å‹" class="headerlink" title="phong_fragment_shader() å…‰ç…§æ¨¡å‹"></a>phong_fragment_shader() å…‰ç…§æ¨¡å‹</h3><p><strong>æ¥ä¸‹æ¥éœ€è¦å®ç°çš„æ˜¯Bline-Pongå…‰ç…§ç³»ç»Ÿï¼Œé¦–å…ˆæ¥å›å¿†ä¸€ä¸‹Bline-Pongçš„æ“ä½œæ­¥éª¤</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724154952168-2123046406_1726324422982.png" alt="image"></p>
<h4 id="ç¯å¢ƒè‰²Ambient"><a href="#ç¯å¢ƒè‰²Ambient" class="headerlink" title="ç¯å¢ƒè‰²Ambient"></a>ç¯å¢ƒè‰²Ambient</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724155154637-1147583584_1726324422982.png" alt="image"></p>
<h4 id="æ¼«åå°„Diffuse"><a href="#æ¼«åå°„Diffuse" class="headerlink" title="æ¼«åå°„Diffuse"></a>æ¼«åå°„Diffuse</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724155045414-446559460_1726324422982.png" alt="image"></p>
<h4 id="é•œé¢åå°„Specular"><a href="#é•œé¢åå°„Specular" class="headerlink" title="é•œé¢åå°„Specular"></a>é•œé¢åå°„Specular</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724155117823-1687347092_1726324422982.png" alt="image"></p>
<h4 id="ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰"><a href="#ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰" class="headerlink" title="ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰"></a>ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰</h4><p><strong>è§£é‡Šä¸€ä¸‹ä¸€äº›æ“ä½œ</strong></p>
<ul>
<li><strong>Eigen::Vector3f::cwiseProduct è¿”å›ä¸¤ä¸ªçŸ©é˜µï¼ˆå‘é‡ï¼‰åŒä½ç½®çš„å…ƒç´ åˆ†åˆ«ç›¸ä¹˜çš„æ–°çŸ©é˜µï¼ˆå‘é‡ï¼‰ã€‚</strong></li>
<li><strong>std::pow(x,n)è¿”å› \(x^n\)</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//phong_fragment_shader</span></span><br><span class="line"></span><br><span class="line">Eigen::Vector3f LightDir=light.position-point;</span><br><span class="line">Eigen::Vector3f ViewDir=eye_pos-point;</span><br><span class="line"><span class="comment">//r ^ 2</span></span><br><span class="line"><span class="type">float</span> d=LightDir.dot(LightDir);</span><br><span class="line">Eigen::Vector3f H=(LightDir.normalized()+ViewDir.normalized()).normalized();</span><br><span class="line"><span class="comment">//Ambient</span></span><br><span class="line">Eigen::Vector3f Ambient= ka.cwiseProduct(amb_light_intensity);</span><br><span class="line"><span class="type">float</span> LdotN=(normal.normalized()).dot(LightDir.normalized());</span><br><span class="line"><span class="type">float</span> NdotH=(H.normalized()).dot(normal.normalized());</span><br><span class="line"><span class="comment">//Diffuse</span></span><br><span class="line">Eigen::Vector3f Diffuse= <span class="built_in">std</span>::max( LdotN , <span class="number">0.0f</span>)*kd.cwiseProduct(light.intensity/d);</span><br><span class="line"><span class="comment">//Specular</span></span><br><span class="line">Eigen::Vector3f Specular= <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="built_in">std</span>::max( NdotH , <span class="number">0.0f</span>),<span class="number">150</span>)*ks.cwiseProduct(light.intensity/d);</span><br><span class="line">result_color+=Ambient+Diffuse+Specular;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-phong-png-phong"><a href="#è¿è¡Œ-Rasterizer-phong-png-phong" class="headerlink" title="è¿è¡Œ ./Rasterizer phong.png phong"></a>è¿è¡Œ <code>./Rasterizer phong.png phong</code></h4><p><strong>çœ‹çœ‹ï¼Œæˆ‘ä»¬çš„å°ç‰›åˆå…‰æ»‘äº†è®¸å¤š</strong><br>phong.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724164122063-449571494_1726324422982.png" alt="image"></p>
<h3 id="texture-fragment-shader-çº¹ç†è´´å›¾"><a href="#texture-fragment-shader-çº¹ç†è´´å›¾" class="headerlink" title="texture_fragment_shader() çº¹ç†è´´å›¾"></a>texture_fragment_shader() çº¹ç†è´´å›¾</h3><p><strong>åœ¨åŸºç¡€ä»»åŠ¡ä¸­ï¼Œçº¹ç†æ˜ å°„åªéœ€è¦åœ¨phongçš„åŸºç¡€ä¸Šï¼ŒæŠŠé¢œè‰²æ¢æˆçº¹ç†åæ ‡å¯¹åº”çš„é¢œè‰²å°±å¥½äº†ï¼Œåœ¨textureç±»ä¸­ï¼Œæ¡†æ¶å·²ç»å®ç°äº†getColorå‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ‰çº¹ç†çš„æ—¶å€™è°ƒç”¨getColoræ–¹æ³•è·å–å¯¹åº”çš„é¢œè‰²å°±å¥½ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//texture_fragment_shaderå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (payload.texture)</span><br><span class="line">    &#123;</span><br><span class="line">	 	return_color=payload.texture-&gt;getColor(payload.tex_coords.x(),payload.tex_coords.y());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//getColorå‡½æ•°ï¼ˆæ¡†æ¶å·²å®ç°ï¼‰</span></span><br><span class="line">    Eigen::Vector3f <span class="title function_">getColor</span><span class="params">(<span class="type">float</span> u, <span class="type">float</span> v)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> u_img = u * width;</span><br><span class="line">        <span class="keyword">auto</span> v_img = (<span class="number">1</span> - v) * height;</span><br><span class="line">        <span class="keyword">auto</span> color = image_data.at&lt;cv::Vec3b&gt;(v_img, u_img);</span><br><span class="line">        <span class="keyword">return</span> Eigen::Vector3f(color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-texture-png-texture"><a href="#è¿è¡Œ-Rasterizer-texture-png-texture" class="headerlink" title="è¿è¡Œ./Rasterizer texture.png texture"></a>è¿è¡Œ<code>./Rasterizer texture.png texture</code></h4><p><strong>å¦‚æœä½ åšå¯¹äº†è¿™ä¸€æ­¥ï¼Œé‚£ä¹ˆä½ makeä¹‹åä½¿ç”¨ä¸Šé¢çš„æŒ‡ä»¤åº”è¯¥èƒ½å¾—åˆ°è¿™æ ·çš„ç»“æœ:</strong><br>texture.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727142426702-454027515_1726324439052.png" alt="image"></p>
<h3 id="bump-fragment-shader-å‡¹å‡¸-æ³•çº¿-è´´å›¾"><a href="#bump-fragment-shader-å‡¹å‡¸-æ³•çº¿-è´´å›¾" class="headerlink" title="bump_fragment_shader() å‡¹å‡¸(æ³•çº¿)è´´å›¾"></a>bump_fragment_shader() å‡¹å‡¸(æ³•çº¿)è´´å›¾</h3><p><strong>è¿™ä¸€æ­¥å¤©å‘ï¼Œæˆ‘å¤§æ¦‚å¡åœ¨è¿™é‡Œæ”¹äº†ä¸¤ä¸ªå°æ—¶çš„ä»£ç ï¼Œæ¯æ¬¡è·‘å‡ºæ¥éƒ½æ˜¯æ®µé”™è¯¯ï¼ï¼ç»“æœå´ä¸æ˜¯ç®—æ³•é—®é¢˜ï¼Œæˆ‘å“­æ­»ã€‚åœ¨æˆ‘å‡ ä¹å´©æºƒçš„æ—¶å€™ï¼Œè¿˜æ˜¯å‘ç°äº†è¿™ä¸ªå°é—®é¢˜ï¼Œçº¹ç†åæ ‡çš„åœ¨è¾¹ç•Œçš„æ—¶å€™å¯èƒ½å¯¼è‡´è¶…å‡º1.0,è¿™ä¸ªæ—¶å€™åº”è¯¥å¯¹å…¶è¿›è¡Œè¾¹ç•Œå¤„ç†ï¼Œé˜²æ­¢æ•°ç»„è¶Šç•Œã€‚</strong><br><strong>å…³äºå‡¹å‡¸è´´å›¾çš„å®ç°ï¼Œç…§ç€æç¤ºåšå°±å¥½äº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é”™è¯¯ä»£ç </span></span><br><span class="line">    <span class="type">float</span> x=normal.x(),y=normal.y(),z=normal.z();</span><br><span class="line">    Vector3f t =Vector3f(x*y/<span class="built_in">sqrt</span>(x*x+z*z),<span class="built_in">sqrt</span>(x*x+z*z),z*y/<span class="built_in">sqrt</span>(x*x+z*z));</span><br><span class="line">    Vector3f b = normal.cross(t);</span><br><span class="line">    Eigen:Matrix3f TBN ;</span><br><span class="line">    TBN&lt;&lt;t.x(),b.x(),normal.x(),</span><br><span class="line">         t.y(),b.y(),normal.y(),</span><br><span class="line">         t.z(),b.z(),normal.z();</span><br><span class="line">    <span class="type">float</span> u=payload.tex_coords.x();</span><br><span class="line">    <span class="type">float</span> v=payload.tex_coords.y();</span><br><span class="line">    <span class="type">float</span> w=payload.texture-&gt;width;</span><br><span class="line">    <span class="type">float</span> h=payload.texture-&gt;height;</span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (payload.texture-&gt;getColor(u+<span class="number">1</span>/w,v).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (payload.texture-&gt;getColor(u,v+<span class="number">1</span>/h).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    Vector3f ln = Vector3f(-dU, -dV, <span class="number">1</span>);</span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    result_color = (TBN * ln).normalized();</span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line"><span class="comment">//æ­£ç¡®ä»£ç </span></span><br><span class="line">Eigen::Vector3f <span class="title function_">bump_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">long</span> <span class="type">int</span> numb=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;bump_fragment_shader&quot;</span>&lt;&lt;numb++&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    Eigen::Vector3f ka = Eigen::Vector3f(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::Vector3f(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line">    Eigen::Vector3f color = payload.color; </span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line">    <span class="type">float</span> kh = <span class="number">0.2</span>, kn = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement bump mapping here</span></span><br><span class="line">    <span class="comment">// Let n = normal = (x, y, z)</span></span><br><span class="line">    <span class="comment">// Vector t = (x*y/sqrt(x*x+z*z),sqrt(x*x+z*z),z*y/sqrt(x*x+z*z))</span></span><br><span class="line">    <span class="comment">// Vector b = n cross product t</span></span><br><span class="line">    <span class="comment">// Matrix TBN = [t b n]</span></span><br><span class="line">    <span class="comment">// dU = kh * kn * (h(u+1/w,v)-h(u,v))</span></span><br><span class="line">    <span class="comment">// dV = kh * kn * (h(u,v+1/h)-h(u,v))</span></span><br><span class="line">    <span class="comment">// Vector ln = (-dU, -dV, 1)</span></span><br><span class="line">    <span class="comment">// Normal n = normalize(TBN * ln)</span></span><br><span class="line">    <span class="type">float</span> x=normal.x(),y=normal.y(),z=normal.z();</span><br><span class="line">    Vector3f t =Vector3f(x*y/<span class="built_in">sqrt</span>(x*x+z*z),<span class="built_in">sqrt</span>(x*x+z*z),z*y/<span class="built_in">sqrt</span>(x*x+z*z));</span><br><span class="line">    Vector3f b = normal.cross(t);</span><br><span class="line">    Eigen:Matrix3f TBN ;</span><br><span class="line">    TBN&lt;&lt;t.x(),b.x(),normal.x(),</span><br><span class="line">         t.y(),b.y(),normal.y(),</span><br><span class="line">         t.z(),b.z(),normal.z();</span><br><span class="line">    <span class="type">float</span> u=payload.tex_coords.x();</span><br><span class="line">    <span class="type">float</span> v=payload.tex_coords.y();</span><br><span class="line">    <span class="type">float</span> w=payload.texture-&gt;width;</span><br><span class="line">    <span class="type">float</span> h=payload.texture-&gt;height;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è¿™é‡Œå¤šä¸€æ­¥é˜²æ­¢è¶Šç•Œçš„æ“ä½œä½¿ç”¨std::clamp(x , l , r);æ¥ä¿è¯æ•°å€¼åœ¨l åˆ° rä¹‹é—´</span></span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (payload.texture-&gt;getColor(<span class="built_in">std</span>::clamp(u+<span class="number">1</span>/w, <span class="number">0.0f</span>, <span class="number">1.0f</span>),v).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (payload.texture-&gt;getColor(u,<span class="built_in">std</span>::clamp(v+<span class="number">1</span>/h, <span class="number">0.0f</span>, <span class="number">1.0f</span>)).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    Vector3f ln = Vector3f(-dU, -dV, <span class="number">1</span>);</span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    result_color = (TBN * ln).normalized();</span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-rasterizer-bump-png-bump"><a href="#è¿è¡Œ-rasterizer-bump-png-bump" class="headerlink" title="è¿è¡Œ./rasterizer bump.png bump"></a>è¿è¡Œ<code>./rasterizer bump.png bump</code></h4><p>bump.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727160448722-329949569_1726324439052.png" alt="image"></p>
<h3 id="displacement-fragment-shader-ä½ç§»è´´å›¾"><a href="#displacement-fragment-shader-ä½ç§»è´´å›¾" class="headerlink" title="displacement_fragment_shader() ä½ç§»è´´å›¾"></a>displacement_fragment_shader() ä½ç§»è´´å›¾</h3><p><strong>ä½ç§»è´´å›¾ä¸å‡¹å‡¸(æ³•çº¿)è´´å›¾æœ‰æ‰€ä¸åŒ,å‡¹å‡¸è´´å›¾ä¸ä¼šå½±å“ç½‘æ ¼çš„å®é™…å¤šè¾¹å½¢æ€§è´¨ï¼Œåªä¼šå½±å“åœ¨å¹³é¢ä¸Šè®¡ç®—å…‰ç…§çš„æ–¹å¼ã€‚ä½ç§»è´´å›¾ï¼ˆå¸¸å¬åˆ°çš„ç½®æ¢è´´å›¾æœ‰ç‚¹å‹‰å¼ºï¼‰ï¼Œå¯ä»¥è®©æ¨¡å‹è¡¨é¢äº§ç”Ÿä¸€å®šçš„ä½ç§»å˜åŒ–ã€‚ï¼ˆæ³¨æ„è·ŸBumpå‡¹å‡¸è´´å›¾çš„åŒºåˆ«ï¼Œå®ƒå¯ä»¥å®è´¨æ€§åœ°æ”¹å˜æ¨¡å‹çš„é¢æ•°ï¼Œè€ŒBumpå‡¹å‡¸è´´å›¾å¹¶æ²¡æœ‰å®è´¨æ€§åœ°æ”¹å˜æ¨¡å‹é¢æ•°ï¼‰\(^{[1]}\)</strong><br><strong>é‚£ä¹ˆè¯¥æ€ä¹ˆåšä½ç§»è´´å›¾å‘¢ï¼Ÿæœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ä½ç§»äº†ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">point += kn*normal*payload.texture-&gt;getColor(u,v).norm();</span><br></pre></td></tr></table></figure>

<p><strong>é™¤äº†è¿™æ­¥ï¼Œå°±æ˜¯ä¸€ä¸ªç¼åˆäº†æ³•çº¿è´´å›¾å’Œphongæ¨¡å‹çš„ç€è‰²æ–¹æ³•ã€‚è¯´å®è¯ï¼Œè¿™é‡Œè¿˜çœŸä¸æ˜¯å¾ˆæ‡‚ï¼Œä½†æ˜¯ç…§ç€æ³¨é‡Šåšç¡®å®èƒ½çš„è¦æƒ³è¦çš„ç»“æœã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3f <span class="title function_">displacement_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Vector3f ka = Eigen::Vector3f(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::Vector3f(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = payload.color; </span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> kh = <span class="number">0.2</span>, kn = <span class="number">0.1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement displacement mapping here</span></span><br><span class="line">    <span class="comment">// Let n = normal = (x, y, z)</span></span><br><span class="line">    <span class="comment">// Vector t = (x*y/sqrt(x*x+z*z),sqrt(x*x+z*z),z*y/sqrt(x*x+z*z))</span></span><br><span class="line">    <span class="comment">// Vector b = n cross product t</span></span><br><span class="line">    <span class="comment">// Matrix TBN = [t b n]</span></span><br><span class="line">    <span class="comment">// dU = kh * kn * (h(u+1/w,v)-h(u,v))</span></span><br><span class="line">    <span class="comment">// dV = kh * kn * (h(u,v+1/h)-h(u,v))</span></span><br><span class="line">    <span class="comment">// Vector ln = (-dU, -dV, 1)</span></span><br><span class="line">    <span class="comment">// Position p = p + kn * n * h(u,v)</span></span><br><span class="line">    <span class="comment">// Normal n = normalize(TBN * ln)</span></span><br><span class="line">    <span class="type">float</span> x=normal.x(),y=normal.y(),z=normal.z();</span><br><span class="line">    Vector3f t =Vector3f(x*y/<span class="built_in">sqrt</span>(x*x+z*z),<span class="built_in">sqrt</span>(x*x+z*z),z*y/<span class="built_in">sqrt</span>(x*x+z*z));</span><br><span class="line">    Vector3f b = normal.cross(t);</span><br><span class="line">    Eigen:Matrix3f TBN ;</span><br><span class="line">    TBN&lt;&lt;t.x(),b.x(),normal.x(),</span><br><span class="line">         t.y(),b.y(),normal.y(),</span><br><span class="line">         t.z(),b.z(),normal.z();</span><br><span class="line">    <span class="type">float</span> u=payload.tex_coords.x();</span><br><span class="line">    <span class="type">float</span> v=payload.tex_coords.y();</span><br><span class="line">    <span class="type">float</span> w=payload.texture-&gt;width;</span><br><span class="line">    <span class="type">float</span> h=payload.texture-&gt;height;</span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (payload.texture-&gt;getColor(<span class="built_in">std</span>::clamp(u+<span class="number">1</span>/w,<span class="number">0.f</span>,<span class="number">1.f</span>),v).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (payload.texture-&gt;getColor(u,<span class="built_in">std</span>::clamp(v+<span class="number">1</span>/h,<span class="number">0.f</span>,<span class="number">1.f</span>)).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    Vector3f ln = Vector3f(-dU, -dV, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//ä½ç§»</span></span><br><span class="line">    point += kn*normal*payload.texture-&gt;getColor(u,v).norm();</span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    normal = (TBN * ln).normalized();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f ViewDir=eye_pos-point;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> For each light source in the code, calculate what the *ambient*, *diffuse*, and *specular* </span></span><br><span class="line">        <span class="comment">// components are. Then, accumulate that result on the *result_color* object.</span></span><br><span class="line">        Eigen::Vector3f LightDir=light.position-point;</span><br><span class="line">        <span class="type">float</span> d=LightDir.dot(LightDir);</span><br><span class="line">        Eigen::Vector3f H=(LightDir.normalized()+ViewDir.normalized()).normalized();</span><br><span class="line">        Eigen::Vector3f Ambient= ka.cwiseProduct(amb_light_intensity);</span><br><span class="line">        <span class="type">float</span> LdotN=(normal.normalized()).dot(LightDir.normalized());</span><br><span class="line">        <span class="type">float</span> NdotH=(H.normalized()).dot(normal.normalized());</span><br><span class="line">        Eigen::Vector3f Diffuse= <span class="built_in">std</span>::max( LdotN , <span class="number">0.0f</span>)*kd.cwiseProduct(light.intensity/d);</span><br><span class="line">        Eigen::Vector3f Specular= <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="built_in">std</span>::max( NdotH , <span class="number">0.0f</span>),<span class="number">150</span>)*ks.cwiseProduct(light.intensity/d);</span><br><span class="line">        result_color+=Ambient+Diffuse+Specular;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-displacement-png-displacement"><a href="#è¿è¡Œ-Rasterizer-displacement-png-displacement" class="headerlink" title="è¿è¡Œ./Rasterizer displacement.png displacement"></a>è¿è¡Œ<code>./Rasterizer displacement.png displacement</code></h4><p>displacement.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727170304928-975418181_1726324439052.png" alt="image"></p>
<h3 id="åŒçº¿æ€§æ’å€¼"><a href="#åŒçº¿æ€§æ’å€¼" class="headerlink" title="åŒçº¿æ€§æ’å€¼"></a>åŒçº¿æ€§æ’å€¼</h3><p><strong>è¿™ä¸ªè™½ç„¶ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ¥è®²ä¸€ä¸‹å…·ä½“å®ç°ï¼š</strong><br><strong>å‡½æ•°åŸå‹å¦‚ä¸‹</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3f <span class="title function_">getColorBilinear</span><span class="params">(<span class="type">float</span> u,<span class="type">float</span> v)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>æ ¹æ®ä¸‹é¢è¿™å¼ åŸç†å›¾ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å®ç°</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727143136416-982621662_1726324439052.png" alt="image"><br><strong>ç¬¬ä¸€æ­¥ï¼Œå°†<code>u</code>å’Œ<code>v</code>é™åˆ¶åœ¨\(0-1\)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u = <span class="built_in">std</span>::clamp(u, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">v = <span class="built_in">std</span>::clamp(v, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br></pre></td></tr></table></figure>

<p><strong>æŠŠæ¯”ä¾‹è½¬åŒ–ä¸ºçº¹ç†åæ ‡ï¼Œå¹¶è®¡ç®—ç›¸é‚»çš„å››ä¸ªåƒç´ ç‚¹</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> u_img = u * width;</span><br><span class="line"><span class="keyword">auto</span> v_img = (<span class="number">1</span> - v) * height;</span><br><span class="line"><span class="type">float</span> uMax=<span class="built_in">std</span>::min((<span class="type">float</span>)width,<span class="built_in">std</span>::<span class="built_in">ceil</span>(u_img));</span><br><span class="line"><span class="type">float</span> uMin=<span class="built_in">std</span>::max(<span class="number">0.0f</span>,<span class="built_in">std</span>::<span class="built_in">floor</span>(u_img));</span><br><span class="line"><span class="type">float</span> vMax=<span class="built_in">std</span>::min((<span class="type">float</span>)height,<span class="built_in">std</span>::<span class="built_in">ceil</span>(v_img));</span><br><span class="line"><span class="type">float</span> vMin=<span class="built_in">std</span>::max(<span class="number">0.0f</span>,<span class="built_in">std</span>::<span class="built_in">floor</span>(v_img));</span><br></pre></td></tr></table></figure>

<p><strong>å…¶ä¸­</strong></p>
<ul>
<li><code>ceil()</code>å‘ä¸Šå»æ•´</li>
<li><code>floor()</code>å‘ä¸‹å–æ•´</li>
</ul>
<p>  <strong>è®°å½•å››ä¸ªç‚¹çš„é¢œè‰²</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Up Left Point</span></span><br><span class="line"><span class="keyword">auto</span> colorUL = image_data.at&lt;cv::Vec3b&gt;(vMax,uMin );</span><br><span class="line"><span class="comment">//Up Right Point</span></span><br><span class="line"><span class="keyword">auto</span> colorUR = image_data.at&lt;cv::Vec3b&gt;(vMax, uMax);</span><br><span class="line"><span class="comment">//Down Left Point</span></span><br><span class="line"><span class="keyword">auto</span> colorDL = image_data.at&lt;cv::Vec3b&gt;(vMin, uMin);</span><br><span class="line"><span class="comment">//Down Right Point</span></span><br><span class="line"><span class="keyword">auto</span> colorDR = image_data.at&lt;cv::Vec3b&gt;(vMin, uMax);</span><br></pre></td></tr></table></figure>

<p><strong>å•çº¿æ€§æ’å€¼</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> uLerpNum=(u_img-uMin)/(uMax-uMin);</span><br><span class="line"><span class="type">float</span> vLerpNum=(v_img-vMin)/(vMax-vMin);</span><br><span class="line"><span class="comment">//U Up Lerp</span></span><br><span class="line"><span class="keyword">auto</span> colorUp_U_Lerp=uLerpNum*colorUL+(<span class="number">1</span>-uLerpNum)*colorUR;</span><br><span class="line"><span class="comment">//U Down Lerp</span></span><br><span class="line"><span class="keyword">auto</span> colorDown_U_Lerp= uLerpNum*colorDL+(<span class="number">1</span>-uLerpNum)*colorDR;</span><br></pre></td></tr></table></figure>

<p><strong>å†è¿›è¡Œä¸€æ¬¡æ’å€¼</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//V Lerp</span></span><br><span class="line"><span class="keyword">auto</span> color = vLerpNum*colorDown_U_Lerp+(<span class="number">1</span>-vLerpNum)*colorUp_U_Lerp;</span><br></pre></td></tr></table></figure>

<p><strong>å¹¶ä¿®æ”¹texture_fragment_shaderä¸­è·å–æè´¨çš„è¯­å¥</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3f <span class="title function_">texture_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Vector3f return_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (payload.texture)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Get the texture value at the texture coordinates of the current fragment</span></span><br><span class="line">		<span class="comment">//åŒçº¿æ€§æ’å€¼</span></span><br><span class="line">        return_color=payload.texture-&gt;getColorBilinear(payload.tex_coords.x(),payload.tex_coords.y());</span><br><span class="line">    &#125;</span><br><span class="line">    Eigen::Vector3f texture_color;</span><br><span class="line">    texture_color &lt;&lt; return_color.x(), return_color.y(), return_color.z();</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f ka = Eigen::Vector3f(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = texture_color / <span class="number">255.f</span>;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::Vector3f(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = texture_color;</span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> For each light source in the code, calculate what the *ambient*, *diffuse*, and *specular*</span></span><br><span class="line">        <span class="comment">// components are. Then, accumulate that result on the *result_color* object.</span></span><br><span class="line">        Eigen::Vector3f LightDir=light.position-point;</span><br><span class="line">        Eigen::Vector3f ViewDir=eye_pos-point;</span><br><span class="line">        <span class="type">float</span> d=LightDir.dot(LightDir);</span><br><span class="line">        Eigen::Vector3f H=(LightDir.normalized()+ViewDir.normalized()).normalized();</span><br><span class="line">        Eigen::Vector3f Ambient= ka.cwiseProduct(amb_light_intensity);</span><br><span class="line">        <span class="type">float</span> LdotN=(normal.normalized()).dot(LightDir.normalized());</span><br><span class="line">        <span class="type">float</span> NdotH=(H.normalized()).dot(normal.normalized());</span><br><span class="line">        Eigen::Vector3f Diffuse= <span class="built_in">std</span>::max( LdotN , <span class="number">0.0f</span>)*kd.cwiseProduct(light.intensity/d);</span><br><span class="line">        Eigen::Vector3f Specular= <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="built_in">std</span>::max( NdotH , <span class="number">0.0f</span>),<span class="number">150</span>)*ks.cwiseProduct(light.intensity/d);</span><br><span class="line">        result_color+=Ambient+Diffuse+Specular;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨å…¶ä»–æ¨¡å‹"><a href="#ä½¿ç”¨å…¶ä»–æ¨¡å‹" class="headerlink" title="ä½¿ç”¨å…¶ä»–æ¨¡å‹"></a>ä½¿ç”¨å…¶ä»–æ¨¡å‹</h3><p><strong>ç”±äºå‡¹å‡¸è´´å›¾å’Œä½ç§»è´´å›¾æ˜¯éœ€è¦æ³•çº¿è´´å›¾çš„ï¼Œæ‰€ä»¥åªæœ‰spotæ¨¡å‹ï¼ˆå°ç‰›ï¼‰æ˜¯å¯ä»¥è¿›è¡Œçš„ï¼Œå…¶ä»–çš„æ¨¡å‹éƒ½è¿›è¡Œä¸æ–™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸åšäº†ã€‚ä½†æ˜¯æˆ‘åœ¨åšçº¹ç†æ˜ å°„çš„æ—¶å€™ï¼Œå¤§æŠµæ˜¯å‘ç”Ÿäº†å¥‡æ€ªçš„äº‹æƒ…ï¼Œæ²¡æœ‰åŠæ³•å¾ˆå¥½çš„ä½œå‡ºçº¹ç†è´´å›¾ã€‚é‚£æˆ‘æ‘†æ äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼šæŒºå·®çš„ï¼Œæˆ‘ä¹Ÿè§£å†³ä¸äº†äº†</strong><br><strong>æˆ‘è‡ªå·±åšäº†ä¸€äº›æŒ‡ä»¤ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728150251896-1866767253_1726324439052.png" alt="image"></p>
<h4 id="bunny"><a href="#bunny" class="headerlink" title="bunny"></a>bunny</h4><p><code>./Rasterizer \- normal bunny 2</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728151501544-1113996278_1726324449461.png" alt="image"><br><code>./Rasterizer \- phong bunny 2</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728151503837-676167363_1726324449461.png" alt="image"></p>
<h4 id="Crate"><a href="#Crate" class="headerlink" title="Crate"></a>Crate</h4><p><code>./Rasterizer \- normal crate</code><br><strong>å…·ä½“ä¸ºä»€ä¹ˆç”»å‡ºæ¥è¿™ä¸ªæ ·å­æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œæäº†ä¸€ä¸‹åˆï¼Œæ‘†æ äº†</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728152651037-615293228_1726324449461.png" alt="image"><br><code>./Rasterizer \- phong crate</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728152836476-1104393584_1726324449461.png" alt="image"><br><strong>æˆ‘æœ¬æ¥ä»¥ä¸ºæ˜¯å› ä¸ºæ‘„åƒæœºçš„ä½ç½®ï¼Œç„¶åæˆ‘è°ƒæ•´äº†æ‘„åƒæœºçš„ä½ç½®ï¼Œåˆç”»å‡ºäº†è¿™æ ·çš„å›¾ç‰‡ï¼šè¿™ä¸‹æ²¡åŠæ³•äº†</strong><br><code>./Rasterizer \- phong crate 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153017561-293420920_1726324449461.png" alt="image"><br><code>./Rasterizer \- texture crate</code><br><strong>è´´å›¾ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆéå¸¸å¥‡æ€ªï¼Œç½¢äº†ç½¢äº†</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153127067-1582248841_1726324464669.png" alt="image"></p>
<h4 id="cube"><a href="#cube" class="headerlink" title="cube"></a>cube</h4><p><code>./Rasterizer \- normal cube</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153255697-793645420_1726324464669.png" alt="image"><br><strong>è¿˜å¯ä»¥ç§»åŠ¨æ‘„åƒæœºåˆ°(0,0,-10)å»çœ‹çœ‹ <del>(å…¶å®è¿™ä¸ªæˆåƒæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºåªæ˜¯ç§»åŠ¨äº†eye_posï¼Œæ·±åº¦ä¿¡æ¯çš„è®¡ç®—å¹¶æ²¡æœ‰é‡æ–°è®¡ç®—ï¼Œæ‰€ä»¥æ·±åº¦è¿˜æ˜¯ä»¥(0,0,10)æ¥è®¡ç®—çš„ã€‚çœ‹åˆ°å›¾åƒå°±å¾ˆå¥‡æ€ª)</del></strong><br><code>./Rasterizer \- normal cube \-10</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153344003-1666282860_1726324464669.png" alt="image"><br><code>./Rasterizer \- phong cube</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153751868-999380803_1726324464669.png" alt="image"><br><code>./Rasterizer \- texture cube</code><br><strong><del>å°±ä¹å‘µä¹å‘µå§</del></strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153846947-867937133_1726324464669.png" alt="image"></p>
<h4 id="rock"><a href="#rock" class="headerlink" title="rock"></a>rock</h4><p><code>./Rasterizer \- normal rock 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728154200513-633371835_1726324474344.png" alt="image"><br><strong>rockè¿™ä¸ªæ¨¡å‹ï¼Œå¦‚æœç”¨10çš„è¯ï¼Œä¼šè¶…å‡ºè§†å£èŒƒå›´ï¼Œä½†æ˜¯getIndexå‡½æ•°å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œè¯¥æœ‰çš„æ“ä½œï¼Œå¯¼è‡´ä¼šå‡ºç°æ®µé”™è¯¯ï¼Œè¿™é‡Œè°ƒè¿œæ‘„åƒæœºçš„ä½ç½®æ¥é˜²æ­¢å‡ºç°æ®µé”™è¯¯ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> rst::rasterizer::get_index(<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (height-y)*width + x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>./Rasterizer \- phong rock 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728154237464-1535985916_1726324474344.png" alt="image"><br><code>./Rasterizer \- texture rock 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728154310832-172869686_1726324474344.png" alt="image"></p>
<h4 id="mainå‡½æ•°æºä»£ç "><a href="#mainå‡½æ•°æºä»£ç " class="headerlink" title="mainå‡½æ•°æºä»£ç "></a>mainå‡½æ•°æºä»£ç </h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>** argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; model_list,shader_list;</span><br><span class="line">    <span class="keyword">if</span>(argc==<span class="number">2</span>&amp;&amp;<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>])==<span class="string">&quot;--help&quot;</span>)&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The first data is output file name or a &#x27;-&#x27; to defult it&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The second data is shader mode such as : normal phong texture nump displacement&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The Thired data is optional which you can choose whatever model you want :spot cate bunny cube rock &quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The fourth data is optional you can change your eye&#x27;s axis z,in range(2,50)&quot;</span></span><br><span class="line">        &lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Triangle*&gt; TriangleList;</span><br><span class="line">    <span class="type">float</span> angle = <span class="number">140.0</span>;</span><br><span class="line">    <span class="type">bool</span> command_line = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title function_">model_name</span><span class="params">(<span class="string">&quot;spot&quot;</span>)</span>,shader_name;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> filename = <span class="string">&quot;output.png&quot;</span>;</span><br><span class="line">    objl::Loader Loader;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> obj_path = <span class="string">&quot;../models&quot;</span>;</span><br><span class="line">    rst::rasterizer <span class="title function_">r</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>)</span>;    </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> texture_path;</span><br><span class="line">    <span class="comment">// Load .obj File</span></span><br><span class="line">    <span class="type">bool</span> loadout =<span class="literal">false</span>;</span><br><span class="line">    texture_path = <span class="string">&quot;/spot/hmap.jpg&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt;= <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        loadout = Loader.LoadFile(<span class="string">&quot;../models/spot/spot_triangulated_good.obj&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(argc&gt;=<span class="number">4</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;rock&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/rock/rock.obj&quot;</span>);</span><br><span class="line">            texture_path = <span class="string">&quot;/rock/rock.png&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;cube&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/cube/cube.obj&quot;</span>);</span><br><span class="line">            texture_path = <span class="string">&quot;/cube/wall.tif&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;bunny&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/bunny/bunny.obj&quot;</span>);</span><br><span class="line">            texture_path.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;crate&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/Crate/Crate1.obj&quot;</span>);</span><br><span class="line">            texture_path = <span class="string">&quot;/Crate/crate_1.jpg&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;spot&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/spot/spot_triangulated_good.obj&quot;</span>);</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Model Load succes&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            texture_path = <span class="string">&quot;/spot/hmap.jpg&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Model is &quot;</span>&lt;&lt;argv[<span class="number">3</span>]&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        model_name=argv[<span class="number">3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if(!texture_path.empty())</span></span><br><span class="line">    <span class="comment">//     r.set_texture(Texture(obj_path + texture_path));</span></span><br><span class="line">    <span class="keyword">if</span> (argc==<span class="number">3</span>||argc&gt;=<span class="number">4</span>&amp;&amp;<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;spot&quot;</span>)</span><br><span class="line">        r.set_texture(Texture(obj_path + texture_path));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> mesh : Loader.LoadedMeshes)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; mesh.Vertices.size(); i += <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Triangle *t = new Triangle();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                t-&gt;setVertex(j, Vector4f(mesh.Vertices[i + j].Position.X, mesh.Vertices[i + j].Position.Y, mesh.Vertices[i + j].Position.Z, <span class="number">1.0</span>));</span><br><span class="line">                t-&gt;setNormal(j, Vector3f(mesh.Vertices[i + j].Normal.X, mesh.Vertices[i + j].Normal.Y, mesh.Vertices[i + j].Normal.Z));</span><br><span class="line">                t-&gt;setTexCoord(j, Vector2f(mesh.Vertices[i + j].TextureCoordinate.X, mesh.Vertices[i + j].TextureCoordinate.Y));</span><br><span class="line">            &#125;</span><br><span class="line">            TriangleList.push_back(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::function&lt;Eigen::Vector3f(fragment_shader_payload)&gt; active_shader = phong_fragment_shader;</span><br><span class="line">    <span class="keyword">if</span> (argc &gt;= <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        command_line = <span class="literal">true</span>;</span><br><span class="line">        filename = <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(argc&gt;=<span class="number">3</span>)shader_name=argv[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;texture&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the texture shader\n&quot;</span>;</span><br><span class="line">            active_shader = texture_fragment_shader;</span><br><span class="line">            <span class="keyword">if</span>(argc &gt;=<span class="number">4</span> &amp;&amp; argv[<span class="number">3</span>]==<span class="string">&quot;spot&quot;</span>||argc==<span class="number">3</span>)&#123;</span><br><span class="line">                texture_path = <span class="string">&quot;/spot/spot_texture.png&quot;</span>;</span><br><span class="line">            r.set_texture(Texture(obj_path + texture_path));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the normal shader\n&quot;</span>;</span><br><span class="line">            active_shader = normal_fragment_shader;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;phong&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the phong shader\n&quot;</span>;</span><br><span class="line">            active_shader = phong_fragment_shader;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;bump&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(model_name!=<span class="string">&quot;spot&quot;</span>)&#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;There is no normal texture!&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the bump shader\n&quot;</span>;</span><br><span class="line">            active_shader = bump_fragment_shader;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;displacement&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(model_name!=<span class="string">&quot;spot&quot;</span>)&#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;There is no normal texture!&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the bump shader\n&quot;</span>;</span><br><span class="line">            active_shader = displacement_fragment_shader;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> eye_z=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;=<span class="number">5</span>)eye_z=<span class="built_in">std</span>::stoi(argv[<span class="number">4</span>]);</span><br><span class="line">    Eigen::Vector3f eye_pos = &#123;<span class="number">0</span>,<span class="number">0</span>,eye_z&#125;;</span><br><span class="line">    r.set_vertex_shader(vertex_shader);</span><br><span class="line">    r.set_fragment_shader(active_shader);</span><br><span class="line">    <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> frame_count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (command_line)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>])==<span class="string">&quot;-&quot;</span>)&#123;</span><br><span class="line">            filename=model_name+<span class="string">&quot;_&quot;</span>+shader_name+<span class="string">&quot;_&quot;</span>+<span class="built_in">std</span>::to_string(<span class="type">int</span>(eye_z))+<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        r.clear(rst::Buffers::Color | rst::Buffers::Depth);</span><br><span class="line">        r.set_model(get_model_matrix(angle));</span><br><span class="line">        r.set_view(get_view_matrix(eye_pos));</span><br><span class="line">        r.set_projection(get_projection_matrix(<span class="number">45.0</span>, <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">50</span>));</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Before Draw&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        r.draw(TriangleList);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;After Draw shader with &quot;</span>&lt;&lt;shader_name&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        cv::Mat <span class="title function_">image</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>, CV_32FC3, r.frame_buffer().data())</span>;</span><br><span class="line">        image.convertTo(image, CV_8UC3, <span class="number">1.0f</span>);</span><br><span class="line">        cv::cvtColor(image, image, cv::COLOR_RGB2BGR);</span><br><span class="line">        cv::imwrite(filename, image);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(key != <span class="number">27</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r.clear(rst::Buffers::Color | rst::Buffers::Depth);</span><br><span class="line">        r.set_model(get_model_matrix(angle));</span><br><span class="line">        r.set_view(get_view_matrix(eye_pos));</span><br><span class="line">        r.set_projection(get_projection_matrix(<span class="number">45.0</span>, <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">50</span>));</span><br><span class="line">        <span class="comment">//r.draw(pos_id, ind_id, col_id, rst::Primitive::Triangle);</span></span><br><span class="line">        r.draw(TriangleList);</span><br><span class="line">        cv::Mat <span class="title function_">image</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>, CV_32FC3, r.frame_buffer().data())</span>;</span><br><span class="line">        image.convertTo(image, CV_8UC3, <span class="number">1.0f</span>);</span><br><span class="line">        cv::cvtColor(image, image, cv::COLOR_RGB2BGR);</span><br><span class="line">        cv::imshow(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">        cv::imwrite(filename, image);</span><br><span class="line">        key = cv::waitKey(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="string">&#x27;a&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            angle -= <span class="number">0.1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key == <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            angle += <span class="number">0.1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>\({[1]}\) <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/137449232">ã€Blenderã€‘ è¯¦è§£ å‡¹å‡¸è´´å›¾ Bump&#x2F;Normal&#x2F;Displacement ä¸‰è€…çš„åŒºåˆ«</a></p>
<h2 id="ä»£ç åˆé›†"><a href="#ä»£ç åˆé›†" class="headerlink" title="ä»£ç åˆé›†"></a>ä»£ç åˆé›†</h2><p><strong>ä»£ç æœ‰äº›å¤šï¼Œæˆ‘å°±ç›´æ¥æ”¾githubäº†ã€‚</strong><br><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/tree/master/Assignment3">zhywyt-github</a></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589119.html">ä¸‹ä¸€ç¯‡ï¼šBezieræ›²çº¿çš„ç»˜åˆ¶</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576366.html">ä¸Šä¸€ç¯‡ï¼šå›¾å½¢å¡«å……</a></p>
<hr>
<h2 id="2023-10-18"><a href="#2023-10-18" class="headerlink" title="2023-10-18"></a>2023-10-18</h2><p>é¸½äº†è¿™ä¹ˆä¹…åˆå›æ¥å†™101çš„æ¡†æ¶è§£è¯»äº†</p>
<h2 id="æ¡†æ¶è§£è¯»"><a href="#æ¡†æ¶è§£è¯»" class="headerlink" title="æ¡†æ¶è§£è¯»"></a>æ¡†æ¶è§£è¯»</h2><h3 id="æ–°å¢æ–‡ä»¶ä¸€è§ˆ"><a href="#æ–°å¢æ–‡ä»¶ä¸€è§ˆ" class="headerlink" title="æ–°å¢æ–‡ä»¶ä¸€è§ˆ"></a>æ–°å¢æ–‡ä»¶ä¸€è§ˆ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;global.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Shader.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Texture.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OBJ_Loader.h&quot;</span></span></span><br></pre></td></tr></table></figure></article><div class="post-copyright"><div class="post-copyright__author_group"><div class="post-copyright__author_img"><img class="post-copyright__author_img_front" src="/solitude/img/logo.png"></div><div class="post-copyright__author_name">zhywyt</div><div class="post-copyright__author_desc"></div></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div id="quit-box" onclick="RemoveRewardMask()"></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">æœ¬æ–‡æ˜¯åŸåˆ›æ–‡ç« ï¼Œé‡‡ç”¨<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh-hans">CC BY-NC-SA 4.0</a>åè®®ï¼Œå®Œæ•´è½¬è½½è¯·æ³¨æ˜æ¥è‡ª<a href="/solitude/">zhywyt's blog</a></span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__tag-list"></div></div></div><nav class="needEndHide pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/solitude/posts/6999/"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">games101 HomeWork4</div></div></a></div><div class="next-post pull-right"><a href="/solitude/posts/6886/"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Ubuntuè§£å†³é«˜åˆ†å±ä¸‹Matlabå·¥å…·æ å­—ä½“è¿‡å°</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><div class="top-group"><div class="sayhi" id="sayhi" onclick="sco.changeWittyWord()"></div></div></div><div class="avatar"><img alt="å¤´åƒ" src="/img/logo.png"></div><div class="description"></div><div class="bottom-group"><span class="left"><div class="name">zhywyt</div><div class="desc">åªæœ‰è¿é£ï¼Œé£ç­æ‰èƒ½é£å¾—æ›´é«˜ã€‚</div></span><div class="social-icons is-center"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="solitude fas fa-bars"></i><span>æ–‡ç« ç›®å½•</span></div><div class="toc-content" id="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Games101-HomeWork3"><span class="toc-text">Games101 HomeWork3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E8%88%AA"><span class="toc-text">å¯¼èˆª</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A%E8%A6%81%E6%B1%82"><span class="toc-text">ä½œä¸šè¦æ±‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#rasterize-triangle%E4%B8%AD%E7%9A%84%E6%8F%92%E5%80%BC"><span class="toc-text">rasterize_triangleä¸­çš„æ’å€¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%BF%83%E5%9D%90%E6%A0%87%EF%BC%88Barycentric-Coordinates%EF%BC%89"><span class="toc-text">é‡å¿ƒåæ ‡ï¼ˆBarycentric Coordinatesï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%92%E5%80%BC"><span class="toc-text">æ’å€¼</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#get-projection-matrix-%E6%8A%95%E5%BD%B1%E7%9F%A9%E9%98%B5"><span class="toc-text">get_projection_matrix() æŠ•å½±çŸ©é˜µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-Rasterizer-normal-png-normal"><span class="toc-text">è¿è¡Œ .&#x2F;Rasterizer normal.png normal</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#phong-fragment-shader-%E5%85%89%E7%85%A7%E6%A8%A1%E5%9E%8B"><span class="toc-text">phong_fragment_shader() å…‰ç…§æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E8%89%B2Ambient"><span class="toc-text">ç¯å¢ƒè‰²Ambient</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BC%AB%E5%8F%8D%E5%B0%84Diffuse"><span class="toc-text">æ¼«åå°„Diffuse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%9C%E9%9D%A2%E5%8F%8D%E5%B0%84Specular"><span class="toc-text">é•œé¢åå°„Specular</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%EF%BC%88%E7%9C%8B%E6%B3%A8%E9%87%8A%EF%BC%89"><span class="toc-text">ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-Rasterizer-phong-png-phong"><span class="toc-text">è¿è¡Œ .&#x2F;Rasterizer phong.png phong</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#texture-fragment-shader-%E7%BA%B9%E7%90%86%E8%B4%B4%E5%9B%BE"><span class="toc-text">texture_fragment_shader() çº¹ç†è´´å›¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-Rasterizer-texture-png-texture"><span class="toc-text">è¿è¡Œ.&#x2F;Rasterizer texture.png texture</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bump-fragment-shader-%E5%87%B9%E5%87%B8-%E6%B3%95%E7%BA%BF-%E8%B4%B4%E5%9B%BE"><span class="toc-text">bump_fragment_shader() å‡¹å‡¸(æ³•çº¿)è´´å›¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-rasterizer-bump-png-bump"><span class="toc-text">è¿è¡Œ.&#x2F;rasterizer bump.png bump</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#displacement-fragment-shader-%E4%BD%8D%E7%A7%BB%E8%B4%B4%E5%9B%BE"><span class="toc-text">displacement_fragment_shader() ä½ç§»è´´å›¾</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C-Rasterizer-displacement-png-displacement"><span class="toc-text">è¿è¡Œ.&#x2F;Rasterizer displacement.png displacement</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E7%BA%BF%E6%80%A7%E6%8F%92%E5%80%BC"><span class="toc-text">åŒçº¿æ€§æ’å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E6%A8%A1%E5%9E%8B"><span class="toc-text">ä½¿ç”¨å…¶ä»–æ¨¡å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bunny"><span class="toc-text">bunny</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Crate"><span class="toc-text">Crate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cube"><span class="toc-text">cube</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#rock"><span class="toc-text">rock</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#main%E5%87%BD%E6%95%B0%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="toc-text">mainå‡½æ•°æºä»£ç </span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E7%94%A8"><span class="toc-text">å¼•ç”¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%90%88%E9%9B%86"><span class="toc-text">ä»£ç åˆé›†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B-%E4%B8%8A%E4%B8%80%E7%AF%87"><span class="toc-text">ä¸‹&#x2F;ä¸Šä¸€ç¯‡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2023-10-18"><span class="toc-text">2023-10-18</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E8%A7%A3%E8%AF%BB"><span class="toc-text">æ¡†æ¶è§£è¯»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%96%87%E4%BB%B6%E4%B8%80%E8%A7%88"><span class="toc-text">æ–°å¢æ–‡ä»¶ä¸€è§ˆ</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="solitude fas fa-map"></i><span>æœ€è¿‘å‘å¸ƒ</span></div><div class="aside-list"><a class="aside-list-item" href="/solitude/posts/10907/" title="åœ¨Unity2Dä¸­åˆ›å»ºè§’è‰²æè¾¹çš„shaderæ€è·¯"><div class="content"><span class="title" href="/solitude/posts/10907/" title="åœ¨Unity2Dä¸­åˆ›å»ºè§’è‰²æè¾¹çš„shaderæ€è·¯">åœ¨Unity2Dä¸­åˆ›å»ºè§’è‰²æè¾¹çš„shaderæ€è·¯</span></div></a><a class="aside-list-item" href="/solitude/posts/5993/" title="Listaryâ€”â€”ä¸ä»…ä»…æ˜¯æœç´¢å™¨"><div class="content"><span class="title" href="/solitude/posts/5993/" title="Listaryâ€”â€”ä¸ä»…ä»…æ˜¯æœç´¢å™¨">Listaryâ€”â€”ä¸ä»…ä»…æ˜¯æœç´¢å™¨</span></div></a><a class="aside-list-item" href="/solitude/posts/51899/" title="æˆ‘çš„ç¼–è¾‘å™¨"><div class="content"><span class="title" href="/solitude/posts/51899/" title="æˆ‘çš„ç¼–è¾‘å™¨">æˆ‘çš„ç¼–è¾‘å™¨</span><span class="categories" href="/solitude/posts/51899/">å…³äºåšå®¢</span></div></a><a class="aside-list-item" href="/solitude/posts/0/" title="Untitled"><div class="content"><span class="title" href="/solitude/posts/0/" title="Untitled">Untitled</span></div></a><a class="aside-list-item" href="/solitude/posts/64880/" title="anzhiyuä¸»é¢˜æ­å»ºè®°å½•"><div class="content"><span class="title" href="/solitude/posts/64880/" title="anzhiyuä¸»é¢˜æ­å»ºè®°å½•">anzhiyuä¸»é¢˜æ­å»ºè®°å½•</span><span class="categories" href="/solitude/posts/64880/">é—²é±¼å…¼èŒ</span></div></a></div></div></div></div></main><footer id="footer"><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div class="copyright">Â© 2023 - 2025 By&nbsp;<a class="footer-bar-link" href="/solitude/"><img class="author-avatar" src="/solitude/img/pwa/favicon.png">zhywyt</a></div><div class="beian-group"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://hexo.io/">æ¡†æ¶ï¼šHexo</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/everfu/hexo-theme-solitude">ä¸»é¢˜ï¼šSolitude</a></div></div></div></div></footer></div><!-- right_menu--><!-- inject body--><div><script src="/solitude/js/utils.js?v=3.0.15"></script><script src="/solitude/js/main.js?v=3.0.15"></script><script src="/solitude/js/third_party/waterfall.min.js?v=3.0.15"></script><script src="https://fastly.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/solitude/js/tw_cn.js?v=3.0.15"></script><script src="https://fastly.jsdelivr.net/npm/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>window.paceOptions = {
  restartOnPushState: false
}

utils.addGlobalFn('pjaxSend', () => {
  Pace.restart()
}, 'pace_restart')
</script><script src="https://fastly.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div class="js-pjax"></div></div><!-- pjax--><script>const pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: ["title","#body-wrap","#site-config","meta[name=\"description\"]",".js-pjax","meta[property^=\"og:\"]","#config-diff",".rs_show",".rs_hide"],
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
})

document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
})

document.addEventListener('pjax:complete', () => {
    window.refreshFn()

    document.querySelectorAll('script[data-pjax]').forEach(item => {
        const newScript = document.createElement('script')
        const content = item.text || item.textContent || item.innerHTML || ""
        Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
        newScript.appendChild(document.createTextNode(content))
        item.parentNode.replaceChild(newScript, item)
    })

    GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

})

document.addEventListener('pjax:error', (e) => {
    if (e.request.status === 404) {
        pjax.loadUrl('/404.html')
    }
})</script><!-- google adsense--><!-- search--><!-- music--></body></html>
        <script>
            const posts = ["posts/10907/","posts/5993/","posts/51899/","posts/0/","posts/64880/","posts/usehttps/","posts/61408/","posts/29b61e029340/","posts/34e784d46b0a/","posts/d7880d8f2f2e/","posts/58283ae7cb2d/","posts/b0c241b3d4cf/","posts/da74aa8e9f3b/","posts/d863527924a0/","posts/247db5136c67/","posts/818482b58c2a/","posts/0e24283556b2/","posts/d8eb45be176b/","posts/8fd9ab7c695f/","posts/4a74e5f5d3d6/","posts/e31df0f4a5f0/","posts/e3e3aee8476b/","posts/d7ea97fbec36/","posts/2024g10/","posts/f29c63b83721/","posts/6e1ed0060e67/","posts/536c11d1caa5/","posts/337e148b3fb3/","posts/2c9570b00976/","posts/d586aba908b5/","posts/5790301d4de2/","posts/96dff400cced/","posts/c8b013b915a1/","posts/bc16e0702e1d/","posts/a5bf365fe3fe/","posts/bd7f49a3fa80/","posts/c6072bab6ff0/","posts/59a4f8f59f45/","posts/823c297f1d7f/","posts/1cc3941f1b85/","posts/54404/","posts/d742d8349fff/","posts/d9709c673656/","posts/5c54bd2bc06c/","posts/df4c31f7ba80/","posts/b4ca7a5fb5b2/","posts/24484/","posts/5953/","posts/5181/","posts/1fd1cabe051b/","posts/49793/","posts/4182/","posts/62236/","posts/7287/","posts/61355/","posts/14027/","posts/53666/","posts/17428/","posts/16515/","posts/11458/","posts/6679/","posts/15892/","posts/3472/","posts/56022/","posts/56214/","posts/6999/","posts/55574/","posts/6886/","posts/6615/","posts/44638/","posts/6295/","posts/45431/","posts/30828/","posts/15450/","posts/10536/","posts/49493/","posts/50901/","posts/27853/","posts/63067/","posts/32280/","posts/51449/","posts/2977/","posts/15959/","posts/47792/"];
            function toRandomPost() {
                const randomPost = posts[Math.floor(Math.random() * posts.length)];
                pjax.loadUrl(GLOBAL_CONFIG.root + randomPost);
            }
        </script>