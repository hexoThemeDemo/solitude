<!DOCTYPE html>
<html lang="zh-CN">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="zhywyt" />


    
    


<meta property="og:type" content="website">
<meta property="og:title" content="zhywyt&#39;s blog">
<meta property="og:url" content="https://hexothemedemo.github.io/Yelee/page/7/index.html">
<meta property="og:site_name" content="zhywyt&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="zhywyt">
<meta name="twitter:card" content="summary">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="zhywyt&#39;s blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">



<link rel="stylesheet" href="/Yelee/css/style.css">



    <style> .article { opacity: 0;} </style>


<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>zhywyt&#39;s blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: true,
        isPost: false,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: 
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/Yelee/" class="profilepic">
            <img src="/img/avatar.png" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/Yelee/"></a></h1>
        </hgroup>

        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>èœå•</li>
                        <li>æ ‡ç­¾</li>
                        
                        <li>å‹æƒ…é“¾æ¥</li>
                        
                        
                        <li>å…³äºæˆ‘</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/Yelee/">ä¸»é¡µ</a></li>
                        
                            <li><a href="/Yelee/archives/">æ‰€æœ‰æ–‡ç« </a></li>
                        
                            <li><a href="/Yelee/tags/">æ ‡ç­¾äº‘</a></li>
                        
                            <li><a href="/Yelee/about/">å…³äºæˆ‘</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" href="/Yelee/atom.xml" title="RSS"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/encrypt/" rel="tag">encrypt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E5%8D%9A%E5%AE%A2/" rel="tag">åšå®¢</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E6%8A%80%E6%9C%AF%E6%96%87%E6%A1%A3/" rel="tag">æŠ€æœ¯æ–‡æ¡£</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E8%AF%97%E4%B8%8E%E6%95%A3%E6%96%87/" rel="tag">è¯—ä¸æ•£æ–‡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/Yelee/tags/%E9%94%99%E8%AF%AF%E8%A7%A3%E5%86%B3/" rel="tag">é”™è¯¯è§£å†³</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" target="_blank" rel="noopener" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">ä¸“æ³¨äºå‰ç«¯</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="å›åˆ°ä¸»é¡µ"></a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/Yelee/" class="profilepic">
                <img src="/img/avatar.png" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/Yelee/" title="å›åˆ°ä¸»é¡µ"></a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/Yelee/">ä¸»é¡µ</a></li>
                
                    <li><a href="/Yelee/archives/">æ‰€æœ‰æ–‡ç« </a></li>
                
                    <li><a href="/Yelee/tags/">æ ‡ç­¾äº‘</a></li>
                
                    <li><a href="/Yelee/about/">å…³äºæˆ‘</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:123@123.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="#" title="GitHub"></a>
                            
                                <a class="fa RSS" target="_blank" href="/Yelee/atom.xml" title="RSS"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="æ ‡ç­¾" friends="å‹æƒ…é“¾æ¥" about="å…³äºæˆ‘"/>
</nav>
      <div class="body-wrap">
  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork7" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/6679/" class="article-date">
      <time datetime="2023-08-03T22:17:00.000Z" itemprop="datePublished">2023-08-03</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/6679/">games101 HomeWork7</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="Games101-HomeWork7"><a href="#Games101-HomeWork7" class="headerlink" title="Games101 HomeWork7"></a>Games101 HomeWork7</h1><h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><p><strong>è¿™æ¬¡çš„ä½œä¸šï¼Œæˆ‘æƒ³å…ˆæ•™å¤§å®¶å®ç°å¤šçº¿ç¨‹ï¼Œå†è¿›è¡Œæ“ä½œã€‚å¤šçº¿ç¨‹å¤šæˆ‘çš„å¸å¼•åŠ›å®åœ¨æ˜¯å¤ªå¤§äº†ã€‚åºŸè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹ï¼š</strong></p>
<p><strong>å¤šçº¿ç¨‹ä¸»è¦æ˜¯åœ¨Renderä¸­è¿›è¡Œçš„</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Renderer::Render</span><span class="params">(<span class="type">const</span> Scene&amp; scene)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Vector3f&gt; <span class="title function_">framebuffer</span><span class="params">(scene.width * scene.height)</span>;</span><br><span class="line">    <span class="type">bool</span> IsUseMultiThread=<span class="literal">true</span>;</span><br><span class="line">    <span class="type">int</span> spp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(!IsUseMultiThread)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">float</span> scale = <span class="built_in">tan</span>(deg2rad(scene.fov * <span class="number">0.5</span>));</span><br><span class="line">        <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line">        Vector3f <span class="title function_">eye_pos</span><span class="params">(<span class="number">278</span>, <span class="number">273</span>, <span class="number">-800</span>)</span>;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// change the spp value to change sample ammount</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;SPP: &quot;</span> &lt;&lt; spp &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> j = <span class="number">0</span>; j &lt; scene.height; ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; scene.width; ++i) &#123;</span><br><span class="line">                <span class="comment">// generate primary ray direction</span></span><br><span class="line">                <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                        imageAspectRatio * scale;</span><br><span class="line">                <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">                Vector3f dir = normalize(Vector3f(-x, y, <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++)&#123;</span><br><span class="line">                    framebuffer[m] += scene.castRay(Ray(eye_pos, dir), <span class="number">0</span>) / spp;  </span><br><span class="line">                &#125;</span><br><span class="line">                m++;</span><br><span class="line">            &#125;</span><br><span class="line">            UpdateProgress(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">        &#125;</span><br><span class="line">        UpdateProgress(<span class="number">1.f</span>);</span><br><span class="line">                <span class="comment">// save framebuffer to file</span></span><br><span class="line">        <span class="built_in">string</span> filename =<span class="string">&quot;binaryWithoutMultiThread&quot;</span>;</span><br><span class="line">        filename +=<span class="built_in">std</span>::to_string(<span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::seconds&gt;(<span class="built_in">std</span>::chrono::system_clock::now()-start).count())+<span class="string">&quot;.ppm&quot;</span>;</span><br><span class="line">        FILE* fp = fopen(filename.c_str() , <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">        (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i) &#123;</span><br><span class="line">            <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">            color[<span class="number">0</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x), <span class="number">0.6f</span>));</span><br><span class="line">            color[<span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y), <span class="number">0.6f</span>));</span><br><span class="line">            color[<span class="number">2</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z), <span class="number">0.6f</span>));</span><br><span class="line">            fwrite(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">        &#125;</span><br><span class="line">        fclose(fp); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿™æ˜¯Renderçš„åŸä»£ç ï¼Œæˆ‘éœ€è¦åŠ é€Ÿçš„åœ°æ–¹æ˜¯å¯¹æ¯ä¸€ä¸ªåƒç´ ç€è‰²çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªforå¾ªç¯ã€‚é¦–å…ˆæˆ‘ä»¬æŠŠforå¾ªç¯æ”¹æˆå•å±‚çš„ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">uint32_t</span> p = <span class="number">0</span>; p &lt; hxw; ++p)</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="type">int</span> i = p % scene.height;</span><br><span class="line">             <span class="type">int</span> j = p / scene.height;</span><br><span class="line">             <span class="comment">// generate primary ray direction</span></span><br><span class="line">             <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                       imageAspectRatio * scale;</span><br><span class="line">             <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">             Vector3f dir = normalize(Vector3f(-x, y, <span class="number">1</span>));</span><br><span class="line">             <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++)</span><br><span class="line">             &#123;</span><br><span class="line">                 framebuffer[p] += scene.castRay(Ray(eye_pos, dir), <span class="number">0</span>) / spp;</span><br><span class="line">             &#125;</span><br><span class="line">             pocess++;</span><br><span class="line">                 UpdateProgress(pocess / (<span class="type">float</span>)(scene.height * scene.width));</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç„¶ååŠ å…¥è¿™å‡ ä¸ªå¤´æ–‡ä»¶ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;omp.h&gt;</span></span></span><br><span class="line"><span class="comment">//linux library for getting cpu num</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;unistd.h&quot;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>å¹¶åœ¨<code>CMakeLists.txt</code>ä¸­åŠ ä¸Šè¿™å¥è¯ï¼š</strong></p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//è¿™æ˜¯ä¿®æ”¹åçš„CmakeList.txt</span><br><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.10</span>)</span><br><span class="line"><span class="keyword">project</span>(RayTracing)</span><br><span class="line"></span><br><span class="line">// DIY</span><br><span class="line"><span class="keyword">FIND_PACKAGE</span>( OpenMP REQUIRED)</span><br><span class="line"><span class="keyword">if</span>(OPENMP_FOUND)</span><br><span class="line">    <span class="keyword">message</span>(<span class="string">&quot;OPENMP FOUND&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_C_FLAGS <span class="string">&quot;$&#123;CMAKE_C_FLAGS&#125; $&#123;OpenMP_C_FLAGS&#125;&quot;</span>)</span><br><span class="line">    <span class="keyword">set</span>(CMAKE_CXX_FLAGS <span class="string">&quot;$&#123;CMAKE_CXX_FLAGS&#125; $&#123;OpenMP_CXX_FLAGS&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line">//DIY</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(<span class="variable">$&#123;PROJECT_NAME&#125;</span> main.cpp Object.hpp Vector.cpp Vector.hpp Sphere.hpp global.hpp Triangle.hpp Scene.cpp</span><br><span class="line">        Scene.hpp Light.hpp AreaLight.hpp BVH.cpp BVH.hpp Bounds3.hpp Ray.hpp Material.hpp Intersection.hpp</span><br><span class="line">        Renderer.cpp Renderer.hpp)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>ç„¶ååœ¨<code>Render</code>ä¸­ä½¿ç”¨<code>int cpuNum= sysconf(_SC_NPROCESSORS_CONF);</code>è·å–ä½ ç”µè„‘çš„CPUæ•°é‡ï¼Œå¹¶ä¿å­˜èµ·æ¥ï¼Œç„¶åä½¿ç”¨<code>omp_set_num_threads(cpuNum);</code>è®¾ç½®ä½ çš„çº¿ç¨‹æ•°é‡ä¸ºä½ çš„CPUæ•°é‡ã€‚</strong><br><strong>ç„¶åä¾¿æ˜¯æœ€ç²¾å½©çš„éƒ¨åˆ†äº†ï¼Œé¦–å…ˆæˆ‘ä»¬ç›´æ¥ä½¿ç”¨</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> omp parallel for</span></span><br></pre></td></tr></table></figure>

<p><strong>æ¥å¤šçº¿ç¨‹å¯åŠ¨è¿™å¥å‘½ä»¤ä¸‹çš„ä¸€ä¸ªforå¾ªç¯ã€‚åƒè¿™æ ·ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> omp parallel for shared(pocess)</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> p = <span class="number">0</span>; p &lt; hxw; ++p)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> i = p % scene.height;</span><br><span class="line">        <span class="type">int</span> j = p / scene.height;</span><br><span class="line">        <span class="comment">// generate primary ray direction</span></span><br><span class="line">        <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                  imageAspectRatio * scale;</span><br><span class="line">        <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">        Vector3f dir = normalize(Vector3f(-x, y, <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++)</span><br><span class="line">        &#123;</span><br><span class="line">            framebuffer[p] += scene.castRay(Ray(eye_pos, dir), <span class="number">0</span>) / spp;</span><br><span class="line">        &#125;</span><br><span class="line">        pocess++;</span><br><span class="line">            UpdateProgress(pocess / (<span class="type">float</span>)(scene.height * scene.width));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä½†æ˜¯æˆ‘ä»¬å¾—åˆ°çš„è¿›åº¦æ¡éå¸¸çš„æŠ½è±¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨è¿›ç¨‹é”ğŸ”“æ¥é˜²æ­¢è¿™ç§æƒ…å†µã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230801160851689-764548952_1726323797901.png" alt="image"><br><strong>criticalæŒ‡ä»¤ç”¨äºä¿è¯å…¶ç›¸å…³è”çš„ä»£ç åªåœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚æˆ‘ä»¬åœ¨<code>UpdateProgress</code>ä¹‹å‰åŠ ä¸Šè¿™ä¸€å¥è¯ï¼š <code>#pragma omp critical</code>è¿™æ ·å°±å¾—åˆ°äº†æ­£ç¡®çš„è¿›åº¦æ¡ã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230801161449641-2134881657_1726323797901.png" alt="image"><br><strong>è¿™ä¸€æ­¥å¾ˆé‡è¦ï¼Œè¯·ç¡®ä¿ä½ å®Œæˆäº†è¿™ä¸€æ­¥ï¼Œå†è¿›è¡Œä¸‹é¢çš„æ“ä½œã€‚ä¸ç„¶ä½ æ²¡æ¬¡çš„è¿è¡Œæ—¶é—´å¯èƒ½è¾¾åˆ°3-5minsã€‚è¿™é‡Œæ˜¯ä¿®æ”¹åçš„<code>Render</code>å‡½æ•°ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Renderer::Render</span><span class="params">(<span class="type">const</span> Scene &amp;scene)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Vector3f&gt; <span class="title function_">framebuffer</span><span class="params">(scene.width * scene.height)</span>;</span><br><span class="line">    <span class="type">float</span> scale = <span class="built_in">tan</span>(deg2rad(scene.fov * <span class="number">0.5</span>));</span><br><span class="line">    <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line">    Vector3f <span class="title function_">eye_pos</span><span class="params">(<span class="number">278</span>, <span class="number">273</span>, <span class="number">-800</span>)</span>;</span><br><span class="line">    <span class="type">bool</span> IsUseMultiThread = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">string</span> filename = <span class="string">&quot;binary&quot;</span>;</span><br><span class="line">    <span class="type">int</span> spp = <span class="number">1</span>;<span class="comment">//æŠŠsppæ”¹ä¸º1,ä¸ç„¶ä¼šè·‘çš„å¾ˆæ…¢ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</span></span><br><span class="line">    <span class="keyword">if</span> (!IsUseMultiThread)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// change the spp value to change sample ammount</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;SPP: &quot;</span> &lt;&lt; spp &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// generate primary ray direction</span></span><br><span class="line">                <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                          imageAspectRatio * scale;</span><br><span class="line">                <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">                Vector3f dir = normalize(Vector3f(-x, y, <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++)</span><br><span class="line">                &#123;</span><br><span class="line">                    framebuffer[m] += scene.castRay(Ray(eye_pos, dir), <span class="number">0</span>) / spp;</span><br><span class="line">                &#125;</span><br><span class="line">                m++;</span><br><span class="line">            &#125;</span><br><span class="line">            UpdateProgress(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">        &#125;</span><br><span class="line">        UpdateProgress(<span class="number">1.f</span>);</span><br><span class="line">        filename += <span class="string">&quot;_WithOut_&quot;</span> + <span class="built_in">std</span>::to_string(<span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::seconds&gt;(<span class="built_in">std</span>::chrono::system_clock::now() - start).count());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// change the spp value to change sample ammount</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;SPP: &quot;</span> &lt;&lt; spp &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">        <span class="type">int</span> cpuNum = sysconf(_SC_NPROCESSORS_CONF);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Cpu Num :&quot;</span> &lt;&lt; cpuNum &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        omp_set_num_threads(cpuNum);</span><br><span class="line">        <span class="comment">// int handle[cpuNum];</span></span><br><span class="line">        <span class="type">float</span> minY = <span class="number">0.0f</span>, maxY = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="type">int</span> hxw = scene.width * scene.height;</span><br><span class="line">        <span class="type">long</span> <span class="type">long</span> pocess =<span class="number">0</span>;</span><br><span class="line">        <span class="meta">#<span class="keyword">pragma</span> omp parallel for shared(pocess)</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> p = <span class="number">0</span>; p &lt; hxw; ++p)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">int</span> i = p % scene.height;</span><br><span class="line">            <span class="type">int</span> j = p / scene.height;</span><br><span class="line">            <span class="comment">// generate primary ray direction</span></span><br><span class="line">            <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                      imageAspectRatio * scale;</span><br><span class="line">            <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">            Vector3f dir = normalize(Vector3f(-x, y, <span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++)</span><br><span class="line">            &#123;</span><br><span class="line">                framebuffer[p] += scene.castRay(Ray(eye_pos, dir), <span class="number">0</span>) / spp;</span><br><span class="line">            &#125;</span><br><span class="line">            pocess++;</span><br><span class="line">            <span class="meta">#<span class="keyword">pragma</span> omp critical</span></span><br><span class="line">            UpdateProgress(pocess / (<span class="type">float</span>)(scene.height * scene.width));</span><br><span class="line">        &#125;</span><br><span class="line">        minY = maxY + <span class="number">1.0f</span>;</span><br><span class="line">        UpdateProgress(<span class="number">1.f</span>);</span><br><span class="line">        filename += <span class="string">&quot;_With_&quot;</span> + <span class="built_in">std</span>::to_string(<span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::seconds&gt;(<span class="built_in">std</span>::chrono::system_clock::now() - start).count());</span><br><span class="line">    &#125;</span><br><span class="line">    filename += <span class="string">&quot;.ppm&quot;</span>;</span><br><span class="line">    <span class="comment">// save framebuffer to file</span></span><br><span class="line">    FILE *fp = fopen(filename.c_str(), <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">        color[<span class="number">0</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x), <span class="number">0.6f</span>));</span><br><span class="line">        color[<span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y), <span class="number">0.6f</span>));</span><br><span class="line">        color[<span class="number">2</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z), <span class="number">0.6f</span>));</span><br><span class="line">        fwrite(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><code>æ³¨æ„ï¼šè¯·ä¸è¦ç›´æ¥å¤åˆ¶æˆ‘çš„ä»£ç ï¼Œå†™å…¥æ–‡ä»¶çš„éƒ¨åˆ†æˆ‘è¿˜åšäº†ä¸€äº›ä¿®æ”¹</code></strong></p>
<p><strong><code>ç›´æ¥å¤åˆ¶æ˜¯è·‘ä¸èµ·æ¥çš„ï¼Œä½ åº”è¯¥è‡ªå·±å†™ä¸€éå¤šçº¿ç¨‹çš„æµç¨‹ã€‚å¹¶å°†æ–‡ä»¶å†™å…¥æ”¹å›ä½ è‡ªå·±æƒ³è¦çš„ç‰ˆæœ¬ã€‚</code></strong><br><strong>å½“ç„¶ï¼Œç”±äºä½ è¿˜æ²¡æœ‰å†™CastRayï¼Œå’Œå¾ˆå¤šå‡½æ•°ï¼Œæ‰€ä»¥ä½ åªèƒ½å¾—åˆ°è¿™æ ·çš„å›¾ç‰‡ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230801162303914-1466620220_1726323797901.png" alt="image"></p>
<h2 id="å‰ç½®ä»»åŠ¡"><a href="#å‰ç½®ä»»åŠ¡" class="headerlink" title="å‰ç½®ä»»åŠ¡"></a>å‰ç½®ä»»åŠ¡</h2><ul>
<li><strong>Triangle::getIntersection in Triangle.hpp: å°†ä½ çš„å…‰çº¿-ä¸‰è§’å½¢ç›¸äº¤å‡½æ•°ç²˜è´´åˆ°æ­¤å¤„ï¼Œè¯·ç›´æ¥å°†ä¸Šæ¬¡å®éªŒä¸­å®ç°çš„å†…å®¹ç²˜è´´åœ¨æ­¤ã€‚</strong></li>
<li><strong>IntersectP(const Ray&amp; ray, const Vector3f&amp; invDir,const std::array&lt;int, 3&gt;&amp; dirIsNeg) in the Bounds3.hpp: è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ¤æ–­åŒ…å›´ç›’BoundingBox ä¸å…‰çº¿æ˜¯å¦ç›¸äº¤ï¼Œè¯·ç›´æ¥å°†ä¸Šæ¬¡å®éªŒä¸­å®ç°çš„å†…å®¹ç²˜è´´åœ¨æ­¤å¤„ï¼Œå¹¶ä¸”æ³¨æ„æ£€æŸ¥ t_enter &#x3D; t_exit çš„æ—¶å€™çš„åˆ¤æ–­æ˜¯å¦æ­£ç¡®ã€‚</strong></li>
<li><strong><em>getIntersection ( BVHBuildNode</em> node, const Ray ray)in BVH.cpp: BVHæŸ¥æ‰¾è¿‡ç¨‹ï¼Œè¯·ç›´æ¥å°†ä¸Šæ¬¡å®éªŒä¸­å®ç°çš„å†…å®¹ç²˜è´´åœ¨æ­¤å¤„</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Triangle.hpp</span></span><br><span class="line"><span class="keyword">inline</span> Intersection <span class="title function_">Triangle::getIntersection</span><span class="params">(Ray ray)</span></span><br><span class="line">&#123;</span><br><span class="line">    Intersection inter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (dotProduct(ray.direction, normal) &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    <span class="type">double</span> u, v, t_tmp = <span class="number">0</span>;</span><br><span class="line">    Vector3f pvec = crossProduct(ray.direction, e2);</span><br><span class="line">    <span class="type">double</span> det = dotProduct(e1, pvec);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(det) &lt; EPSILON)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> det_inv = <span class="number">1.</span> / det;</span><br><span class="line">    Vector3f tvec = ray.origin - v0;</span><br><span class="line">    u = dotProduct(tvec, pvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (u &lt; <span class="number">0</span> || u &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    Vector3f qvec = crossProduct(tvec, e1);</span><br><span class="line">    v = dotProduct(ray.direction, qvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (v &lt; <span class="number">0</span> || u + v &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    t_tmp = dotProduct(e2, qvec) * det_inv;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO find ray triangle intersection</span></span><br><span class="line">    <span class="keyword">if</span>(t_tmp&lt;<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    inter.distance=t_tmp;</span><br><span class="line">    inter.happened=<span class="literal">true</span>;</span><br><span class="line">    inter.normal= this-&gt;normal;</span><br><span class="line">    inter.coords=ray(t_tmp);</span><br><span class="line">    inter.obj=this;</span><br><span class="line">    inter.m=this-&gt;m;</span><br><span class="line">    <span class="keyword">return</span> inter;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Bounds3.hpp</span></span><br><span class="line"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title function_">Bounds3::IntersectP</span><span class="params">(<span class="type">const</span> Ray &amp;ray, <span class="type">const</span> Vector3f &amp;invDir,</span></span><br><span class="line"><span class="params">                                <span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="type">int</span>, <span class="number">3</span>&gt; &amp;dirIsNeg)</span> <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// invDir: ray direction(x,y,z), invDir=(1.0/x,1.0/y,1.0/z), use this because Multiply is faster that Division</span></span><br><span class="line">    <span class="comment">// dirIsNeg: ray direction(x,y,z), dirIsNeg=[int(x&gt;0),int(y&gt;0),int(z&gt;0)], use this to simplify your logic</span></span><br><span class="line">    <span class="comment">// TODO test if ray bound intersects</span></span><br><span class="line">    Vector3f t_minTemp = (pMin - ray.origin) * invDir;</span><br><span class="line">    Vector3f t_maxTemp = (pMax - ray.origin) * invDir;</span><br><span class="line">    Vector3f t_min = Vector3f::Min(t_minTemp, t_maxTemp);</span><br><span class="line">    Vector3f t_max = Vector3f::Max(t_minTemp, t_maxTemp);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> t_min_time = <span class="built_in">std</span>::max(t_min.x, <span class="built_in">std</span>::max(t_min.y, t_min.z));</span><br><span class="line">    <span class="type">float</span> t_max_time = <span class="built_in">std</span>::min(t_max.x, <span class="built_in">std</span>::min(t_max.y, t_max.z));</span><br><span class="line">    <span class="keyword">return</span> t_max_time &gt;= -<span class="built_in">std</span>::numeric_limits&lt;<span class="type">float</span>&gt;::epsilon() &amp;&amp; t_min_time &lt;= t_max_time;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//BVH.cpp</span></span><br><span class="line">Intersection <span class="title function_">BVHAccel::getIntersection</span><span class="params">(BVHBuildNode* node, <span class="type">const</span> Ray&amp; ray)</span> <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// TODO Traverse the BVH to find intersection</span></span><br><span class="line">    Intersection intersect;</span><br><span class="line">    Vector3f <span class="title function_">invdir</span><span class="params">(<span class="number">1.</span>/ray.direction.x,<span class="number">1.</span>/ray.direction.y,<span class="number">1.</span>/ray.direction.z)</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="type">int</span>, <span class="number">3</span>&gt; dirIsNeg;</span><br><span class="line">    dirIsNeg[<span class="number">0</span>] = ray.direction.x&gt;<span class="number">0</span>;</span><br><span class="line">    dirIsNeg[<span class="number">1</span>] = ray.direction.y&gt;<span class="number">0</span>;</span><br><span class="line">    dirIsNeg[<span class="number">2</span>] = ray.direction.z&gt;<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!node || !node-&gt;bounds.IntersectP(ray,ray.direction_inv,dirIsNeg))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> intersect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!node-&gt;right &amp;&amp; !node-&gt;left)</span><br><span class="line">        <span class="keyword">return</span> node-&gt;object-&gt;getIntersection(ray);</span><br><span class="line"></span><br><span class="line">    Intersection isect2= getIntersection(node-&gt;left,ray);</span><br><span class="line">    Intersection isect1= getIntersection(node-&gt;right,ray);</span><br><span class="line">    <span class="keyword">return</span> isect1.distance &lt; isect2.distance ? isect1:isect2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å†æ¬¡è¿è¡Œï¼Œä½ åº”è¯¥èƒ½å¾—åˆ°é»‘è‰²çš„å›¾äº†ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802134815106-1901650531_1726323819786.png" alt="image"></p>
<h2 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a>ä»»åŠ¡</h2><p><strong>åœ¨æœ¬æ¬¡å®éªŒä¸­ï¼Œä½ åªéœ€è¦ä¿®æ”¹è¿™ä¸€ä¸ªå‡½æ•°:</strong></p>
<ul>
<li><strong><code>castRay(const Ray ray, int depth)</code>in Scene.cpp: åœ¨å…¶ä¸­å®ç°Path Trac-ing ç®—æ³•</strong></li>
</ul>
<h2 id="CastRay"><a href="#CastRay" class="headerlink" title="CastRay()"></a>CastRay()</h2><p><strong>æˆ‘ä¸ä¼šæŒ‰ç€åŸç†æ¥è®²è¿™ä¸ªä¸œè¥¿ï¼Œé—«ä»¤çªå¤§ç¥å·²ç»è®²çš„å¤Ÿå¥½äº†ï¼Œæˆ‘æŒ‰ç…§ç®—æ³•çš„é¡ºåºæ¥é‡æ–°è®²ä¸€ä¸‹è¿™ä¸ªäº‹æƒ…ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802103528436-1695545794_1726323819786.png" alt="image"><br><strong>é‚£ä¹ˆæˆ‘ä»¬ç›´å¥”ä¸»é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬å›å¿†ä¸€ä¸‹æˆ‘ä»¬çš„Path Tracing åœ¨åšçš„æ˜¯ä¸€ä»¶ä»€ä¹ˆæ ·çš„äº‹æƒ…ï¼š</strong><br><strong>æˆ‘ä»¬è¦æ¸²æŸ“ä¸€ä¸ªç‚¹çš„é¢œè‰²ï¼Œè¦çŸ¥é“å“ªäº›å…‰æºçš„å…‰çº¿ä¼šåå°„åˆ°ä»–èº«ä¸Šï¼Œä¹Ÿè¦çŸ¥é“é‚£äº›å“ªä½“çš„å…‰çº¿ä¼šåå°„åˆ°ä»–èº«ä¸Šã€‚</strong><br><strong>é¦–å…ˆåˆ¤æ–­å…‰çº¿ï¼ˆåƒç´ å‘å‡ºï¼‰æ˜¯å¦ä¼šä¸ç‰©ä½“ç›¸äº¤ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intersection intersToScene = Scene::intersect(ray);<span class="comment">//è¿™æ˜¯æˆ‘ä»¬è·å–çš„ç¢°æ’ä½“</span></span><br><span class="line"><span class="keyword">if</span> (!intersToScene.happened)<span class="comment">//å¦‚æœè¿”å›çš„ç¢°æ’ä½“æ²¡æœ‰å‘ç”Ÿç¢°æ’ï¼Œè¿”å›0</span></span><br><span class="line">    <span class="keyword">return</span> Vector3f();</span><br></pre></td></tr></table></figure>

<p><strong>è¿™å¥ä¹‹åçš„è¯´æ˜å·²ç»å‘ç”Ÿäº†ç¢°æ’</strong><br><strong>æˆ‘ä»¬åˆ©ç”¨RR(ä¿„ç½—æ–¯è½®ç›˜èµŒ)æ¥ä¿è¯æœŸæœ›çœŸå®çš„æƒ…å†µä¸‹ï¼Œè®¾ç«‹å…‰çº¿åå°„å‡ºå£ï¼š</strong><br><strong>å¯¹åº”åˆ°ä»£ç æ˜¯è¿™æ ·çš„ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//RR</span></span><br><span class="line"><span class="keyword">if</span>(get_random_float()&gt;RussianRoulette)</span><br><span class="line">        <span class="keyword">return</span> Vector3f(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><strong>æ¥ç€æˆ‘ä»¬éœ€è¦å¯¹å…‰æºè¿›è¡Œé‡‡æ ·ï¼Œè®¡ç®—ä¹‹åé€’å½’éœ€è¦çš„ä¸€ç³»åˆ—æ•°å€¼ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Vector3f L_dir = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, L_indir = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="comment">// Calculate the Intersection from point to light in order to calculate direct Color</span></span><br><span class="line">Intersection LightPos;</span><br><span class="line"><span class="type">float</span> lightpdf = <span class="number">0.0f</span>;</span><br><span class="line">sampleLight(LightPos, lightpdf);<span class="comment">//å¼•ç”¨ä¼ å‚ï¼Œå¾—åˆ°LightPoså’Œlightpdfã€‚å¾—åˆ°å…‰æºé‡‡æ ·ç»“æœ</span></span><br><span class="line">Vector3f LightDir = LightPos.coords - intersToScene.coords;</span><br><span class="line"><span class="type">float</span> dis = dotProduct(LightDir, LightDir);</span><br><span class="line">Vector3f LightDirNormal = LightDir.normalized();</span><br><span class="line">Ray <span class="title function_">rayToLight</span><span class="params">(intersToScene.coords, LightDirNormal)</span>;<span class="comment">//ç”¨ç‚¹çš„ä½ç½®å’Œæ–¹å‘åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">Intersection interToLight = Scene::intersect(rayToLight);<span class="comment">//è®¡ç®—å¾—åˆ°çš„å…‰çº¿ä¼šå’Œä»€ä¹ˆç›¸äº¤</span></span><br><span class="line"><span class="keyword">auto</span> f_r = intersToScene.m-&gt;eval(ray.direction, LightDirNormal, intersToScene.normal);<span class="comment">//è®¡ç®—BRDF</span></span><br></pre></td></tr></table></figure>

<p><strong>ç„¶ååˆ¤æ–­ç€è‰²ç‚¹åˆ°å…‰æºæ˜¯å¦æœ‰é˜»ç¢</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (interToLight.distance - LightDir.norm() &gt; <span class="number">-0.005</span>)<span class="comment">//å¦‚æœåå°„å…‰çº¿åˆ°ç¬¬ä¸€ä¸ªç‰©ä½“çš„è·ç¦»æ¯”ä¸¤ç‚¹è¿çº¿å¤§ï¼ˆæˆ–è€…ç›¸ç­‰ï¼Œå¤„ç†æµ®ç‚¹ç›¸ç­‰å›°éš¾é—®é¢˜ï¼‰ï¼Œè¯´æ˜ä¸­é—´æ²¡æœ‰é˜»ç¢</span></span><br><span class="line">&#123;</span><br><span class="line">    L_dir = LightPos.emit * f_r * dotProduct(LightDirNormal, intersToScene.normal) * dotProduct(-LightDirNormal, LightPos.normal) / dis / lightpdf / RussianRoulette;<span class="comment">//ç…§ç€å…¬å¼æŠ„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¥ç€è®¡ç®—å…¶ä»–ç‰©ä½“çš„è¾å°„ï¼Œå¯¹ç€è‰²ç‚¹è¿›è¡Œç«‹ä½“è§’é‡‡æ ·ï¼Œå¾—åˆ°å‡ºå°„æ–¹å‘ï¼Œå¹¶è®¡ç®—å‡ºå°„å…‰çº¿ä¸å…¶ä»–ç‰©ä½“çš„æ±‚äº¤ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vector3f wi = intersToScene.m-&gt;sample(ray.direction, intersToScene.normal).normalized();</span><br><span class="line">   <span class="comment">// Ray indirRay = Ray(intersToScene.coords, wi);</span></span><br><span class="line">   Ray <span class="title function_">indirRay</span><span class="params">(intersToScene.coords, wi)</span>;</span><br><span class="line">   Intersection intersToPoint = Scene::intersect(indirRay);</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚æœç›¸äº¤äº†ï¼Œè€Œä¸”è¿™ä¸ªç‚¹ä¸æ˜¯å…‰æºï¼Œè®¡ç®—åç»­èƒ½é‡ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (intersToPoint.happened &amp;&amp; !intersToPoint.m-&gt;hasEmission())</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="type">float</span> pdf = intersToScene.m-&gt;pdf(ray.direction, wi, intersToScene.normal);</span><br><span class="line">       L_indir = castRay(indirRay, depth + <span class="number">1</span>) * intersToScene.m-&gt;eval(ray.direction, wi, intersToScene.normal) * dotProduct(wi, intersToScene.normal) / RussianRoulette / pdf;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p><strong>æœ€åè¿”å›å…‰æºå’Œç‰©ä½“åå°„é¢œè‰²çš„å’Œï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> L_dir + L_indir;</span><br></pre></td></tr></table></figure>

<p><strong>ç¼–è¯‘è¿è¡Œï¼Œä½ åº”å½“å¾—åˆ°è¿™æ ·çš„å›¾ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802150628811-1071149791_1726323819786.png" alt="image"><br><strong>æ²¡æœ‰ç¯ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå½“æˆ‘ä»¬çœ‹å‘å…‰æºçš„æ—¶å€™ï¼Œåº”è¯¥åŠ ä¸Šå…‰æºçš„é¢œè‰²ï¼Œç¨å¾®ä¿®æ”¹ä»£ç ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Intersection intersToScene = Scene::intersect(ray);</span><br><span class="line"><span class="keyword">if</span> (!intersToScene.happened)</span><br><span class="line">    <span class="keyword">return</span> Vector3f();</span><br><span class="line">Vector3f L_dir = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, L_indir = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">if</span> (intersToScene.m-&gt;hasEmission())</span><br><span class="line">    L_dir+=intersToScene.m-&gt;getEmission();</span><br><span class="line">Intersection LightPos;</span><br><span class="line"><span class="type">float</span> lightpdf = <span class="number">0.0f</span>;</span><br><span class="line">sampleLight(LightPos, lightpdf);</span><br><span class="line">Vector3f LightDir = LightPos.coords - intersToScene.coords;</span><br><span class="line"><span class="type">float</span> dis = dotProduct(LightDir, LightDir);</span><br><span class="line">Vector3f LightDirNormal = LightDir.normalized();</span><br><span class="line">Ray <span class="title function_">rayToLight</span><span class="params">(intersToScene.coords, LightDirNormal)</span>;</span><br><span class="line">Intersection interToLight = Scene::intersect(rayToLight);</span><br><span class="line"><span class="keyword">auto</span> f_r = intersToScene.m-&gt;eval(ray.direction, LightDirNormal, intersToScene.normal);</span><br><span class="line"><span class="keyword">if</span> (interToLight.distance - LightDir.norm() &gt; <span class="number">-0.005</span>)</span><br><span class="line">&#123;</span><br><span class="line">    L_dir += LightPos.emit * f_r * dotProduct(LightDirNormal, intersToScene.normal) * dotProduct(-LightDirNormal, LightPos.normal) / dis / lightpdf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åé¢ä»£ç ä¸åŠ¨</span></span><br></pre></td></tr></table></figure>

<p><strong>å†æ¬¡ç¼–è¯‘è¿è¡Œï¼Œå¾—åˆ°ç»“æœï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802150949128-1492910775_1726323819786.png" alt="image"><br><strong>å¯¹æ¯”ä¸€ä¸‹å§ï½</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802151116645-1848516766_1726323819786.png" alt="image"><br><strong>ä½ ä¼šå‘ç°æˆ‘ä»¬çš„å™ªç‚¹éå¸¸çš„å¤šï¼Œä¿®æ”¹SPPå€¼ï¼Œå†è¿è¡Œå‡ æ¬¡å§ï½ä¸‹é¢æ˜¯æˆ‘çš„ç”µè„‘çš„è¿è¡Œæ—¶é—´å’Œç»“æœï¼Œä½ å¯ä»¥ä½œä¸ºå‚è€ƒï¼š</strong></p>
<table>
<thead>
<tr>
<th align="center">SPP(æ— ç‰¹æ®Šæ ‡è®°ä¸º784$\times$784)åˆ†è¾¨ç‡</th>
<th align="center">time(min&#x2F; s)(åˆ†é’Ÿæˆ–è€…ç§’)</th>
<th align="center">image</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">(0, 15)</td>
<td align="center"><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802160213047-1549007939_1726323894432.png" alt="image"></td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">(0, 56)</td>
<td align="center"><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802160333985-1012829109_1726323894432.png" alt="image"></td>
</tr>
<tr>
<td align="center">8</td>
<td align="center">(1, 114)</td>
<td align="center"><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802160346238-804059572_1726323894432.png" alt="image"></td>
</tr>
<tr>
<td align="center">16</td>
<td align="center">(3, 227)</td>
<td align="center"><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802155744287-176095503_1726323894432.png" alt="image"></td>
</tr>
<tr>
<td align="center">32</td>
<td align="center">(6, 409)</td>
<td align="center"><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802160702955-641269063_1726323894432.png" alt="image"></td>
</tr>
<tr>
<td align="center">128</td>
<td align="center">(26, 1604)</td>
<td align="center"><img src="https://img2023.cnblogs.com/blog/3080748/202308/3080748-20230802160712912-1953443570.png" alt="image"></td>
</tr>
<tr>
<td align="center">128ï¼ˆ1568$\times$1568ï¼‰</td>
<td align="center"></td>
<td align="center"><img src="https://img2023.cnblogs.com/blog/3080748/202308/3080748-20230803170113161-1579656715.png" alt="image"></td>
</tr>
<tr>
<td align="center"><code>æ³¨ï¼šä¸Šé¢çš„å›¾ç‰‡éƒ½å¯ä»¥åœ¨ä»£ç åˆé›†é‡Œçœ‹åˆ°ã€‚</code></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody></table>
<h2 id="Microfacetæè´¨"><a href="#Microfacetæè´¨" class="headerlink" title="Microfacetæè´¨"></a>Microfacetæè´¨</h2><p><strong>å‚è€ƒçŸ¥ä¹æ–‡ç« <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/20119162">åŸºäºç‰©ç†ç€è‰²ï¼ˆäºŒï¼‰- Microfacetæè´¨å’Œå¤šå±‚æè´¨</a>ï¼Œæ¥è‡ª<a target="_blank" rel="noopener" href="https://www.zhihu.com/people/edliu">æ–‡åˆ€ç§‹äºŒ</a>å¤§ç¥ã€‚</strong><br><strong>ä¸æ™®é€šçš„ç€è‰²æ¨¡å‹çš„åŒºåˆ«åœ¨äºï¼Œæ™®é€šçš„ç€è‰²æ¨¡å‹å‡è®¾ç€è‰²çš„åŒºåŸŸæ˜¯ä¸€ä¸ªå¹³æ»‘çš„è¡¨é¢ï¼Œè¡¨é¢çš„æ–¹å‘å¯ä»¥ç”¨ä¸€ä¸ªå•ä¸€çš„æ³•çº¿å‘é‡æ¥å®šä¹‰æ¥å®šä¹‰ã€‚è€ŒMicrofacetæ¨¡å‹åˆ™è®¤ä¸º 1ï¼‰ç€è‰²çš„åŒºåŸŸæ˜¯ä¸€ä¸ªæœ‰æ— æ•°æ¯”å…¥å°„å…‰çº¿è¦†ç›–èŒƒå›´æ›´å°çš„å¾®å°è¡¨é¢ç»„æˆçš„ç²—ç³™åŒºåŸŸã€‚2ï¼‰æ‰€æœ‰è¿™äº›å¾®å°è¡¨é¢éƒ½æ˜¯å…‰æ»‘é•œé¢åå°„çš„è¡¨é¢ã€‚å› ä¸ºè¿™ç§æ¨¡å‹è®¤ä¸ºç€è‰²åŒºåŸŸçš„è¡¨é¢æ˜¯ç”±æ— æ•°æ–¹å‘ä¸åŒçš„å°è¡¨é¢ç»„æˆçš„ï¼Œæ‰€ä»¥åœ¨Microfacetæ¨¡å‹ä¸­ï¼Œç€è‰²åŒºåŸŸå¹¶ä¸èƒ½ç”¨ä¸€ä¸ªæ³•çº¿å‘é‡æ¥è¡¨ç¤ºè¡¨é¢çš„æ–¹å‘ï¼Œåªèƒ½ç”¨ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒå‡½æ•°\(D\)æ¥è®¡ç®—ä»»æ„æ–¹å‘çš„å¾®å°è¡¨é¢åœ¨ç€è‰²åŒºåŸŸä¸­å­˜åœ¨çš„æ¦‚ç‡ã€‚</strong><br><img src="https://img2023.cnblogs.com/blog/3080748/202308/3080748-20230802163316743-844469658.png" alt="image"><br><strong>è¿‘å¹´æ¥æœ‰è®¸å¤šæ–°çš„åˆ†å¸ƒå‡½æ•°è¢«å‘æ˜å‡ºæ¥ä¾‹å¦‚Beckmannï¼ŒGGXç­‰ï¼Œä»–ä»¬çš„èƒ½é‡åˆ†å¸ƒéƒ½æ›´æ¥è¿‘ç”¨å…‰å­¦ä»ªå™¨æµ‹é‡çš„åå°„æ•°æ®ã€‚Disney BRDFä¹Ÿä½¿ç”¨äº†GGXåˆ†å¸ƒã€‚æœ¬æ–‡åé¢çš„æ‰€æœ‰æ¸²æŸ“ç»“æœä¹Ÿä½¿ç”¨äº†GGXã€‚</strong><br><strong>æé«˜é¢˜ç›®é¸½äº†ï¼Œæˆ‘è·‘å‡ºæ¥æ•ˆæœä¸æ˜¯å¾ˆæ˜æ˜¾ï¼Œå…ˆæ”¾ç€äº†ã€‚ä»£ç æ˜¯å†™å¥½äº†çš„ï¼Œå¯ä»¥è‡ªå·±é˜…è¯»ä»£ç å­¦ä¹ ã€‚</strong><br><strong>ä¸‹é¢è¿™å¼ å›¾ç‰‡å°±æ˜¯spp&#x3D;128ï¼Œ1568$\times$1568ä¸‹èŠ±äº†ä¸‰ä¸ªå¤šå°æ—¶è·‘å‡ºæ¥çš„ç»“æœã€‚å…¶ä¸­çƒå’Œå³è¾¹ç»¿è‰²çš„å¢™é¢ä½¿ç”¨äº†Microfacetæè´¨ã€‚</strong><br><img src="https://img2023.cnblogs.com/blog/3080748/202308/3080748-20230803214120780-1005176414.png" alt="image"><br><img src="https://img2023.cnblogs.com/blog/3080748/202308/3080748-20230803213853498-1130479112.png" alt="image"><br><strong>å¯èƒ½æˆ‘å®ç°çš„ä¸€èˆ¬ï¼Œå°½ç®¡æˆ‘ç”¨äº†128çš„sppè¿˜æ˜¯ä¼šæœ‰é‚£ä¹ˆå¤šçš„é»‘è‰²ç‚¹å‡ºç°ï¼Œæˆ–è€…è¿™å°±æ˜¯Microfacetçš„æ•ˆæœï¼Ÿæˆ‘ä¸æ˜ç™½ï¼Œä½†æ˜¯æˆ‘çš„Hw7æ— è®ºå¦‚ä½•éƒ½ç»“æŸäº†ï¼Œæˆ‘èŠ±äº†å¤ªå¤šçš„æ—¶é—´äº†ã€‚ä¸‹ä¸€ä¸ªä½œä¸šï¼Œæˆ‘ä»¬å†è§ï½</strong></p>
<h2 id="ä»£ç æ±‡æ€»"><a href="#ä»£ç æ±‡æ€»" class="headerlink" title="ä»£ç æ±‡æ€»"></a>ä»£ç æ±‡æ€»</h2><p><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/tree/master/Assignment7">zhywyt-github</a></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a href="">ä¸‹ä¸€ç¯‡ï¼š</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17591015.html">ä¸Šä¸€ç¯‡ï¼šå…‰çº¿è¿½è¸ªåŠ é€Ÿ</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/å¤šçº¿ç¨‹ä¹‹OMP" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/15892/" class="article-date">
      <time datetime="2023-08-02T10:28:00.000Z" itemprop="datePublished">2023-08-02</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/15892/">å¤šçº¿ç¨‹ä¹‹OMP</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="è®°å½•åœ¨å­¦ä¹ games101çš„æ—¶å€™ç¢°åˆ°çš„å¤šçº¿ç¨‹çŸ¥è¯†"><a href="#è®°å½•åœ¨å­¦ä¹ games101çš„æ—¶å€™ç¢°åˆ°çš„å¤šçº¿ç¨‹çŸ¥è¯†" class="headerlink" title="è®°å½•åœ¨å­¦ä¹ games101çš„æ—¶å€™ç¢°åˆ°çš„å¤šçº¿ç¨‹çŸ¥è¯†"></a>è®°å½•åœ¨å­¦ä¹ games101çš„æ—¶å€™ç¢°åˆ°çš„å¤šçº¿ç¨‹çŸ¥è¯†</h1><p><code>ä»¥ä¸‹æ‰€æœ‰ç»“æœå‡åœ¨Ubuntu 22.04.2 LTSæ“ä½œç³»ç»Ÿä¸‹ä½¿ç”¨g++ 11.3.0è¿è¡Œ</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802090243483-506907971_1726324278734.png" alt="image"><br><strong>æ‰€æœ‰çš„é—®é¢˜æ¥è‡ªä¸‹é¢è¿™æ®µä»£ç ï¼Œè¿™æ˜¯games101 çš„ç¬¬ä¸ƒæ¬¡ä½œä¸šçš„ä¸€éƒ¨åˆ†ï¼Œéœ€è¦ä½¿ç”¨å¤šçº¿ç¨‹åŠ é€ŸPath Tracing</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> use_critical =<span class="number">0</span>;</span><br><span class="line">      <span class="type">float</span> pocess=<span class="number">0</span>;</span><br><span class="line">      <span class="type">float</span> scale = <span class="built_in">tan</span>(deg2rad(scene.fov * <span class="number">0.5</span>));</span><br><span class="line">      <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line">      Vector3f <span class="title function_">eye_pos</span><span class="params">(<span class="number">278</span>, <span class="number">273</span>, <span class="number">-800</span>)</span>;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;SPP: &quot;</span> &lt;&lt; spp &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">      <span class="type">int</span> cpuNum= sysconf(_SC_NPROCESSORS_CONF);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Cpu Num :&quot;</span> &lt;&lt;cpuNum&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">      omp_set_num_threads(cpuNum);</span><br><span class="line">      <span class="comment">//int handle[cpuNum];</span></span><br><span class="line">      <span class="type">float</span> minY=<span class="number">0.0f</span>,maxY=<span class="number">0.0f</span>;</span><br><span class="line">      <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">      <span class="type">int</span> hxw=scene.width*scene.height;</span><br><span class="line">      <span class="meta">#<span class="keyword">pragma</span> omp parallel for shared(pocess)</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="type">uint32_t</span> p = <span class="number">0</span>; p &lt; hxw; ++p)</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="type">int</span> i = p % scene.height;</span><br><span class="line">              <span class="type">int</span> j = p / scene.height;</span><br><span class="line">              <span class="comment">// generate primary ray direction</span></span><br><span class="line">              <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                        imageAspectRatio * scale;</span><br><span class="line">              <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">              Vector3f dir = normalize(Vector3f(-x, y, <span class="number">1</span>));</span><br><span class="line">              <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++)</span><br><span class="line">              &#123;</span><br><span class="line">                  framebuffer[p] += scene.castRay(Ray(eye_pos, dir), <span class="number">0</span>) / spp;</span><br><span class="line">              &#125;</span><br><span class="line">              pocess++;</span><br><span class="line">              <span class="meta">#<span class="keyword">pragma</span> omp critical </span></span><br><span class="line">                  UpdateProgress(pocess / (<span class="type">float</span>)(scene.height * scene.width));</span><br><span class="line">          &#125;</span><br><span class="line">           <span class="comment">//Threadlist[i]=std::thread(RenderWithMultiThread,minY,maxY);</span></span><br><span class="line">          minY=maxY+<span class="number">1.0f</span>;</span><br><span class="line">      UpdateProgress(<span class="number">1.f</span>);</span><br><span class="line">      <span class="comment">// save framebuffer to file</span></span><br><span class="line">      <span class="built_in">string</span> filename =<span class="string">&quot;binaryWithMultiThread&quot;</span>;</span><br><span class="line">      filename +=<span class="built_in">std</span>::to_string(<span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::seconds&gt;(<span class="built_in">std</span>::chrono::system_clock::now()-start).count())+<span class="string">&quot;.ppm&quot;</span>;</span><br><span class="line">      FILE* fp = fopen(filename.c_str(), <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">      (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i) &#123;</span><br><span class="line">          <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">          color[<span class="number">0</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x), <span class="number">0.6f</span>));</span><br><span class="line">          color[<span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y), <span class="number">0.6f</span>));</span><br><span class="line">          color[<span class="number">2</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">std</span>::<span class="built_in">pow</span>(clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z), <span class="number">0.6f</span>));</span><br><span class="line">          fwrite(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">      &#125;</span><br><span class="line">      fclose(fp);</span><br></pre></td></tr></table></figure>

<h2 id="OMPå¦‚ä½•è·‘èµ·æ¥ï¼Ÿ"><a href="#OMPå¦‚ä½•è·‘èµ·æ¥ï¼Ÿ" class="headerlink" title="OMPå¦‚ä½•è·‘èµ·æ¥ï¼Ÿ"></a>OMPå¦‚ä½•è·‘èµ·æ¥ï¼Ÿ</h2><p><strong>åœ¨linuxæ“ä½œç³»ç»Ÿä¸‹ï¼Œä½¿ç”¨<code>g++ test.cpp \-fopenmp \-o test</code>ç¼–è¯‘ã€‚å…ˆæµ‹è¯•ä¸€ä¸‹è¿™æ®µä»£ç ï¼Œä»¥ç¡®ä¿ä½ ä¼šä½¿ç”¨g++è¿›è¡Œç¼–è¯‘ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp parallel</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;hello,openmp!\n&quot;</span>;</span><br><span class="line">    <span class="built_in">cout</span>.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç¼–è¯‘è¿è¡Œï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g++ test.cpp -fopenmp -o test</span><br><span class="line">./test</span><br></pre></td></tr></table></figure>

<p><strong>ä½ å¯èƒ½å¾—åˆ°çš„æ˜¯ä¸åŒçš„ç»“æœï¼Œä½†åº”è¯¥ä¹Ÿåªæ˜¯æ•°é‡ä¸Šçš„ä¸åŒï¼Œè¿™å–å†³äºä½ ç”µè„‘çš„æ ¸å¿ƒæ•°ç›®ã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802091011701-1771906000_1726324278734.png" alt="image"><br><strong>æˆ‘ä»¬æ­£å¼å¼€å§‹</strong></p>
<h3 id="pragma-omp-parallel"><a href="#pragma-omp-parallel" class="headerlink" title="#pragma omp parallel"></a><code>#pragma omp parallel</code></h3><p><strong>è¿™ä¸ªé¢„å¤„ç†ç”¨äºå¼€å¯å¤šçº¿ç¨‹ï¼Œä¸Šé¢å·²ç»å®éªŒè¿‡äº†ï¼Œè¿™é‡Œä¸è¿›è¡Œè¿‡å¤šçš„è§£é‡Šã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬æ§åˆ¶çº¿ç¨‹çš„æ•°é‡ï¼š</strong></p>
<h2 id="çº¿ç¨‹æ•°é‡"><a href="#çº¿ç¨‹æ•°é‡" class="headerlink" title="çº¿ç¨‹æ•°é‡"></a>çº¿ç¨‹æ•°é‡</h2><h3 id="pragma-omp-parallel-num-threads-2"><a href="#pragma-omp-parallel-num-threads-2" class="headerlink" title="#pragma omp parallel num_threads(2)"></a><code>#pragma omp parallel num_threads(2)</code></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp parallel num_threads(2)</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;hello,openmp!\n&quot;</span>;</span><br><span class="line">    <span class="built_in">cout</span>.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿è¡Œè¿™æ®µä»£ç ï¼Œä½ å¯ä»¥çœ‹åˆ°hello åªå‰©ä¸‹äº†ä¸¤ä¸ªã€‚</strong></p>
<h3 id="APIomp-set-num-threads"><a href="#APIomp-set-num-threads" class="headerlink" title="APIomp_set_num_threads()"></a>API<code>omp_set_num_threads()</code></h3><p><strong>é¦–å…ˆæ·»åŠ å¤´æ–‡ä»¶<code>#include&quot;omp.h&quot;</code>ï¼Œç„¶åä½¿ç”¨API<code>omp_set_num_threads()</code></strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;omp.h&quot;</span></span></span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    omp_set_num_threads(<span class="number">2</span>);</span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp parallel</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;hello,openmp!\n&quot;</span>;</span><br><span class="line">    <span class="built_in">cout</span>.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¯ä»¥å¾—åˆ°å’Œä¸Šé¢ä¸€æ ·çš„ç»“æœã€‚</strong></p>
<h3 id="ç¯å¢ƒå˜é‡OMP-NUM-THREADS"><a href="#ç¯å¢ƒå˜é‡OMP-NUM-THREADS" class="headerlink" title="ç¯å¢ƒå˜é‡OMP_NUM_THREADS"></a>ç¯å¢ƒå˜é‡<code>OMP_NUM_THREADS</code></h3><p><strong>åœ¨ç¼–è¯‘ä¹‹å‰ï¼ŒåŠ ä¸Šè¿™å¥ä¿®æ”¹ç¯å¢ƒå˜é‡çš„æŒ‡ä»¤ï¼Œå°±å¯ä»¥å®ç°è¿è¡Œå‰ï¼Œç¼–è¯‘åä¿®æ”¹çº¿ç¨‹æ•°é‡äº†ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export OMP_NUM_THREADS=<span class="number">2</span></span><br></pre></td></tr></table></figure>

<p><strong>åœ¨æ­¤ä¹‹å‰ï¼ŒæŠŠä½ çš„æµ‹è¯•ä»£ç ä¿®æ”¹ä¸ºè¿™æ ·ï¼šå¹¶é‡æ–°ç¼–è¯‘ï¼Œç„¶åä½ ä¾¿å¯ä»¥æ§åˆ¶ä½ çš„çº¿ç¨‹æ•°é‡äº†</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&quot;omp.h&quot;</span></span></span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp parallel</span></span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;hello,openmp!\n&quot;</span>;</span><br><span class="line">    <span class="built_in">cout</span>.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802093044527-1672334357_1726324278734.png" alt="image"></p>
<h2 id="åŠ é€Ÿforå¾ªç¯"><a href="#åŠ é€Ÿforå¾ªç¯" class="headerlink" title="åŠ é€Ÿforå¾ªç¯"></a>åŠ é€Ÿforå¾ªç¯</h2><h3 id="omp-pragma-parallel-for"><a href="#omp-pragma-parallel-for" class="headerlink" title="#omp pragma parallel for"></a><code>#omp pragma parallel for</code></h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;omp.h&quot;</span></span></span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">cout</span>;</span><br><span class="line">using <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">long</span> <span class="type">long</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">auto</span> start = <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp parallel reduction(+:sum)</span></span><br><span class="line">    <span class="meta">#<span class="keyword">pragma</span> omp for </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">3</span>; i &lt; <span class="number">500000</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">2</span>; j &lt; i; j++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (i % j == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                flag = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag)</span><br><span class="line">            sum += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">auto</span> end = <span class="built_in">std</span>::chrono::system_clock::now();</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="built_in">std</span>::chrono::duration_cast&lt;<span class="built_in">std</span>::chrono::microseconds&gt;(end-start).count()&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;sum: &quot;</span> &lt;&lt; sum &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span>.flush();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æˆ‘éšä¾¿å†™äº†ä¸€æ®µï¼Œæ¥å¯¹æ¯”å¤šçº¿ç¨‹ä¸å•çº¿ç¨‹çš„å·®è·ï¼šå›¾ä¸­ç¬¬ä¸€ä¸ªæ˜¯16çº¿ç¨‹è·‘å‡ºæ¥çš„\(2530ms\)ï¼Œä¹Ÿå°±æ˜¯2.5sï¼Œç¬¬äºŒä¸ªæ˜¯å•çº¿ç¨‹ï¼Œ\(14147ms\)ï¼Œä¹Ÿå°±æ˜¯14.1sæ¥è¿‘7å€çš„å·®è·ï¼Œæ²¡æœ‰16å€çš„é€Ÿåº¦æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œæˆ‘è¿™ä¸ªæµ‹è¯•ç¨‹åºå†™çš„éå¸¸éšæ„ã€‚åªæ˜¯å•çº¯çš„è¯´æ˜åŠ é€Ÿæƒ…å†µè€Œå·²ã€‚å½“ç„¶ï¼Œç­”æ¡ˆæ˜¯ä¸€æ ·çš„ã€‚</strong></p>
<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230802095057963-2052212186_1726324278734.png" alt="image"></p>
<p><strong>ä¸Šé¢ä»£ç ä¸­è¿˜å‡ºç°äº†<code>reduction(+:sum)</code>è¿™æ ·çš„æŒ‡ä»¤ï¼Œè¿™æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è®²çš„ä¸œè¥¿ã€‚</strong></p>
<h3 id="è§„çº¦æ“ä½œ"><a href="#è§„çº¦æ“ä½œ" class="headerlink" title="è§„çº¦æ“ä½œ"></a>è§„çº¦æ“ä½œ</h3><p><strong>ä½¿ç”¨reduction()æ¥åˆ¶å®šè§„çº¦æ“ä½œ</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reduction(&lt;operator&gt;: &lt;variable <span class="built_in">list</span>&gt;)</span><br></pre></td></tr></table></figure>

<p><strong>è¿™ä¸ªæŒ‡ä»¤å¯ä»¥è®©æ‰€æœ‰çº¿ç¨‹çš„ç»“æœé€šè¿‡è§„çº¦åˆå¹¶åœ¨ä¸€èµ·ï¼Œæ¯”å¦‚ä¸Šé¢ç¨‹åºçš„+:sumï¼Œå°±æ˜¯æ¯ä¸ªçº¿ç¨‹åˆ†åˆ«è®¡ç®—sumï¼Œå†ç´¯åŠ åœ¨ä¸€èµ·ã€‚</strong></p>
<h1 id="æœ¬æ–‡å‚è€ƒ"><a href="#æœ¬æ–‡å‚è€ƒ" class="headerlink" title="æœ¬æ–‡å‚è€ƒ"></a>æœ¬æ–‡å‚è€ƒ</h1><p><a target="_blank" rel="noopener" href="https://yuxinzhao.net/openmp-basic">å¤§ä½¬çš„åšå®¢</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      

      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/Linuxæ‰¹é‡ä¿®æ”¹æ–‡ä»¶åå­—" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/3472/" class="article-date">
      <time datetime="2023-07-31T15:18:00.000Z" itemprop="datePublished">2023-07-31</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/3472/">Linuxæ‰¹é‡ä¿®æ”¹æ–‡ä»¶åå­—</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<p><strong>åœ¨åšè¿™æ ·ä¸€ä»¶äº‹æƒ…çš„æ—¶å€™æˆ‘é‡åˆ°äº†å›°éš¾ï¼šæˆ‘æœ‰åå‡ ä¸ªæ–‡ä»¶çš„æ—¥æœŸéƒ½æ˜¯ä»¥ç‚¹ä½œä¸ºåˆ†å‰²ç¬¦çš„ï¼Œä½†æ˜¯æˆ‘éœ€è¦æäº¤çš„æ–‡ä»¶åä¸­ä¸èƒ½æœ‰<code>.</code>ï¼Œé‚£æˆ‘éœ€è¦æŠŠè¿™äº›æ–‡ä»¶åæ”¹æˆ<code>-</code>ä¸ºåˆ†å‰²ç¬¦ã€‚</strong></p>
<h2 id="mv"><a href="#mv" class="headerlink" title="mv"></a><code>mv</code></h2><p><strong>æˆ‘åªçŸ¥é“<code>mv</code>å¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„åå­—ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½ä¿®æ”¹ä¸€ä¸ªï¼š</strong><br><code>mv 7.20.png 7-20.png</code><br><strong>äºæ˜¯æˆ‘æœ›ç€æˆ‘å‰©ä¸‹çš„æ–‡ä»¶å‘å‘†</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230731150828816-471545079_1726324278734.png" alt="image"><br><strong>ç™¾åº¦å‡†å¤‡è§£å†³ä¸€æ¬¡ï¼Œç”¨ä¸€è¾ˆå­</strong></p>
<h2 id="rename"><a href="#rename" class="headerlink" title="rename"></a><code>rename</code></h2><p><strong>ç»è¿‡ä¸€ç•ªç™¾åº¦ï¼Œæˆ‘æ‰å‘ç°<code>mv</code>åªèƒ½è¿›è¡Œå•ä¸ªæ–‡ä»¶çš„å‘½åä¿®æ”¹ï¼Œä½¿ç”¨<code>rename</code>æ‰èƒ½è¿›è¡Œæ‰¹é‡ä¿®æ”¹ï¼š</strong><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/411184519">å¤§ä½¬çš„renameè¯¦è§£</a><br><strong>æˆ‘ä½¿ç”¨çš„rename æ˜¯Perlç‰ˆæœ¬çš„ï¼Œé‚£ä¹ˆæˆ‘å¯ä»¥å‚ç…§è¿™ä¸ªè¡¨ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># Perlç‰ˆæœ¬</span><br><span class="line">-v, --verbose  è¯¦ç»†ï¼šæˆåŠŸé‡å‘½åçš„æ–‡ä»¶çš„æ‰“å°åç§°ã€‚</span><br><span class="line"><span class="number">-0</span>, --null ä»STDINè¯»å–æ—¶ï¼Œè¯·ä½¿ç”¨\<span class="number">0</span>ä½œä¸ºè®°å½•åˆ†éš”ç¬¦</span><br><span class="line">-n, --nono ä¸æ‰§è¡Œä»»ä½•æ“ä½œï¼šæ‰“å°è¦é‡å‘½åçš„æ–‡ä»¶åï¼Œä½†ä¸é‡å‘½åã€‚</span><br><span class="line">-f, --force è¦†ç›–ï¼šå…è®¸è¦†ç›–ç°æœ‰æ–‡ä»¶</span><br><span class="line">--path, --fullpath é‡å‘½åå®Œæ•´è·¯å¾„ï¼šåŒ…æ‹¬ä»»ä½•ç›®å½•ç»„ä»¶ã€‚é»˜è®¤</span><br><span class="line">-d, --filename, --nopath, --nofullpath ä¸é‡å‘½åç›®å½•ï¼šä»…é‡å‘½åè·¯å¾„çš„æ–‡ä»¶åéƒ¨åˆ†</span><br><span class="line">-h, --help å¸®åŠ©ï¼šæ‰“å°æè¦å’Œé€‰é¡¹ã€‚</span><br><span class="line">-m, --man æ‰‹å†Œ: æ‰“å°æ‰‹å†Œé¡µ.</span><br><span class="line">-V, --version ç‰ˆæœ¬: æ˜¾ç¤ºç‰ˆæœ¬å·.</span><br><span class="line">-e  è¡¨è¾¾: ä½œç”¨äºæ–‡ä»¶åçš„ä»£ç . å¯ä»¥é‡å¤æ¥æ„å»ºä»£ç ï¼ˆæ¯”å¦‚â€œperl-eâ€ï¼‰ã€‚å¦‚æœæ²¡æœ‰-eï¼Œåˆ™ç¬¬ä¸€ä¸ªå‚æ•°ç”¨ä½œä»£ç ã€‚</span><br><span class="line">-E   è¯­å¥ï¼šå¯¹æ–‡ä»¶åæ‰§è¡Œæ“ä½œçš„ä»£ç ï¼Œå¦‚-eï¼Œä½†ç»ˆæ­¢äº <span class="string">&#x27;;&#x27;</span>.</span><br><span class="line"># Cè¯­è¨€ç‰ˆæœ¬</span><br><span class="line">-v, --verbose æä¾›è§†è§‰åé¦ˆï¼Œå…¶ä¸­é‡å‘½åäº†å“ªäº›æ–‡ä»¶ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰</span><br><span class="line">-V, --version æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡ºã€‚</span><br><span class="line">-s, --symlink åœ¨ç¬¦å·é“¾æ¥ç›®æ ‡ä¸Šæ‰§è¡Œé‡å‘½å</span><br><span class="line">-h, --help æ˜¾ç¤ºå¸®åŠ©æ–‡æœ¬å¹¶é€€å‡º</span><br></pre></td></tr></table></figure>

<p><code>rename \-v &quot;s/7-/7./g&quot; *</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230731151533001-202011965_1726324304027.png" alt="image"><br><code>rename \-v &quot;s/7./7-/&quot; *</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230731151638994-1710560310_1726324304027.png" alt="image"></p>
<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230730101326510-705923470_1726324304027.png" alt="image"></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/Linux/">Linux</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork6" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/56022/" class="article-date">
      <time datetime="2023-07-30T21:24:00.000Z" itemprop="datePublished">2023-07-30</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/56022/">games101 HomeWork6</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="Games101-HomeWork6"><a href="#Games101-HomeWork6" class="headerlink" title="Games101 HomeWork6"></a>Games101 HomeWork6</h1><h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="ä½œä¸šè¦æ±‚"><a href="#ä½œä¸šè¦æ±‚" class="headerlink" title="ä½œä¸šè¦æ±‚"></a>ä½œä¸šè¦æ±‚</h2><ul>
<li><strong><code>IntersectP(const Ray&amp; ray, const Vector3f&amp; invDir,const std::array&lt;int, 3&gt;&amp; dirIsNeg)</code> in the Bounds3.hpp: è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ¤æ–­åŒ…å›´ç›’BoundingBox ä¸å…‰çº¿æ˜¯å¦ç›¸äº¤ï¼Œä½ éœ€è¦æŒ‰ç…§è¯¾ç¨‹ä»‹ç»çš„ç®—æ³•å®ç°æ±‚äº¤è¿‡ç¨‹ã€‚</strong></li>
<li><strong><code>getIntersection(BVHBuildNode* node, const Ray ray)</code>in BVH.cpp: å»ºç«‹BVH ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒåŠ é€Ÿæ±‚äº¤è¿‡ç¨‹ã€‚è¯¥è¿‡ç¨‹é€’å½’è¿›è¡Œï¼Œä½ å°†åœ¨å…¶ä¸­è°ƒç”¨ä½ å®ç°çš„<code>Bounds3::IntersectP</code>ã€‚</strong></li>
</ul>
<h2 id="å‰ç½®è¦æ±‚"><a href="#å‰ç½®è¦æ±‚" class="headerlink" title="å‰ç½®è¦æ±‚"></a>å‰ç½®è¦æ±‚</h2><ul>
<li><strong><code>Render()</code> in Renderer.cpp: å°†ä½ çš„å…‰çº¿ç”Ÿæˆè¿‡ç¨‹ç²˜è´´åˆ°æ­¤å¤„ï¼Œå¹¶ä¸”æŒ‰ç…§æ–°æ¡†æ¶æ›´æ–°ç›¸åº”è°ƒç”¨çš„æ ¼å¼ã€‚</strong></li>
<li><strong><code>Triangle::getIntersection</code> in Triangle.hpp: å°†ä½ çš„å…‰çº¿-ä¸‰è§’å½¢ç›¸äº¤å‡½æ•°<br>ç²˜è´´åˆ°æ­¤å¤„ï¼Œå¹¶ä¸”æŒ‰ç…§æ–°æ¡†æ¶æ›´æ–°ç›¸åº”ç›¸äº¤ä¿¡æ¯çš„æ ¼å¼</strong></li>
</ul>
<h3 id="Render"><a href="#Render" class="headerlink" title="Render()"></a>Render()</h3><p><strong>æ–°æ¡†æ¶é‡ŒæŠŠå…‰çº¿å†™æˆäº†ä¸€ä¸ªç±»ï¼ŒcastRayçš„å‚æ•°åˆ—è¡¨ä¹Ÿæ”¹æˆäº†è¿™æ ·ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vector3f <span class="title function_">castRay</span><span class="params">(<span class="type">const</span> Ray &amp;ray, <span class="type">int</span> depth)</span> <span class="type">const</span>;</span><br></pre></td></tr></table></figure>

<p><strong>Rayç±»ä¸­çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼Œæˆ‘åªä¿ç•™äº†è¿™äº›æœ‰ç”¨çš„ä»£ç ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Ray</span>&#123;</span></span><br><span class="line">    <span class="comment">//Destination = origin + t*direction</span></span><br><span class="line">    Vector3f origin;</span><br><span class="line">    Vector3f direction, direction_inv;</span><br><span class="line">    <span class="type">double</span> t;<span class="comment">//transportation time,</span></span><br><span class="line">    <span class="type">double</span> t_min, t_max;</span><br><span class="line">    Ray(<span class="type">const</span> Vector3f&amp; ori, <span class="type">const</span> Vector3f&amp; dir, <span class="type">const</span> <span class="type">double</span> <span class="type">_t</span> = <span class="number">0.0</span>): origin(ori), direction(dir),t(<span class="type">_t</span>) &#123;</span><br><span class="line">        direction_inv = Vector3f(<span class="number">1.</span>/direction.x, <span class="number">1.</span>/direction.y, <span class="number">1.</span>/direction.z);</span><br><span class="line">        t_min = <span class="number">0.0</span>;</span><br><span class="line">        t_max = <span class="built_in">std</span>::numeric_limits&lt;<span class="type">double</span>&gt;::max();</span><br><span class="line">    &#125;</span><br><span class="line">    Vector3f <span class="title function_">operator</span><span class="params">()</span><span class="params">(<span class="type">double</span> t)</span> <span class="type">const</span>&#123;<span class="keyword">return</span> origin+direction*t;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>åˆå§‹åŒ–ä¸€ä¸ªRayç±»å¯¹è±¡éœ€è¦ä¸€ä¸ªèµ·ç‚¹ç‚¹å’Œä¸€ä¸ªå‘é‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ray(t)æ¥ç›´æ¥è®¿é—®æŸç‚¹çš„åæ ‡ã€‚çŸ¥é“è¿™äº›ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ŒæˆRenderçš„å®ç°ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Render</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">uint32_t</span> j = <span class="number">0</span>; j &lt; scene.height; ++j) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; scene.width; ++i) &#123;</span><br><span class="line">            <span class="comment">// generate primary ray direction</span></span><br><span class="line">            <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) *</span><br><span class="line">                      imageAspectRatio * scale;</span><br><span class="line">            <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Find the x and y positions of the current pixel to get the</span></span><br><span class="line">            <span class="comment">// direction</span></span><br><span class="line">            <span class="comment">//  vector that passes through it.</span></span><br><span class="line">            <span class="comment">// Also, don&#x27;t forget to multiply both of them with the variable</span></span><br><span class="line">            <span class="comment">// *scale*, and x (horizontal) variable with the *imageAspectRatio*</span></span><br><span class="line">            Vector3f dir = normalize(Vector3f(x, y, <span class="number">-1</span>)); </span><br><span class="line">            framebuffer[m++]=scene.castRay(Ray(eye_pos,dir), <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        UpdateProgress(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="Triangle-getIntersection"><a href="#Triangle-getIntersection" class="headerlink" title="Triangle::getIntersection()"></a>Triangle::getIntersection()</h3><p><strong>è¿™ä¸ªå‡½æ•°è¿›è¡Œçš„æ“ä½œæ˜¯ï¼Œåœ¨ä¸€ä¸ªä¸‰è§’å½¢å¯¹è±¡ä¸­åˆ¤æ–­ä¸€æ ¹å…‰çº¿æ˜¯å¦ä¸è‡ªå·±ç›¸äº¤ã€‚ä¸‹å›¾æ˜¯Triangleç±»çš„æ•°æ®æˆå‘˜å£°æ˜ï¼Œå®ƒç»§æ‰¿äº†æŠ½è±¡ç±»Objectç±»ï¼Œä½†æ˜¯Objectä¸­æ²¡æœ‰ä»»ä½•æ•°æ®æˆå‘˜ï¼Œè¿™ä¸ªä¸ç”¨å…³å¿ƒã€‚å¯ä»¥çœ‹åˆ°ä¸‰è§’å½¢ä¿å­˜äº†ç‚¹ã€è¾¹ã€å’Œæ³•çº¿ç­‰ç­‰</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#Triangle.hpp</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> :</span> public Object</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    Vector3f v0, v1, v2; <span class="comment">// vertices A, B ,C , counter-clockwise order</span></span><br><span class="line">    Vector3f e1, e2;     <span class="comment">// 2 edges v1-v0, v2-v0;</span></span><br><span class="line">    Vector3f t0, t1, t2; <span class="comment">// texture coords</span></span><br><span class="line">    Vector3f normal;</span><br><span class="line">    Material* m;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>åœ¨getIntersectionä¸­ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›çš„æ˜¯ä¸€ä¸ªintersectionä¹Ÿå°±æ˜¯ç¢°æ’ä½“ï¼Œçœ‹ä¸€ä¸‹intersectionç±»çš„å£°æ˜ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#Intersection.hpp</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Intersection</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    Intersection()&#123;</span><br><span class="line">        happened=<span class="literal">false</span>;</span><br><span class="line">        coords=Vector3f();</span><br><span class="line">        normal=Vector3f();</span><br><span class="line">        distance= <span class="built_in">std</span>::numeric_limits&lt;<span class="type">double</span>&gt;::max();</span><br><span class="line">        obj =nullptr;</span><br><span class="line">        m=nullptr;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">bool</span> happened;</span><br><span class="line">    Vector3f coords;</span><br><span class="line">    Vector3f normal;</span><br><span class="line">    <span class="type">double</span> distance;</span><br><span class="line">    Object* obj;</span><br><span class="line">    Material* m;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿç¢°æ’ï¼Œæˆ‘ä»¬ä¸éœ€è¦å¯¹interåšä»»ä½•æ“ä½œï¼Œå‘ç”Ÿäº†ç¢°æ’ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å®ƒçš„çº¹ç†åæ ‡ã€æ³•çº¿ã€å…‰è·¯é•¿åº¦ã€æ¨¡å‹æŒ‡é’ˆã€ç‰©ä½“æŒ‡é’ˆã€‚è¿™äº›åœ¨ä¸‰è§’å½¢å¯¹è±¡ä¸­éƒ½æœ‰ï¼Œæ£€æµ‹ä¹‹åä¸€ä¸€è®¾ç½®å°±å¥½äº†ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//#getIntersection()</span></span><br><span class="line">    <span class="keyword">if</span>(t_tmp&lt;<span class="number">0</span>)<span class="keyword">return</span> inter;</span><br><span class="line">    inter.distance = t_tmp;</span><br><span class="line">    inter.happened=<span class="literal">true</span>;</span><br><span class="line">    inter.normal=normal;</span><br><span class="line">    inter.coords=ray(t_tmp);</span><br><span class="line">    inter.obj=this;</span><br><span class="line">    inter.m=m;</span><br><span class="line">    <span class="keyword">return</span> inter;</span><br></pre></td></tr></table></figure>

<h2 id="æ™®é€šè¦æ±‚"><a href="#æ™®é€šè¦æ±‚" class="headerlink" title="æ™®é€šè¦æ±‚"></a>æ™®é€šè¦æ±‚</h2><h3 id="IntersectP"><a href="#IntersectP" class="headerlink" title="IntersectP()"></a>IntersectP()</h3><p><strong>è¿™ä¸ªå‡½æ•°éœ€è¦æˆ‘ä»¬å®Œæˆå…‰çº¿ä¸åŒ…å›´ç›’çš„æ±‚äº¤åˆ¤æ–­ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vector3f t_minTemp=(pMin-ray.origin)*invDir;</span><br><span class="line">Vector3f t_maxTemp=(pMax-ray.origin)*invDir;</span><br><span class="line">Vector3f t_min=Vector3f::Min(t_minTemp,t_maxTemp);</span><br><span class="line">Vector3f t_max=Vector3f::Max(t_minTemp,t_maxTemp);</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> t_enter=<span class="built_in">std</span>::max(t_min.x,<span class="built_in">std</span>::max(t_min.y,t_min.z));</span><br><span class="line"><span class="type">float</span> t_out=<span class="built_in">std</span>::min(t_max.x,<span class="built_in">std</span>::min(t_max.y,t_max.z));</span><br></pre></td></tr></table></figure>

<p><strong>å…ˆè®¡ç®—è¿›å…¥ç›’å­çš„æ—¶é—´å’Œå‡ºç›’å­çš„æ—¶é—´ï¼Œç„¶åè¿”å›åˆ¤æ–­æ¡ä»¶çš„çœŸå‡å°±å¥½äº†</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(t_out&gt;=<span class="number">0.0f</span>&amp;&amp;t_enter&lt;=t_out)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="getIntersection"><a href="#getIntersection" class="headerlink" title="getIntersection()"></a>getIntersection()</h3><p><strong>è¦æ±‚å»ºç«‹BVH ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒåŠ é€Ÿæ±‚äº¤è¿‡ç¨‹ã€‚</strong><br><strong>è¿˜è®°å¾—ä¹ˆï¼ŸåŒ…å›´ç›’æ˜¯ä»¥äºŒå‰æ ‘çš„å½¢å¼å­˜å‚¨çš„ï¼Œå°±åƒè¿™æ ·ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230730210530875-1305392703_1726324304027.png" alt="image"><br><strong>å¯¹ä¸€ä¸ªåŒ…å›´ç›’ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è¯¥åŒ…å›´ç›’æ˜¯å¦ä¸å…‰çº¿ç›¸äº¤ï¼Œå¦‚æœæœ‰ï¼Œé‚£ä¹ˆåˆ¤æ–­è¿™ä¸ªåŒ…å›´ç›’æ˜¯å¦å­˜åœ¨å­å¶ï¼Œå¦‚æœæœ‰ï¼Œæ£€æŸ¥é€’å½’æ£€æŸ¥å­å¶æ˜¯å¦ä¸å…‰çº¿æœ‰äº¤ç‚¹ï¼Œç›´åˆ°è¿™ä¸ªåŒ…å›´ç›’ä¸ä¸å…‰çº¿ç›¸äº¤ï¼›æˆ–è€…è¯¥åŒ…å›´ç›’ä¸å†å­˜åœ¨å­å¶ï¼Œåˆ™åˆ¤æ–­è¿™ä¸ªç‰©ä½“æ˜¯å¦ä¸å…‰çº¿ç›¸äº¤ã€‚ä»£ç å®ç°å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Intersection <span class="title function_">BVHAccel::getIntersection</span><span class="params">(BVHBuildNode* node, <span class="type">const</span> Ray&amp; ray)</span> <span class="type">const</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// TODO Traverse the BVH to find intersection</span></span><br><span class="line">	<span class="comment">// invDir: ray direction(x,y,z), invDir=(1.0/x,1.0/y,1.0/z), use this because Multiply is faster that Division</span></span><br><span class="line">    <span class="comment">// dirIsNeg: ray direction(x,y,z), dirIsNeg=[int(x&gt;0),int(y&gt;0),int(z&gt;0)], use this to simplify your logic</span></span><br><span class="line">    Intersection intersect;</span><br><span class="line">    Vector3f <span class="title function_">invdir</span><span class="params">(<span class="number">1.</span>/ray.direction.x,<span class="number">1.</span>/ray.direction.y,<span class="number">1.</span>/ray.direction.z)</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="type">int</span>, <span class="number">3</span>&gt; dirIsNeg;</span><br><span class="line">    dirIsNeg[<span class="number">0</span>] = ray.direction.x&gt;<span class="number">0</span>;</span><br><span class="line">    dirIsNeg[<span class="number">1</span>] = ray.direction.y&gt;<span class="number">0</span>;</span><br><span class="line">    dirIsNeg[<span class="number">2</span>] = ray.direction.z&gt;<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(!node || !node-&gt;bounds.IntersectP(ray,ray.direction_inv,dirIsNeg))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> intersect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!node-&gt;right &amp;&amp; !node-&gt;left)</span><br><span class="line">        <span class="keyword">return</span> node-&gt;object-&gt;getIntersection(ray);</span><br><span class="line"></span><br><span class="line">    Intersection isect2= getIntersection(node-&gt;left,ray);</span><br><span class="line">    Intersection isect1= getIntersection(node-&gt;right,ray);</span><br><span class="line">    <span class="keyword">return</span> isect1.distance &lt; isect2.distance ? isect1:isect2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è¿è¡Œ-RayTracing"><a href="#è¿è¡Œ-RayTracing" class="headerlink" title="è¿è¡Œ./RayTracing"></a>è¿è¡Œ<code>./RayTracing</code></h3><h4 id="æ³¨æ„ï¼è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿ä½ çš„-buildç›®å½•ä¸‹æœ‰imag-BVHå’Œimag-SAHç›®å½•ï¼Œæˆ‘æŠŠç”Ÿæˆçš„å›¾ç‰‡æ”¾åœ¨é‡Œé¢äº†ï¼ï¼ï¼"><a href="#æ³¨æ„ï¼è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿ä½ çš„-buildç›®å½•ä¸‹æœ‰imag-BVHå’Œimag-SAHç›®å½•ï¼Œæˆ‘æŠŠç”Ÿæˆçš„å›¾ç‰‡æ”¾åœ¨é‡Œé¢äº†ï¼ï¼ï¼" class="headerlink" title="æ³¨æ„ï¼è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿ä½ çš„&#x2F;buildç›®å½•ä¸‹æœ‰imag_BVHå’Œimag_SAHç›®å½•ï¼Œæˆ‘æŠŠç”Ÿæˆçš„å›¾ç‰‡æ”¾åœ¨é‡Œé¢äº†ï¼ï¼ï¼"></a><strong>æ³¨æ„ï¼è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿ä½ çš„&#x2F;buildç›®å½•ä¸‹æœ‰<code>imag_BVH</code>å’Œ<code>imag_SAH</code>ç›®å½•ï¼Œæˆ‘æŠŠç”Ÿæˆçš„å›¾ç‰‡æ”¾åœ¨é‡Œé¢äº†ï¼ï¼ï¼</strong></h4><p><strong>åƒè¿™æ ·</strong><br><img src="https://img2023.cnblogs.com/blog/3080748/202307/3080748-20230730210530875-1305392703.png" alt="image"></p>
<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230730153853931-712417031_1726324322660.png" alt="image"><br><strong>å¾ˆæ£’çš„å…‰å½±ï¼ä½†æ˜¯æ¸²æŸ“è¿™å¼ å›¾ç‰‡éœ€è¦èŠ±è´¹æˆ‘çš„ç”µè„‘6-8ç§’é’Ÿï¼ŒBVHè¿˜æ˜¯å¤ªæ…¢äº†ï¼Œæ¥ç€ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ æ–°çš„åŠ é€Ÿæ¨¡å¼SAH(Surface Area Heuristic)ã€‚</strong></p>
<h2 id="æé«˜é¢˜-SAHåŠ é€Ÿ"><a href="#æé«˜é¢˜-SAHåŠ é€Ÿ" class="headerlink" title="æé«˜é¢˜(SAHåŠ é€Ÿ)"></a>æé«˜é¢˜(SAHåŠ é€Ÿ)</h2><p><strong>é¦–å…ˆï¼ŒåšBVHçš„æ—¶å€™ï¼Œæˆ‘ä»¬åˆ’åˆ†ç©ºé—´çš„æ–¹å¼æ˜¯ä»ä¸­é—´è¿›è¡Œçš„ï¼Œä¸è€ƒè™‘ç©ºé—´ä¸­ç‰©ä½“çš„å¯†åº¦å¤§å°ã€‚è¿™æ ·å¯èƒ½å¯¼è‡´åˆ’åˆ†éå¸¸çš„ä¸åˆç†ã€‚è€Œç®€å•æ¥è¯´SAHå°±æ˜¯æŒ‡åœ¨åˆ’åˆ†ç©ºé—´çš„æ—¶å€™ï¼Œå…ˆåˆ¤æ–­ä¸¤å—ç©ºé—´æ‰€éœ€çš„æ—¶é—´ï¼ˆè¿›è¡Œä¼°è®¡ï¼‰ï¼Œä¼°è®¡çš„æ–¹æ³•æœ‰å¾ˆå¤šã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230730203530877-1333849713_1726324322660.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230730203252774-563756016_1726324322660.png" alt="image"></p>
<p><strong>æˆ‘ä»¬çš„ä¼˜åŒ–ç›®æ ‡å°±æ˜¯è¿™ä¸ªæ€»æ¶ˆè€—\(C\)</strong></p>
<ul>
<li><strong>0.125ä¸ºæ— å…³æ¶ˆè€—ï¼Œå¯ä»¥ç†è§£ä¸ºè®¡ç®—è¿™ä¸ªæ¶ˆè€—çš„æ¶ˆè€— \(C_{trav}\)</strong></li>
<li><strong>ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªåˆ†åˆ«æ˜¯å·¦èŠ‚ç‚¹å’Œå³èŠ‚ç‚¹çš„æ¶ˆè€—</strong></li>
<li><strong>æœ€åçš„maxAreaDivå°±æ˜¯æ€»å½“å‰èŠ‚ç‚¹åŒ…å›´ç›’çš„æ€»é¢ç§¯åˆ†ä¹‹ä¸€ \(\frac{1}{S_N}\)</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> cost = <span class="number">0.125f</span> + (leftCount * leftBounds3.SurfaceArea() + rightCount * rightBounds3.SurfaceArea()) * maxAreaDiv;</span><br></pre></td></tr></table></figure>

<p><strong>æšä¸¾ä¸€å®šæ•°é‡çš„åˆ’åˆ†æ–¹æ¡ˆï¼Œç„¶åä¼°ç®—è¿™äº›æ–¹æ¡ˆçš„æ¶ˆè€—å€¼ã€‚é€šè¿‡æ±‚æœ€å¤§å€¼å¾—åˆ°åˆ’åˆ†æ–¹æ¡ˆã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Bounds3 centroidBounds;</span><br><span class="line">         <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; objects.size(); ++i)</span><br><span class="line">             centroidBounds =</span><br><span class="line">                 Union(centroidBounds, objects[i]-&gt;getBounds().Centroid());</span><br><span class="line">         <span class="type">int</span> dim = centroidBounds.maxExtent();</span><br><span class="line">         <span class="type">float</span> maxArea = centroidBounds.SurfaceArea();</span><br><span class="line">         <span class="type">float</span> minCost = <span class="built_in">std</span>::numeric_limits&lt;<span class="type">float</span>&gt;::infinity();</span><br><span class="line">         <span class="type">int</span> minClipNum = <span class="number">0</span>;</span><br><span class="line">         <span class="type">float</span> BoundingClip = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">         <span class="type">float</span> BoundingClipDiv = <span class="number">1.0f</span> / BoundingClip;</span><br><span class="line">         <span class="type">float</span> maxAreaDiv = <span class="number">1.0f</span> / maxArea;</span><br><span class="line">         <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; BoundingClip; i++)</span><br><span class="line">         &#123;</span><br><span class="line">             Bounds3 leftBounds3;</span><br><span class="line">             Bounds3 rightBounds3;</span><br><span class="line">             <span class="type">float</span> leftCount = <span class="number">0.0f</span>;</span><br><span class="line">             <span class="type">float</span> rightCount = <span class="number">0.0f</span>;</span><br><span class="line">             <span class="keyword">auto</span> middlingTemp = objects.begin() + <span class="built_in">std</span>::<span class="built_in">floor</span>(objects.size() * (i * BoundingClipDiv));</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">auto</span> j = objects.begin(); j &lt; middlingTemp; j++)</span><br><span class="line">             &#123;</span><br><span class="line">                 leftBounds3 = Union(leftBounds3, (*j)-&gt;getBounds().Centroid());</span><br><span class="line">                 leftCount = leftCount + <span class="number">1.0f</span>;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">auto</span> j = middlingTemp; j &lt; objects.end(); j++)</span><br><span class="line">             &#123;</span><br><span class="line">                 rightBounds3 = Union(rightBounds3, (*j)-&gt;getBounds().Centroid());</span><br><span class="line">                 rightCount = rightCount + <span class="number">1.0f</span>;</span><br><span class="line">             &#125;</span><br><span class="line">             <span class="type">float</span> cost = <span class="number">0.125f</span> + (leftCount * leftBounds3.SurfaceArea() + rightCount * rightBounds3.SurfaceArea()) * maxAreaDiv;</span><br><span class="line">             <span class="keyword">if</span> (cost &lt; minCost)</span><br><span class="line">             &#123;</span><br><span class="line">                 minClipNum = i;</span><br><span class="line">                 minCost = cost;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         middling = objects.begin() + <span class="built_in">std</span>::<span class="built_in">floor</span>(objects.size() * (minClipNum * BoundingClipDiv));</span><br></pre></td></tr></table></figure>

<p><strong>è¿™é‡Œå°±ä¸æŒ‚å®Œæ•´ä»£ç äº†ï¼Œæœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å»githubä¸Šçœ‹ã€‚</strong></p>
<h3 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h3><h4 id="AMDÂ®-Ryzen-7-5800h-with-radeon-graphics-Ã—-16"><a href="#AMDÂ®-Ryzen-7-5800h-with-radeon-graphics-Ã—-16" class="headerlink" title="AMDÂ® Ryzen 7 5800h with radeon graphics Ã— 16"></a>AMDÂ® Ryzen 7 5800h with radeon graphics Ã— 16</h4><h4 id="BVH-RayTracing-BVH"><a href="#BVH-RayTracing-BVH" class="headerlink" title="BVH ./RayTracing BVH"></a>BVH <code>./RayTracing BVH</code></h4><p><strong>BVHç”¨æˆ‘çš„ç”µè„‘è·‘å‡ºæ¥æœ€å¥½çš„æ•ˆæœæ˜¯æœ€å¿«<code>7299ms</code></strong></p>
<h4 id="SAH-RrayTracing-SAH"><a href="#SAH-RrayTracing-SAH" class="headerlink" title="SAH ./RrayTracing SAH"></a>SAH <code>./RrayTracing SAH</code></h4><p><strong>SAHç”¨æˆ‘çš„ç”µè„‘è·‘å‡ºæ¥æœ€å¥½çš„æ•ˆæœæ˜¯æœ€å¿«<code>6732ms</code></strong></p>
<h4 id="DIY"><a href="#DIY" class="headerlink" title="DIY"></a>DIY</h4><p><strong>æœ‰å…´è¶£çš„å°ä¼™ä¼´å¯ä»¥å°è¯•ä¿®æ”¹<code>float BoundingClip = 10;</code>ï¼Œå®ƒåœ¨<code>BVHAccel::recursiveBuild</code>ä¸­ï¼Œä»£è¡¨SAHåˆ’åˆ†ç©ºé—´çš„æ—¶å€™æšä¸¾çš„ç©ºé—´æ•°é‡ã€‚è¯´ä¸å®šä¼šæœ‰æ›´å¥½çš„åŠ é€Ÿæ•ˆæœå“¦ï½</strong></p>
<h2 id="ä»£ç æ±‡æ€»"><a href="#ä»£ç æ±‡æ€»" class="headerlink" title="ä»£ç æ±‡æ€»"></a>ä»£ç æ±‡æ€»</h2><p><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/tree/master/Assignment6">zhywyt-github</a></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17597301.html">ä¸‹ä¸€ç¯‡ï¼š</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589717.html">ä¸Šä¸€ç¯‡ï¼šRay Tracing å…‰çº¿è¿½è¸ª</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork5" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/56214/" class="article-date">
      <time datetime="2023-07-29T20:39:00.000Z" itemprop="datePublished">2023-07-29</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/56214/">games101 HomeWork5</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="Games101-HomeWork5"><a href="#Games101-HomeWork5" class="headerlink" title="Games101 HomeWork5"></a>Games101 HomeWork5</h1><h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a>ä»»åŠ¡</h2><ul>
<li><strong>Renderer.cpp ä¸­çš„ <code>Render()</code>ï¼šè¿™é‡Œä½ éœ€è¦ä¸ºæ¯ä¸ªåƒç´ ç”Ÿæˆä¸€æ¡å¯¹åº”çš„å…‰çº¿ï¼Œç„¶åè°ƒç”¨å‡½æ•° castRay() æ¥å¾—åˆ°é¢œè‰²ï¼Œæœ€åå°†é¢œè‰²å­˜å‚¨åœ¨å¸§ç¼“å†²åŒºçš„ç›¸åº”åƒç´ ä¸­ã€‚</strong></li>
<li><strong>Triangle.hpp ä¸­çš„ <code>rayTriangleIntersect()</code>: v0, v1, v2 æ˜¯ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼Œorig æ˜¯å…‰çº¿çš„èµ·ç‚¹ï¼Œdir æ˜¯å…‰çº¿å•ä½åŒ–çš„æ–¹å‘å‘é‡ã€‚tnear, u, v æ˜¯ä½ éœ€è¦ä½¿ç”¨æˆ‘ä»¬è¯¾ä¸Šæ¨å¯¼çš„ Moller-Trumbore ç®—æ³•æ¥æ›´æ–°çš„å‚æ•°ã€‚</strong></li>
</ul>
<h3 id="rayTriangleIntersect"><a href="#rayTriangleIntersect" class="headerlink" title="rayTriangleIntersect()"></a>rayTriangleIntersect()</h3><p><strong>æˆ‘ä»¬é¦–å…ˆæ¥å®Œæˆè¿™ä¸ªçº¯ç®—æ³•çš„ä¸œè¥¿ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729184141169-632183414_1726324322660.png" alt="image"><br>å¿˜è®°äº†ä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘æ­£å¥½æƒ³å¤ä¹ ä¸€ä¸‹ã€‚é¦–å…ˆæˆ‘ä»¬å¯ä»¥ç”¨èµ·ç‚¹å’Œå…‰çº¿çš„æ–¹å‘æ¥è¡¨ç¤ºå…‰çº¿ä¸Šçš„æ¯ä¸€ä¸ªç‚¹ï¼Œä¹Ÿå°±æ˜¯\(\vec{O}+t\vec{D}\),æ¥ç€ï¼Œå¦‚æœè¿™ä¸ªç‚¹ç»è¿‡ä¸‰è§’å½¢æ‰€åœ¨çš„å¹³é¢ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”±<strong>é‡å¿ƒåæ ‡</strong>æ‰€è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯</p>
<p>\[\vec O+t\vec D &#x3D;(1-b_1-b_2)\vec P_0+b_1\\vec P_1 +b_2\vec P_2 \]</p>
<p>ä½¿ç”¨å…‹æ‹‰é»˜æ³•åˆ™å¯ä»¥è§£å‡º\(tã€b_1ã€b_2\)ã€‚å†ç„¶åï¼Œå¦‚æœé‡å¿ƒåæ ‡ä¸‰ä¸ªæ•°å€¼éƒ½å¤§äºé›¶ï¼Œè¯´æ˜äº¤ç‚¹åœ¨ä¸‰è§’å½¢å†…ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">rayTriangleIntersect</span><span class="params">(<span class="type">const</span> Vector3f&amp; v0, <span class="type">const</span> Vector3f&amp; v1, <span class="type">const</span> Vector3f&amp; v2, <span class="type">const</span> Vector3f&amp; orig, <span class="type">const</span> Vector3f&amp; dir, <span class="type">float</span>&amp; tnear, <span class="type">float</span>&amp; u, <span class="type">float</span>&amp; v)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement this function that tests whether the triangle</span></span><br><span class="line">    <span class="comment">// that&#x27;s specified bt v0, v1 and v2 intersects with the ray (whose</span></span><br><span class="line">    <span class="comment">// origin is *orig* and direction is *dir*)</span></span><br><span class="line">    <span class="comment">// Also don&#x27;t forget to update tnear, u and v.</span></span><br><span class="line">    <span class="keyword">auto</span> e1 = v1 - v0, e2 = v2 - v0, s = orig - v0;</span><br><span class="line">    <span class="keyword">auto</span> s1 = crossProduct(dir, e2), s2 = crossProduct(s, e1);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> t = dotProduct(s2, e2) / dotProduct(s1, e1);</span><br><span class="line">    <span class="type">float</span> b1 = dotProduct(s1, s) / dotProduct(s1, e1);</span><br><span class="line">    <span class="type">float</span> b2 = dotProduct(s2, dir) / dotProduct(s1, e1);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (t &gt; <span class="number">0.0</span> &amp;&amp; b1 &gt; <span class="number">0.0</span> &amp;&amp; b2 &gt; <span class="number">0.0</span> &amp;&amp; (<span class="number">1</span> - b1 - b2) &gt; <span class="number">0.0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        tnear = t;</span><br><span class="line">        u = b1;</span><br><span class="line">        v = b2;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Render"><a href="#Render" class="headerlink" title="Render()"></a>Render()</h3><p>è¿™é‡Œå­˜åœ¨ç€ä¸€ç³»åˆ—è¾ƒä¸ºå¤æ‚çš„åæ ‡å˜æ¢ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥çœ‹ã€‚é¦–å…ˆåœ¨ç»™å‡ºçš„æ¡†æ¶ä¸­ï¼Œæˆ‘ä»¬æ˜¯å¯¹å±å¹•åƒç´ è¿›è¡Œäº†éå†ï¼Œå¾—åˆ°äº†\((i , j)\)ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„æ˜¯è§‚å¯Ÿç©ºé—´ä¸‹çš„åæ ‡ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line"> &#123;</span><br><span class="line">     <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">     &#123;</span><br><span class="line">         <span class="type">float</span> x;</span><br><span class="line">         <span class="type">float</span> y;</span><br><span class="line">         Vector3f dir = normalize(Vector3f(x, y, <span class="number">-1</span>)); <span class="comment">// Don&#x27;t forget to normalize this direction!</span></span><br><span class="line">         framebuffer[m++] = castRay(eye_pos, dir, scene, <span class="number">0</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     UpdateProgress(j / (<span class="type">float</span>)scene.height);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…³äºè¿™ä¸€æ®µçš„è§£é‡Šï¼Œæˆ‘ç¿»äº†å¾ˆä¹…çš„åšå®¢ï¼Œæ²¡æœ‰æ‰¾åˆ°è‡ªå·±æ»¡æ„çš„ï¼Œæ‰€ä»¥ä»”ç»†ç ”ç©¶äº†ä¸€ä¸‹ï¼Œæ‰å‘ç°ä»–ä»¬çš„è§£é‡Šæ–¹å‘ä¸é‚£ä¹ˆä¼˜ã€‚ä¸åº”è¯¥æŠŠ<code>imageAspectRatio</code>åŠ åœ¨å‰é¢çš„åæ ‡æ¥è§£é‡Šï¼Œå®é™…ä¸Šä¹Ÿæ˜¯è¿™æ ·çš„ï¼Œè¿™ä¹Ÿæ˜¯ç¼©æ”¾å› å­çš„ä¸€éƒ¨åˆ†æ‰å¯¹ã€‚è¯·çœ‹ä¸‹é¢è§£é‡Šï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729201843723-331599946_1726324322660.png" alt="image"><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729203101213-2073703701_1726324372935.png" alt="image"><br><strong>åˆ°è¿™é‡Œäº†ï¼Œå…¶å®\(x\)è½´å·²ç»å¾ˆç®€å•äº†ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729195452117-888682630_1726324372935.png" alt="image"><br><strong>ä»£ç çš„å®ç°ä¹Ÿå°±ä¸éš¾äº†</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Render</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// generate primary ray direction</span></span><br><span class="line">            <span class="type">float</span> x;</span><br><span class="line">            <span class="type">float</span> y;</span><br><span class="line">            <span class="comment">// <span class="doctag">TODO:</span> Find the x and y positions of the current pixel to get the direction</span></span><br><span class="line">            <span class="comment">// vector that passes through it.</span></span><br><span class="line">            <span class="comment">// Also, don&#x27;t forget to multiply both of them with the variable *scale*, and</span></span><br><span class="line">            <span class="comment">// x (horizontal) variable with the *imageAspectRatio* </span></span><br><span class="line">            x=(((i+<span class="number">0.5f</span>)/static_cast&lt;<span class="type">float</span>&gt;(scene.width<span class="number">-1</span>)*<span class="number">2.0f</span>)<span class="number">-1.0f</span>)*scale*imageAspectRatio;</span><br><span class="line">            y=(<span class="number">1.0f</span>-(j+<span class="number">0.5f</span>)/static_cast&lt;<span class="type">float</span>&gt;(scene.height<span class="number">-1</span>)*<span class="number">2.0f</span>)*scale;</span><br><span class="line">			<span class="comment">//å…¶å®å°±æ˜¯æŠŠ&quot;zNear&quot;è®¾ç½®ä¸ºäº† 1</span></span><br><span class="line">            Vector3f dir = normalize(Vector3f(x, y, <span class="number">-1</span>)); <span class="comment">// Don&#x27;t forget to normalize this direction!</span></span><br><span class="line">            framebuffer[m++] = castRay(eye_pos, dir, scene, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        UpdateProgress(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>å…¶ä¸­widthå’Œheight\(-1\)çš„åŸå› æˆ‘ä¹Ÿä¸æ˜¯å¾ˆæ‡‚ï¼ŒåªçŸ¥é“ä¸å‡å¥½åƒä¼šå‡ºç°ä¸¤ä¸ªè“ç‚¹ã€‚</strong></p>
<h2 id="æ¨å¯¼æ­£ç¡®æ€§å®éªŒ"><a href="#æ¨å¯¼æ­£ç¡®æ€§å®éªŒ" class="headerlink" title="æ¨å¯¼æ­£ç¡®æ€§å®éªŒ"></a>æ¨å¯¼æ­£ç¡®æ€§å®éªŒ</h2><p><del>è¿™æ¬¡ä½œä¸šæ²¡æœ‰æé«˜é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ä¸Šé¢çš„æ¨å¯¼çš„æ­£ç¡®æ€§ï¼š</del><br><strong>æˆ‘ç¨å¾®ä¿®æ”¹äº†Renderå‡½æ•°ï¼Œè®©ä»–å¯ä»¥æ¥å—ä¸€ä¸ªzNearçš„å‚æ•°ï¼Œæ–¹ä¾¿æˆ‘æ¥å®éªŒï¼Œç„¶åå¯¹è¾“å‡ºä¹Ÿåšäº†ä¸€äº›ä¿®æ”¹ï¼Œè¿™æ˜¯ä¿®æ”¹åçš„Renderå‡½æ•°ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">Renderer::Render</span><span class="params">(<span class="type">const</span> Scene&amp; scene,<span class="type">const</span> <span class="type">int</span> zNear)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Vector3f&gt; <span class="title function_">framebuffer</span><span class="params">(scene.width * scene.height)</span>;</span><br><span class="line">    <span class="type">float</span> scale = <span class="built_in">std</span>::<span class="built_in">tan</span>(deg2rad(scene.fov * <span class="number">0.5f</span>));</span><br><span class="line">    <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line">    <span class="comment">// Use this variable as the eye position to start your rays.</span></span><br><span class="line">    Vector3f <span class="title function_">eye_pos</span><span class="params">(<span class="number">0</span>)</span>;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">float</span> x;</span><br><span class="line">            <span class="type">float</span> y;</span><br><span class="line">            x=(((i+<span class="number">0.5f</span>)/static_cast&lt;<span class="type">float</span>&gt;(scene.width<span class="number">-1</span>)*<span class="number">2.0f</span>)<span class="number">-1.0f</span>)*scale*imageAspectRatio*zNear;</span><br><span class="line">            y=(<span class="number">1.0f</span>-(j+<span class="number">0.5f</span>)/static_cast&lt;<span class="type">float</span>&gt;(scene.height<span class="number">-1</span>)*<span class="number">2.0f</span>)*scale*zNear;</span><br><span class="line">            Vector3f dir = normalize(Vector3f(x, y, -zNear));</span><br><span class="line">            framebuffer[m++] = castRay(eye_pos, dir, scene, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        UpdateProgress(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// save framebuffer to file</span></span><br><span class="line">    <span class="built_in">string</span> filename=<span class="string">&quot;binary&quot;</span>;</span><br><span class="line">    filename+=<span class="string">&quot;_&quot;</span>+<span class="built_in">std</span>::to_string(zNear)+<span class="string">&quot;.ppm&quot;</span>;</span><br><span class="line">    FILE* fp = fopen(filename.c_str(), <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i) &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">        color[<span class="number">0</span>] = (<span class="type">char</span>)(<span class="number">255</span> * clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x));</span><br><span class="line">        color[<span class="number">1</span>] = (<span class="type">char</span>)(<span class="number">255</span> * clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y));</span><br><span class="line">        color[<span class="number">2</span>] = (<span class="type">char</span>)(<span class="number">255</span> * clamp(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z));</span><br><span class="line">        fwrite(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h4><p><code>./RayTracing</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729204127312-578334550_1726324372935.png" alt="image"><br><code>./RayTracing 2</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729204138578-2018817066_1726324372935.png" alt="image"><br><code>./RayTracing 10</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729204142517-1147206677_1726324372935.png" alt="image"></p>
<p><strong>å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºç»“æœå®Œå…¨ä¸€æ ·ï¼Œå®é™…ä¸Šä¹Ÿåªæ˜¯å¯¹ä¸€ä¸ªå•ä½åŒ–ä¹‹å‰çš„å‘é‡åšäº†æ•°ä¹˜è€Œä»¥ï¼Œå¯¹ç»“æœå½“ç„¶æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯å¯¹æˆ‘ä»¬ç†è§£è¿™ä¸ªä¸œè¥¿åº”è¯¥ä¼šæœ‰äº›ä½œç”¨ã€‚</strong></p>
<h2 id="ä»£ç æ±‡æ€»"><a href="#ä»£ç æ±‡æ€»" class="headerlink" title="ä»£ç æ±‡æ€»"></a>ä»£ç æ±‡æ€»</h2><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729091143217-642551847_1726324391043.png" alt="image"></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17591015.html">ä¸‹ä¸€ç¯‡ï¼šRay Tracingå…‰çº¿è¿½è¸ªåŠ é€Ÿ</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589119.html">ä¸Šä¸€ç¯‡ï¼šBezieræ›²çº¿çš„ç»˜åˆ¶</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork4" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/6999/" class="article-date">
      <time datetime="2023-07-28T23:17:00.000Z" itemprop="datePublished">2023-07-28</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/6999/">games101 HomeWork4</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="Games101-HomeWork4"><a href="#Games101-HomeWork4" class="headerlink" title="Games101 HomeWork4"></a>Games101 HomeWork4</h1><ul>
<li><strong>bezierï¼šè¯¥å‡½æ•°å®ç°ç»˜åˆ¶ BÃ©zier æ›²çº¿çš„åŠŸèƒ½ã€‚å®ƒä½¿ç”¨ä¸€ä¸ªæ§åˆ¶ç‚¹åºåˆ—å’Œä¸€ä¸ªOpenCVï¼šï¼šMat å¯¹è±¡ä½œä¸ºè¾“å…¥ï¼Œæ²¡æœ‰è¿”å›å€¼ã€‚å®ƒä¼šä½¿ t åœ¨ 0 åˆ° 1 çš„èŒƒå›´å†…è¿›è¡Œè¿­ä»£ï¼Œå¹¶åœ¨æ¯æ¬¡è¿­ä»£ä¸­ä½¿ t å¢åŠ ä¸€ä¸ªå¾®å°å€¼ã€‚å¯¹äºæ¯ä¸ªéœ€è¦è®¡ç®—çš„ tï¼Œå°†è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•° recursive_bezierï¼Œç„¶åè¯¥å‡½æ•°å°†è¿”å›åœ¨ BÃ©zier æ›²çº¿ä¸Š tå¤„çš„ç‚¹ã€‚æœ€åï¼Œå°†è¿”å›çš„ç‚¹ç»˜åˆ¶åœ¨ OpenCV ï¼šï¼šMat å¯¹è±¡ä¸Šã€‚</strong></li>
<li><strong>recursive_bezierï¼šè¯¥å‡½æ•°ä½¿ç”¨ä¸€ä¸ªæ§åˆ¶ç‚¹åºåˆ—å’Œä¸€ä¸ªæµ®ç‚¹æ•° t ä½œä¸ºè¾“å…¥ï¼Œå®ç° de Casteljau ç®—æ³•æ¥è¿”å› BÃ©zier æ›²çº¿ä¸Šå¯¹åº”ç‚¹çš„åæ ‡ã€‚</strong></li>
</ul>
<h3 id="bezier-recursive-bezier"><a href="#bezier-recursive-bezier" class="headerlink" title="bezier &amp; recursive_bezier"></a>bezier &amp; recursive_bezier</h3><p><strong><code>bezier</code>å‡½æ•°éœ€è¦å®Œæˆæ•´ä¸ªBezieræ›²çº¿çš„ç»˜åˆ¶ï¼Œè€Œ<code>recursive_bezier</code>éœ€è¦å®ŒæˆBezieræ›²çº¿ä¸­ä»»æ„ä¸€ç‚¹çš„åæ ‡è®¡ç®—ã€‚</strong></p>
<h4 id="bezier"><a href="#bezier" class="headerlink" title="bezier"></a>bezier</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">bezier</span><span class="params">(<span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; &amp;control_points, cv::Mat &amp;window)</span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Iterate through all t = 0 to t = 1 with small steps, and call de Casteljau&#x27;s </span></span><br><span class="line">    <span class="comment">// recursive Bezier algorithm.</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">double</span> i=<span class="number">0</span>;i&lt;<span class="number">1.</span>;i+=<span class="number">0.0001</span>)&#123;</span><br><span class="line">        <span class="keyword">auto</span> point=recursive_bezier(control_points,i);</span><br><span class="line">        window.at&lt;cv::Vec3b&gt;(point.y,point.x)[<span class="number">1</span>]=<span class="number">255</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è¿™é‡Œæœ‰ä¸€ç‚¹éœ€è¦å¼ºè°ƒï¼Œwindow.at&lt;&gt;()çš„ç¬¬ä¸€ä¸ªå…ƒç´ [0]æ˜¯Bé€šé“ï¼Œè€Œ[2]æ‰æ˜¯Ré€šé“ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ[1]ä¹Ÿå°±æ˜¯Gé€šé“è®¾ç½®ä¸º255,è¿™æ ·æ‰æ»¡è¶³ä½œä¸šè¦æ±‚ä¸­çš„è®¾ç½®ä¸ºç»¿è‰²ã€‚</strong></p>
<h4 id="recursive-bezier"><a href="#recursive-bezier" class="headerlink" title="recursive_bezier"></a>recursive_bezier</h4><p><strong>ç»™å®šæ‰€æœ‰çš„æ§åˆ¶ç‚¹ï¼Œæ¯å¯¹åº”ä¸€ä¸ªtå€¼éœ€è¦ç»™å‡ºå¯¹åº”çš„åæ ‡ã€‚é€’å½’å¾ˆå®¹æ˜“å®ç°ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cv::Point2f <span class="title function_">recursive_bezier</span><span class="params">(<span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; &amp;control_points, <span class="type">float</span> t)</span>&#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement de Casteljau&#x27;s algorithm</span></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; recursive_list;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; control_points.size() - <span class="number">1</span>; i++)&#123;</span><br><span class="line">        recursive_list.push_back(((<span class="number">1</span> - t)) * (control_points[i]) + (t) * (control_points[i + <span class="number">1</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(recursive_list.size()==<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> recursive_list[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">return</span> recursive_bezier(recursive_list,t);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ä¿®æ”¹mainå‡½æ•°çš„ç»˜åˆ¶è¯­å¥</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//main</span></span><br><span class="line">`		<span class="keyword">if</span> (control_points.size() == <span class="number">4</span>) </span><br><span class="line">        &#123;</span><br><span class="line">            naive_bezier(control_points, window);</span><br><span class="line">            bezier(control_points, window);</span><br><span class="line">            <span class="comment">// bezier_with_antialiasing(control_points,window);</span></span><br><span class="line">            cv::imshow(<span class="string">&quot;Bezier Curve&quot;</span>, window);</span><br><span class="line">            cv::imwrite(<span class="string">&quot;my_bezier_curve.png&quot;</span>, window);</span><br><span class="line">            key = cv::waitKey(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h4 id="make-build"><a href="#make-build" class="headerlink" title="make&amp;build"></a>make&amp;build</h4><p><code>./BezierCurve</code><br><strong>éšä¾¿ç‚¹å‡»å››ä¸ªç‚¹ï¼Œå¾—åˆ°è¿™æ ·çš„å›¾åƒï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729092648250-1244234009_1726324391043.jpg" alt="image"><br><strong>å¦‚æœä¸æ˜¯é»„è‰²è¯·æ£€æŸ¥ä½ çš„bezierå‡½æ•°ï¼Œåœ¨ä½¿ç”¨at&lt;&gt;()è®¾ç½®é¢œè‰²çš„æ—¶å€™é€‰æ‹©çš„ä¸‹æ ‡æ˜¯ä¸æ˜¯[1]ã€‚</strong></p>
<h3 id="æé«˜é¢˜"><a href="#æé«˜é¢˜" class="headerlink" title="æé«˜é¢˜"></a>æé«˜é¢˜</h3><p><strong>å¯¹äºä¸€ä¸ªæ›²çº¿ä¸Šçš„ç‚¹ï¼Œä¸åªæŠŠå®ƒå¯¹åº”äºä¸€ä¸ªåƒç´ ï¼Œä½ éœ€è¦æ ¹æ®åˆ°åƒç´ ä¸­å¿ƒçš„è·ç¦»æ¥è€ƒè™‘ä¸å®ƒç›¸é‚»çš„åƒç´ çš„é¢œè‰²ã€‚</strong><br><strong>è¦æ±‚åˆ©ç”¨è·ç¦»å®ç°åèµ°æ ·ï¼Œæˆ‘è®¾è®¡äº†è¿™ä¹ˆä¸€ä¸ªé€‰æ‹©æ–¹å¼ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729095031771-280781984_1726324391043.png" alt="image"><br><strong>æ ¸å¿ƒé€‰æ‹©ä»£ç å¦‚ä¸‹</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> color = <span class="built_in">std</span>::max(static_cast&lt;uchar&gt;((<span class="number">255</span>*(<span class="number">2</span>-distance)/<span class="number">2</span>)),window.at&lt;cv::Vec3b&gt;(miny+j,minx+k)[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<p><strong>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">inline</span> <span class="type">float</span> <span class="title function_">get_distance</span><span class="params">(<span class="type">const</span> cv::Point2f&amp;p1,<span class="type">const</span> cv::Point2f&amp;p2)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">bezier_with_antialiasing</span><span class="params">(<span class="type">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;cv::Point2f&gt; &amp;control_points, cv::Mat &amp;window)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">float</span> i = <span class="number">0</span>; i &lt; <span class="number">1</span>; i+=<span class="number">0.001f</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> point = recursive_bezier(control_points,i);</span><br><span class="line">        <span class="type">float</span> minx=<span class="built_in">std</span>::<span class="built_in">floor</span>(point.x),miny=<span class="built_in">std</span>::<span class="built_in">floor</span>(point.y);</span><br><span class="line">        <span class="comment">//calculate the four points&#x27;s color arount the input point </span></span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>;k&lt;=<span class="number">1</span>;k++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;=<span class="number">1</span>;j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">float</span> distance=get_distance(cv::Point2f(miny+j,minx+k),point);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;distance&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="type">float</span> color = <span class="built_in">std</span>::max(static_cast&lt;uchar&gt;((<span class="number">255</span>*(<span class="number">2</span>-distance)/<span class="number">2</span>)),window.at&lt;cv::Vec3b&gt;(miny+j,minx+k)[<span class="number">1</span>]);</span><br><span class="line">                window.at&lt;cv::Vec3b&gt;(miny+j, minx+k)[<span class="number">1</span>] = color;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-BezierCurve-a"><a href="#è¿è¡Œ-BezierCurve-a" class="headerlink" title="è¿è¡Œ./BezierCurve -a"></a>è¿è¡Œ<code>./BezierCurve -a</code></h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729095151865-1624406335_1726324391043.png" alt="image"><br><strong>æ”¾å¤§è§‚å¯Ÿï¼Œå¯ä»¥çœ‹åˆ°ä¸é”™çš„åèµ°æ ·æ•ˆæœã€‚</strong><br><img src="https://img2023.cnblogs.com/blog/3080748/202307/3080748-20230729095151865-1624406335.png" alt="image"></p>
<h3 id="ç•ªå¤–ï¼šä¸åŒæ•°é‡çš„æ§åˆ¶ç‚¹"><a href="#ç•ªå¤–ï¼šä¸åŒæ•°é‡çš„æ§åˆ¶ç‚¹" class="headerlink" title="ç•ªå¤–ï¼šä¸åŒæ•°é‡çš„æ§åˆ¶ç‚¹"></a>ç•ªå¤–ï¼šä¸åŒæ•°é‡çš„æ§åˆ¶ç‚¹</h3><p><strong>æˆ‘å®ç°äº†ä¸€äº›å°æŠŠæˆï¼Œå¯ä»¥åœ¨æ§åˆ¶å°ä¸­æ§åˆ¶æ˜¯å¦å¼€å¯antiå’Œæ§åˆ¶æ§åˆ¶ç‚¹çš„æ•°é‡ï¼Œä½ å¯ä»¥é”®å…¥</strong><br><code>./BezierCurve \--help</code><br><strong>æ¥è·å–ä½¿ç”¨å‘å¯¼ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729095442467-1616788326_1726324407642.png" alt="image"></p>
<h4 id="å››ä¸ªç‚¹çš„Bezieræ›²çº¿ç»˜åˆ¶å±•ç¤º"><a href="#å››ä¸ªç‚¹çš„Bezieræ›²çº¿ç»˜åˆ¶å±•ç¤º" class="headerlink" title="å››ä¸ªç‚¹çš„Bezieræ›²çº¿ç»˜åˆ¶å±•ç¤º"></a>å››ä¸ªç‚¹çš„Bezieræ›²çº¿ç»˜åˆ¶å±•ç¤º</h4><p><strong>å‰é¢çš„å®ç°å¯ä»¥åšåˆ°ç»˜åˆ¶ä»»æ„æ•°é‡æ§åˆ¶ç‚¹çš„Bezieræ›²çº¿ï¼Œåªéœ€è¦ä¿®æ”¹CallBackå‡½æ•°å°±å¥½äº†ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> point_num=<span class="number">4</span>;<span class="comment">//global variale</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">mouse_handler</span><span class="params">(<span class="type">int</span> event, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> flags, <span class="type">void</span> *userdata)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (event == cv::EVENT_LBUTTONDOWN &amp;&amp; control_points.size() &lt; point_num)<span class="comment">//è¿™é‡Œä¿®æ”¹ä¸ºäº†point_num</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Left button of the mouse is clicked - position (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span></span><br><span class="line">        &lt;&lt; y &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">        control_points.emplace_back(x, y);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>./BezierCurve \-a 5</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729100501365-1401361587_1726324407642.png" alt="image"><br><strong>ç”šè‡³10ä¸ªç‚¹ï¼Œå…¶å®éƒ½æ˜¯ä¸€æ ·çš„æ“ä½œ</strong><br><code>./BezierCurve \-a 10</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230729100601157-2081347811_1726324407642.png" alt="image"></p>
<h4 id="mainå‡½æ•°"><a href="#mainå‡½æ•°" class="headerlink" title="mainå‡½æ•°"></a>mainå‡½æ•°</h4><p><strong>è¿™é‡Œç»™å‡ºmainå‡½æ•°çš„å…·ä½“å®ç°</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">const</span> <span class="type">char</span>*argv[])</span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span>(argc==<span class="number">2</span>&amp;&amp;<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>])==<span class="string">&quot;--help&quot;</span>)&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;The first data is use antialiasing or not.\nInput &#x27;-a&#x27; to use it!\nInput &#x27;-&#x27; to defualt\n&quot;</span></span><br><span class="line">        &lt;&lt;<span class="string">&quot;The second data is number of contol point, maybe you should input more than 4&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    cv::Mat window = cv::Mat(<span class="number">700</span>, <span class="number">700</span>, CV_8UC3, cv::Scalar(<span class="number">0</span>));</span><br><span class="line">    cv::cvtColor(window, window, cv::COLOR_BGR2RGB);</span><br><span class="line">    cv::namedWindow(<span class="string">&quot;Bezier Curve&quot;</span>, cv::WINDOW_AUTOSIZE);</span><br><span class="line">    cv::setMouseCallback(<span class="string">&quot;Bezier Curve&quot;</span>, mouse_handler, nullptr);</span><br><span class="line">    <span class="type">bool</span> use_anti =<span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> key = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;=<span class="number">2</span>&amp;&amp;<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>])==<span class="string">&quot;-a&quot;</span>)use_anti=<span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;=<span class="number">3</span>&amp;&amp;<span class="built_in">std</span>::stoi(argv[<span class="number">2</span>])&gt;<span class="number">4</span>)point_num=<span class="built_in">std</span>::stoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">while</span> (key != <span class="number">27</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;point : control_points) </span><br><span class="line">        &#123;</span><br><span class="line">            cv::circle(window, point, <span class="number">3</span>, &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;, <span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;point_num&quot;</span>&lt;&lt;control_points.size()&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (control_points.size() == point_num) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> filename=<span class="string">&quot;bezier_&quot;</span>+<span class="built_in">std</span>::to_string(point_num)+<span class="string">&quot;num_&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(!use_anti)&#123;</span><br><span class="line">                filename+=<span class="string">&quot;_without_anti&quot;</span>;</span><br><span class="line">                naive_bezier(control_points, window);</span><br><span class="line">                bezier(control_points, window);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                filename+=<span class="string">&quot;with_anti&quot;</span>;</span><br><span class="line">                bezier_with_antialiasing(control_points,window);</span><br><span class="line">            &#125;</span><br><span class="line">            filename+=<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">            cv::imshow(<span class="string">&quot;Bezier Curve&quot;</span>, window);</span><br><span class="line">            cv::imwrite(filename, window);</span><br><span class="line">            key = cv::waitKey(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cv::imshow(<span class="string">&quot;Bezier Curve&quot;</span>, window);</span><br><span class="line">        key = cv::waitKey(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="ä»£ç æ±‡æ€»"><a href="#ä»£ç æ±‡æ€»" class="headerlink" title="ä»£ç æ±‡æ€»"></a>ä»£ç æ±‡æ€»</h2><p><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/tree/master/Assignment4">zhywyt-github</a></p>
<h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589717.html">ä¸‹ä¸€ç¯‡ï¼šRay Tracingå…‰çº¿è¿½è¸ª</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17577186.html">ä¸Šä¸€ç¯‡ï¼šobjå¯¼å…¥ä¸phong</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/55574/" class="article-date">
      <time datetime="2023-07-27T14:21:00.000Z" itemprop="datePublished">2023-07-27</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/55574/">games101 HomeWork3</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="Games101-HomeWork3"><a href="#Games101-HomeWork3" class="headerlink" title="Games101 HomeWork3"></a>Games101 HomeWork3</h1><h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="ä½œä¸šè¦æ±‚"><a href="#ä½œä¸šè¦æ±‚" class="headerlink" title="ä½œä¸šè¦æ±‚"></a>ä½œä¸šè¦æ±‚</h2><p><strong>ç¬¬ä¸‰æ¬¡ä½œä¸šæ‰æ˜¯çœŸæ­£ä¸Šå¼ºåº¦çš„ä½œä¸šï¼Œä½œä¸šè¦æ±‚å’Œè´¨é‡éƒ½ç‰¹åˆ«é«˜ï¼Œå…ˆæ¥çœ‹çœ‹æ‰€æœ‰çš„è¦æ±‚ï¼š</strong></p>
<ul>
<li><strong>1 . ä¿®æ”¹å‡½æ•°rasterize_triangle(const Triangle&amp; t) in rasterizer.cpp: åœ¨æ­¤å¤„å®ç°ä¸ä½œä¸š 2 ç±»ä¼¼çš„æ’å€¼ç®—æ³•ï¼Œå®ç°æ³•å‘é‡ã€é¢œè‰²ã€çº¹ç†é¢œè‰²çš„æ’å€¼ã€‚</strong></li>
<li><strong>2 . ä¿®æ”¹å‡½æ•° get_projection_matrix() in main.cpp: å°†ä½ è‡ªå·±åœ¨ä¹‹å‰çš„å®éªŒä¸­å®ç°çš„æŠ•å½±çŸ©é˜µå¡«åˆ°æ­¤å¤„ï¼Œæ­¤æ—¶ä½ å¯ä»¥è¿è¡Œ.&#x2F;Rasterizer output.png normalæ¥è§‚å¯Ÿæ³•å‘é‡å®ç°ç»“æœã€‚</strong></li>
<li><strong>3 . ä¿®æ”¹å‡½æ•° phong_fragment_shader() in main.cpp: å®ç° Blinn-Phong æ¨¡å‹è®¡ç®— Fragment Color.</strong></li>
<li><strong>4 . ä¿®æ”¹å‡½æ•° texture_fragment_shader() in main.cpp: åœ¨å®ç° Blinn-Phongçš„åŸºç¡€ä¸Šï¼Œå°†çº¹ç†é¢œè‰²è§†ä¸ºå…¬å¼ä¸­çš„ kdï¼Œå®ç° Texture Shading FragmentShader.</strong></li>
<li><strong>5 . ä¿®æ”¹å‡½æ•° bump_fragment_shader() in main.cpp: åœ¨å®ç° Blinn-Phong çš„åŸºç¡€ä¸Šï¼Œä»”ç»†é˜…è¯»è¯¥å‡½æ•°ä¸­çš„æ³¨é‡Šï¼Œå®ç° Bump mapping.</strong></li>
<li><strong>6 . ä¿®æ”¹å‡½æ•° displacement_fragment_shader() in main.cpp: åœ¨å®ç° Bumpmapping çš„åŸºç¡€ä¸Šï¼Œå®ç° displacement mapping.</strong><br><code>æé«˜é¢˜</code></li>
<li><strong>7 .å°è¯•æ›´å¤šæ¨¡å‹</strong></li>
<li><strong>8 .åŒçº¿æ€§çº¹ç†æ’å€¼</strong><br>ä¸è¦æ…Œå¼ ï¼Œä¸€ä¸ªä¸€ä¸ªæ¥ã€‚å…ˆçœ‹ç¬¬ä¸€é¢˜</li>
</ul>
<h3 id="rasterize-triangleä¸­çš„æ’å€¼"><a href="#rasterize-triangleä¸­çš„æ’å€¼" class="headerlink" title="rasterize_triangleä¸­çš„æ’å€¼"></a>rasterize_triangleä¸­çš„æ’å€¼</h3><p><strong>æˆ‘ä»¬åœ¨ç¬¬äºŒé¢˜2x2çš„è¶…é‡‡æ ·çš„åŸºç¡€ä¸Šè¿›è¡Œï¼Œå…ˆçœ‹çœ‹é¢˜ç›®çš„æç¤ºï¼š</strong></p>
<p>rasterize_triangle å‡½æ•°ä¸ä½ åœ¨ä½œä¸š2 ä¸­å®ç°çš„å†…å®¹ç›¸ä¼¼ã€‚ä¸åŒä¹‹å¤„åœ¨äºè¢«<br>è®¾å®šçš„æ•°å€¼å°†ä¸å†æ˜¯<strong>å¸¸æ•°</strong>ï¼Œè€Œæ˜¯æŒ‰ç…§ Barycentric Coordinates å¯¹æ³•å‘é‡ã€é¢œ<br>è‰²ã€çº¹ç†é¢œè‰²ä¸åº•çº¹é¢œè‰²(Shading Colors) è¿›è¡Œæ’å€¼ã€‚å›å¿†æˆ‘ä»¬ä¸Šæ¬¡ä¸ºäº†è®¡ç®—<br>z value è€Œæä¾›çš„**[alpha, beta, gamma]<strong>ï¼Œè¿™æ¬¡ä½ å°†éœ€è¦å°†å…¶åº”ç”¨åœ¨</strong>å…¶ä»–å‚<br>æ•°<strong>çš„æ’å€¼ä¸Šã€‚ä½ éœ€è¦åšçš„æ˜¯</strong>è®¡ç®—æ’å€¼åçš„é¢œè‰²**ï¼Œå¹¶å°†Fragment Shader è®¡ç®—å¾—<br>åˆ°çš„é¢œè‰²å†™å…¥ framebufferï¼Œè¿™è¦æ±‚ä½ <strong>é¦–å…ˆä½¿ç”¨æ’å€¼å¾—åˆ°çš„ç»“æœè®¾ç½® fragment<br>shader payload</strong>ï¼Œå¹¶<strong>è°ƒç”¨ fragment shader</strong> å¾—åˆ°è®¡ç®—ç»“æœã€‚<br><strong>å¯ä»¥çœ‹è§ï¼Œè¿™é‡ŒåŸºæœ¬ç»™å‡ºäº†æ’å€¼çš„æ“ä½œæ­¥éª¤ï¼Œè¿™é‡Œå¯¹ä¸€ä¸ªé‡å¿ƒåæ ‡åšä¸€ä¸ªè§£é‡Šï¼š</strong></p>
<h4 id="é‡å¿ƒåæ ‡ï¼ˆBarycentric-Coordinatesï¼‰"><a href="#é‡å¿ƒåæ ‡ï¼ˆBarycentric-Coordinatesï¼‰" class="headerlink" title="é‡å¿ƒåæ ‡ï¼ˆBarycentric Coordinatesï¼‰"></a>é‡å¿ƒåæ ‡ï¼ˆBarycentric Coordinatesï¼‰</h4><p><strong>ç»™å®šä¸‰è§’å½¢çš„ä¸‰ç‚¹åæ ‡A, B, Cï¼Œè¯¥å¹³é¢å†…ä¸€ç‚¹(x,y)å¯ä»¥å†™æˆè¿™ä¸‰ç‚¹åæ ‡çš„çº¿æ€§ç»„åˆå½¢å¼ï¼Œå³ \((x,y)&#x3D;\alpha A+\beta B+\gamma C\) å¹¶ä¸”æœ‰\(\alpha + \beta +\gamma &#x3D;1\)ç‚¹\((\alpha ,\beta ,\gamma )\)å°±æ˜¯è¿™ä¸ªç‚¹çš„é‡å¿ƒåæ ‡ã€‚å…³äºé‡å¿ƒåæ ‡çš„æ±‚æ³•ï¼Œè¿™é‡Œç›´æ¥ç»™å‡ºä»£ç ï¼Œä¸åšæ¨å¯¼ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é‡å¿ƒåæ ‡çš„æ±‚è§£</span></span><br><span class="line"><span class="type">static</span> <span class="built_in">std</span>::tuple&lt;<span class="type">float</span>, <span class="type">float</span>, <span class="type">float</span>&gt; <span class="title function_">computeBarycentric2D</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">const</span> Vector4f* v)</span>&#123;</span><br><span class="line">    <span class="type">float</span> c1 = (x*(v[<span class="number">1</span>].y() - v[<span class="number">2</span>].y()) + (v[<span class="number">2</span>].x() - v[<span class="number">1</span>].x())*y + v[<span class="number">1</span>].x()*v[<span class="number">2</span>].y() - v[<span class="number">2</span>].x()*v[<span class="number">1</span>].y()) / (v[<span class="number">0</span>].x()*(v[<span class="number">1</span>].y() - v[<span class="number">2</span>].y()) + (v[<span class="number">2</span>].x() - v[<span class="number">1</span>].x())*v[<span class="number">0</span>].y() + v[<span class="number">1</span>].x()*v[<span class="number">2</span>].y() - v[<span class="number">2</span>].x()*v[<span class="number">1</span>].y());</span><br><span class="line">    <span class="type">float</span> c2 = (x*(v[<span class="number">2</span>].y() - v[<span class="number">0</span>].y()) + (v[<span class="number">0</span>].x() - v[<span class="number">2</span>].x())*y + v[<span class="number">2</span>].x()*v[<span class="number">0</span>].y() - v[<span class="number">0</span>].x()*v[<span class="number">2</span>].y()) / (v[<span class="number">1</span>].x()*(v[<span class="number">2</span>].y() - v[<span class="number">0</span>].y()) + (v[<span class="number">0</span>].x() - v[<span class="number">2</span>].x())*v[<span class="number">1</span>].y() + v[<span class="number">2</span>].x()*v[<span class="number">0</span>].y() - v[<span class="number">0</span>].x()*v[<span class="number">2</span>].y());</span><br><span class="line">    <span class="type">float</span> c3 = (x*(v[<span class="number">0</span>].y() - v[<span class="number">1</span>].y()) + (v[<span class="number">1</span>].x() - v[<span class="number">0</span>].x())*y + v[<span class="number">0</span>].x()*v[<span class="number">1</span>].y() - v[<span class="number">1</span>].x()*v[<span class="number">0</span>].y()) / (v[<span class="number">2</span>].x()*(v[<span class="number">0</span>].y() - v[<span class="number">1</span>].y()) + (v[<span class="number">1</span>].x() - v[<span class="number">0</span>].x())*v[<span class="number">2</span>].y() + v[<span class="number">0</span>].x()*v[<span class="number">1</span>].y() - v[<span class="number">1</span>].x()*v[<span class="number">0</span>].y());</span><br><span class="line">    <span class="keyword">return</span> &#123;c1,c2,c3&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724150810522-1121172651_1726324407642.png" alt="image"></p>
<h4 id="æ’å€¼"><a href="#æ’å€¼" class="headerlink" title="æ’å€¼"></a>æ’å€¼</h4><p><strong>æœ‰äº†é‡å¿ƒå…¬å¼ï¼Œå°±å¯ä»¥å¯¹å„ä¸ªå±æ€§è¿›è¡Œæ’å€¼äº†ï¼Œå…ˆå†™ä¸€ä¸ªå·¥å…·å‡½æ•°<code>è¿™é‡Œæ¡†æ¶ç»™å‡ºäº†ï¼Œç›´æ¥è°ƒç”¨å°±å¥½</code>ï¼Œæ¥è®¡ç®—å„ç§æ’å€¼ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸‰ç»´å‘é‡ç‰ˆæœ¬ï¼Œé¢œè‰²ã€æ³•çº¿ã€view_pos</span></span><br><span class="line"><span class="type">static</span> Eigen::Vector3f <span class="title function_">interpolate</span><span class="params">(<span class="type">float</span> alpha, <span class="type">float</span> beta, <span class="type">float</span> gamma, <span class="type">const</span> Eigen::Vector3f&amp; vert1, <span class="type">const</span> Eigen::Vector3f&amp; vert2, <span class="type">const</span> Eigen::Vector3f&amp; vert3, <span class="type">float</span> weight)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (alpha * vert1 + beta * vert2 + gamma * vert3) / weight;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//äºŒç»´å‘é‡ç‰ˆæœ¬ï¼Œç”¨äºçº¹ç†åæ ‡</span></span><br><span class="line"><span class="type">static</span> Eigen::Vector2f <span class="title function_">interpolate</span><span class="params">(<span class="type">float</span> alpha, <span class="type">float</span> beta, <span class="type">float</span> gamma, <span class="type">const</span> Eigen::Vector2f&amp; vert1, <span class="type">const</span> Eigen::Vector2f&amp; vert2, <span class="type">const</span> Eigen::Vector2f&amp; vert3, <span class="type">float</span> weight)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> u = (alpha * vert1[<span class="number">0</span>] + beta * vert2[<span class="number">0</span>] + gamma * vert3[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">auto</span> v = (alpha * vert1[<span class="number">1</span>] + beta * vert2[<span class="number">1</span>] + gamma * vert3[<span class="number">1</span>]);</span><br><span class="line">    u /= weight;</span><br><span class="line">    v /= weight;</span><br><span class="line">    <span class="keyword">return</span> Eigen::Vector2f(u, v);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç„¶åå°±æ˜¯æ’å€¼çš„å®ç°äº†ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span>[alpha, beta, gamma] = computeBarycentric2D(i+<span class="number">0.5f</span>, j+<span class="number">0.5f</span>, t.v);</span><br><span class="line"><span class="keyword">auto</span> interpolated_color=interpolate(alpha,beta,gamma,t.color[<span class="number">0</span>],t.color[<span class="number">1</span>],t.color[<span class="number">2</span>],<span class="number">1</span>);</span><br><span class="line"><span class="keyword">auto</span> interpolated_normal=interpolate(alpha,beta,gamma,t.normal[<span class="number">0</span>],t.normal[<span class="number">1</span>],t.normal[<span class="number">2</span>],<span class="number">1</span>).normalized();</span><br><span class="line"><span class="keyword">auto</span> interpolated_shadingcoords=interpolate(alpha,beta,gamma,view_pos[<span class="number">0</span>],view_pos[<span class="number">1</span>],view_pos[<span class="number">2</span>],<span class="number">1</span>);</span><br><span class="line"><span class="comment">//äºŒç»´ç‰ˆæœ¬</span></span><br><span class="line"><span class="keyword">auto</span> interpolated_texcoords=interpolate(alpha,beta,gamma,t.tex_coords[<span class="number">0</span>],t.tex_coords[<span class="number">1</span>],t.tex_coords[<span class="number">2</span>],<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>æœ€åè°ƒç”¨<code>fragment_shader</code>è®¡ç®—æœ€åçš„é¢œè‰²å€¼</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload.view_pos = interpolated_shadingcoords;</span><br><span class="line"><span class="keyword">auto</span> pixel_color = fragment_shader(payload);</span><br><span class="line"><span class="comment">// check zbuff</span></span><br><span class="line">set_pixel(Eigen::Vector2i(i,j),pixel_color*IsInTriangleCount/<span class="number">4.0f</span>);</span><br></pre></td></tr></table></figure>

<h3 id="get-projection-matrix-æŠ•å½±çŸ©é˜µ"><a href="#get-projection-matrix-æŠ•å½±çŸ©é˜µ" class="headerlink" title="get_projection_matrix() æŠ•å½±çŸ©é˜µ"></a>get_projection_matrix() æŠ•å½±çŸ©é˜µ</h3><p><strong>å‰é¢æè¿‡äº†ï¼Œè¿™é‡Œåªç»™å‡ºä»£ç ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Matrix4f <span class="title function_">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::Identity();</span><br><span class="line">    eye_fov=eye_fov/<span class="number">180</span>*MY_PI;</span><br><span class="line">    projection&lt;&lt;<span class="number">1</span>/(aspect_ratio*<span class="built_in">tan</span>(eye_fov/<span class="number">2.0f</span>)) ,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">1</span>/<span class="built_in">tan</span>(eye_fov/<span class="number">2.0f</span>),<span class="number">0</span>,<span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">0</span>,-(zFar+zNear)/(zFar-zNear),<span class="number">2</span>*zFar*zNear/(zNear-zFar),</span><br><span class="line">                <span class="number">0</span>,<span class="number">0</span>,<span class="number">-1</span>,<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> projection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-normal-png-normal"><a href="#è¿è¡Œ-Rasterizer-normal-png-normal" class="headerlink" title="è¿è¡Œ ./Rasterizer normal.png normal"></a>è¿è¡Œ <code>./Rasterizer normal.png normal</code></h4><p>normal.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724153730332-1148351579_1726324407642.png" alt="image"></p>
<h3 id="phong-fragment-shader-å…‰ç…§æ¨¡å‹"><a href="#phong-fragment-shader-å…‰ç…§æ¨¡å‹" class="headerlink" title="phong_fragment_shader() å…‰ç…§æ¨¡å‹"></a>phong_fragment_shader() å…‰ç…§æ¨¡å‹</h3><p><strong>æ¥ä¸‹æ¥éœ€è¦å®ç°çš„æ˜¯Bline-Pongå…‰ç…§ç³»ç»Ÿï¼Œé¦–å…ˆæ¥å›å¿†ä¸€ä¸‹Bline-Pongçš„æ“ä½œæ­¥éª¤</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724154952168-2123046406_1726324422982.png" alt="image"></p>
<h4 id="ç¯å¢ƒè‰²Ambient"><a href="#ç¯å¢ƒè‰²Ambient" class="headerlink" title="ç¯å¢ƒè‰²Ambient"></a>ç¯å¢ƒè‰²Ambient</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724155154637-1147583584_1726324422982.png" alt="image"></p>
<h4 id="æ¼«åå°„Diffuse"><a href="#æ¼«åå°„Diffuse" class="headerlink" title="æ¼«åå°„Diffuse"></a>æ¼«åå°„Diffuse</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724155045414-446559460_1726324422982.png" alt="image"></p>
<h4 id="é•œé¢åå°„Specular"><a href="#é•œé¢åå°„Specular" class="headerlink" title="é•œé¢åå°„Specular"></a>é•œé¢åå°„Specular</h4><p><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724155117823-1687347092_1726324422982.png" alt="image"></p>
<h4 id="ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰"><a href="#ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰" class="headerlink" title="ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰"></a>ä»£ç å®ç°ï¼ˆçœ‹æ³¨é‡Šï¼‰</h4><p><strong>è§£é‡Šä¸€ä¸‹ä¸€äº›æ“ä½œ</strong></p>
<ul>
<li><strong>Eigen::Vector3f::cwiseProduct è¿”å›ä¸¤ä¸ªçŸ©é˜µï¼ˆå‘é‡ï¼‰åŒä½ç½®çš„å…ƒç´ åˆ†åˆ«ç›¸ä¹˜çš„æ–°çŸ©é˜µï¼ˆå‘é‡ï¼‰ã€‚</strong></li>
<li><strong>std::pow(x,n)è¿”å› \(x^n\)</strong></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//phong_fragment_shader</span></span><br><span class="line"></span><br><span class="line">Eigen::Vector3f LightDir=light.position-point;</span><br><span class="line">Eigen::Vector3f ViewDir=eye_pos-point;</span><br><span class="line"><span class="comment">//r ^ 2</span></span><br><span class="line"><span class="type">float</span> d=LightDir.dot(LightDir);</span><br><span class="line">Eigen::Vector3f H=(LightDir.normalized()+ViewDir.normalized()).normalized();</span><br><span class="line"><span class="comment">//Ambient</span></span><br><span class="line">Eigen::Vector3f Ambient= ka.cwiseProduct(amb_light_intensity);</span><br><span class="line"><span class="type">float</span> LdotN=(normal.normalized()).dot(LightDir.normalized());</span><br><span class="line"><span class="type">float</span> NdotH=(H.normalized()).dot(normal.normalized());</span><br><span class="line"><span class="comment">//Diffuse</span></span><br><span class="line">Eigen::Vector3f Diffuse= <span class="built_in">std</span>::max( LdotN , <span class="number">0.0f</span>)*kd.cwiseProduct(light.intensity/d);</span><br><span class="line"><span class="comment">//Specular</span></span><br><span class="line">Eigen::Vector3f Specular= <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="built_in">std</span>::max( NdotH , <span class="number">0.0f</span>),<span class="number">150</span>)*ks.cwiseProduct(light.intensity/d);</span><br><span class="line">result_color+=Ambient+Diffuse+Specular;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-phong-png-phong"><a href="#è¿è¡Œ-Rasterizer-phong-png-phong" class="headerlink" title="è¿è¡Œ ./Rasterizer phong.png phong"></a>è¿è¡Œ <code>./Rasterizer phong.png phong</code></h4><p><strong>çœ‹çœ‹ï¼Œæˆ‘ä»¬çš„å°ç‰›åˆå…‰æ»‘äº†è®¸å¤š</strong><br>phong.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724164122063-449571494_1726324422982.png" alt="image"></p>
<h3 id="texture-fragment-shader-çº¹ç†è´´å›¾"><a href="#texture-fragment-shader-çº¹ç†è´´å›¾" class="headerlink" title="texture_fragment_shader() çº¹ç†è´´å›¾"></a>texture_fragment_shader() çº¹ç†è´´å›¾</h3><p><strong>åœ¨åŸºç¡€ä»»åŠ¡ä¸­ï¼Œçº¹ç†æ˜ å°„åªéœ€è¦åœ¨phongçš„åŸºç¡€ä¸Šï¼ŒæŠŠé¢œè‰²æ¢æˆçº¹ç†åæ ‡å¯¹åº”çš„é¢œè‰²å°±å¥½äº†ï¼Œåœ¨textureç±»ä¸­ï¼Œæ¡†æ¶å·²ç»å®ç°äº†getColorå‡½æ•°ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æœ‰çº¹ç†çš„æ—¶å€™è°ƒç”¨getColoræ–¹æ³•è·å–å¯¹åº”çš„é¢œè‰²å°±å¥½ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//texture_fragment_shaderå‡½æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (payload.texture)</span><br><span class="line">    &#123;</span><br><span class="line">	 	return_color=payload.texture-&gt;getColor(payload.tex_coords.x(),payload.tex_coords.y());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//getColorå‡½æ•°ï¼ˆæ¡†æ¶å·²å®ç°ï¼‰</span></span><br><span class="line">    Eigen::Vector3f <span class="title function_">getColor</span><span class="params">(<span class="type">float</span> u, <span class="type">float</span> v)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> u_img = u * width;</span><br><span class="line">        <span class="keyword">auto</span> v_img = (<span class="number">1</span> - v) * height;</span><br><span class="line">        <span class="keyword">auto</span> color = image_data.at&lt;cv::Vec3b&gt;(v_img, u_img);</span><br><span class="line">        <span class="keyword">return</span> Eigen::Vector3f(color[<span class="number">0</span>], color[<span class="number">1</span>], color[<span class="number">2</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-texture-png-texture"><a href="#è¿è¡Œ-Rasterizer-texture-png-texture" class="headerlink" title="è¿è¡Œ./Rasterizer texture.png texture"></a>è¿è¡Œ<code>./Rasterizer texture.png texture</code></h4><p><strong>å¦‚æœä½ åšå¯¹äº†è¿™ä¸€æ­¥ï¼Œé‚£ä¹ˆä½ makeä¹‹åä½¿ç”¨ä¸Šé¢çš„æŒ‡ä»¤åº”è¯¥èƒ½å¾—åˆ°è¿™æ ·çš„ç»“æœ:</strong><br>texture.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727142426702-454027515_1726324439052.png" alt="image"></p>
<h3 id="bump-fragment-shader-å‡¹å‡¸-æ³•çº¿-è´´å›¾"><a href="#bump-fragment-shader-å‡¹å‡¸-æ³•çº¿-è´´å›¾" class="headerlink" title="bump_fragment_shader() å‡¹å‡¸(æ³•çº¿)è´´å›¾"></a>bump_fragment_shader() å‡¹å‡¸(æ³•çº¿)è´´å›¾</h3><p><strong>è¿™ä¸€æ­¥å¤©å‘ï¼Œæˆ‘å¤§æ¦‚å¡åœ¨è¿™é‡Œæ”¹äº†ä¸¤ä¸ªå°æ—¶çš„ä»£ç ï¼Œæ¯æ¬¡è·‘å‡ºæ¥éƒ½æ˜¯æ®µé”™è¯¯ï¼ï¼ç»“æœå´ä¸æ˜¯ç®—æ³•é—®é¢˜ï¼Œæˆ‘å“­æ­»ã€‚åœ¨æˆ‘å‡ ä¹å´©æºƒçš„æ—¶å€™ï¼Œè¿˜æ˜¯å‘ç°äº†è¿™ä¸ªå°é—®é¢˜ï¼Œçº¹ç†åæ ‡çš„åœ¨è¾¹ç•Œçš„æ—¶å€™å¯èƒ½å¯¼è‡´è¶…å‡º1.0,è¿™ä¸ªæ—¶å€™åº”è¯¥å¯¹å…¶è¿›è¡Œè¾¹ç•Œå¤„ç†ï¼Œé˜²æ­¢æ•°ç»„è¶Šç•Œã€‚</strong><br><strong>å…³äºå‡¹å‡¸è´´å›¾çš„å®ç°ï¼Œç…§ç€æç¤ºåšå°±å¥½äº†ï¼Œä¸ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é”™è¯¯ä»£ç </span></span><br><span class="line">    <span class="type">float</span> x=normal.x(),y=normal.y(),z=normal.z();</span><br><span class="line">    Vector3f t =Vector3f(x*y/<span class="built_in">sqrt</span>(x*x+z*z),<span class="built_in">sqrt</span>(x*x+z*z),z*y/<span class="built_in">sqrt</span>(x*x+z*z));</span><br><span class="line">    Vector3f b = normal.cross(t);</span><br><span class="line">    Eigen:Matrix3f TBN ;</span><br><span class="line">    TBN&lt;&lt;t.x(),b.x(),normal.x(),</span><br><span class="line">         t.y(),b.y(),normal.y(),</span><br><span class="line">         t.z(),b.z(),normal.z();</span><br><span class="line">    <span class="type">float</span> u=payload.tex_coords.x();</span><br><span class="line">    <span class="type">float</span> v=payload.tex_coords.y();</span><br><span class="line">    <span class="type">float</span> w=payload.texture-&gt;width;</span><br><span class="line">    <span class="type">float</span> h=payload.texture-&gt;height;</span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (payload.texture-&gt;getColor(u+<span class="number">1</span>/w,v).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (payload.texture-&gt;getColor(u,v+<span class="number">1</span>/h).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    Vector3f ln = Vector3f(-dU, -dV, <span class="number">1</span>);</span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    result_color = (TBN * ln).normalized();</span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line"><span class="comment">//æ­£ç¡®ä»£ç </span></span><br><span class="line">Eigen::Vector3f <span class="title function_">bump_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">long</span> <span class="type">int</span> numb=<span class="number">1</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;bump_fragment_shader&quot;</span>&lt;&lt;numb++&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    Eigen::Vector3f ka = Eigen::Vector3f(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::Vector3f(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line">    Eigen::Vector3f color = payload.color; </span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line">    <span class="type">float</span> kh = <span class="number">0.2</span>, kn = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement bump mapping here</span></span><br><span class="line">    <span class="comment">// Let n = normal = (x, y, z)</span></span><br><span class="line">    <span class="comment">// Vector t = (x*y/sqrt(x*x+z*z),sqrt(x*x+z*z),z*y/sqrt(x*x+z*z))</span></span><br><span class="line">    <span class="comment">// Vector b = n cross product t</span></span><br><span class="line">    <span class="comment">// Matrix TBN = [t b n]</span></span><br><span class="line">    <span class="comment">// dU = kh * kn * (h(u+1/w,v)-h(u,v))</span></span><br><span class="line">    <span class="comment">// dV = kh * kn * (h(u,v+1/h)-h(u,v))</span></span><br><span class="line">    <span class="comment">// Vector ln = (-dU, -dV, 1)</span></span><br><span class="line">    <span class="comment">// Normal n = normalize(TBN * ln)</span></span><br><span class="line">    <span class="type">float</span> x=normal.x(),y=normal.y(),z=normal.z();</span><br><span class="line">    Vector3f t =Vector3f(x*y/<span class="built_in">sqrt</span>(x*x+z*z),<span class="built_in">sqrt</span>(x*x+z*z),z*y/<span class="built_in">sqrt</span>(x*x+z*z));</span><br><span class="line">    Vector3f b = normal.cross(t);</span><br><span class="line">    Eigen:Matrix3f TBN ;</span><br><span class="line">    TBN&lt;&lt;t.x(),b.x(),normal.x(),</span><br><span class="line">         t.y(),b.y(),normal.y(),</span><br><span class="line">         t.z(),b.z(),normal.z();</span><br><span class="line">    <span class="type">float</span> u=payload.tex_coords.x();</span><br><span class="line">    <span class="type">float</span> v=payload.tex_coords.y();</span><br><span class="line">    <span class="type">float</span> w=payload.texture-&gt;width;</span><br><span class="line">    <span class="type">float</span> h=payload.texture-&gt;height;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//è¿™é‡Œå¤šä¸€æ­¥é˜²æ­¢è¶Šç•Œçš„æ“ä½œä½¿ç”¨std::clamp(x , l , r);æ¥ä¿è¯æ•°å€¼åœ¨l åˆ° rä¹‹é—´</span></span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (payload.texture-&gt;getColor(<span class="built_in">std</span>::clamp(u+<span class="number">1</span>/w, <span class="number">0.0f</span>, <span class="number">1.0f</span>),v).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (payload.texture-&gt;getColor(u,<span class="built_in">std</span>::clamp(v+<span class="number">1</span>/h, <span class="number">0.0f</span>, <span class="number">1.0f</span>)).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    Vector3f ln = Vector3f(-dU, -dV, <span class="number">1</span>);</span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    result_color = (TBN * ln).normalized();</span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-rasterizer-bump-png-bump"><a href="#è¿è¡Œ-rasterizer-bump-png-bump" class="headerlink" title="è¿è¡Œ./rasterizer bump.png bump"></a>è¿è¡Œ<code>./rasterizer bump.png bump</code></h4><p>bump.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727160448722-329949569_1726324439052.png" alt="image"></p>
<h3 id="displacement-fragment-shader-ä½ç§»è´´å›¾"><a href="#displacement-fragment-shader-ä½ç§»è´´å›¾" class="headerlink" title="displacement_fragment_shader() ä½ç§»è´´å›¾"></a>displacement_fragment_shader() ä½ç§»è´´å›¾</h3><p><strong>ä½ç§»è´´å›¾ä¸å‡¹å‡¸(æ³•çº¿)è´´å›¾æœ‰æ‰€ä¸åŒ,å‡¹å‡¸è´´å›¾ä¸ä¼šå½±å“ç½‘æ ¼çš„å®é™…å¤šè¾¹å½¢æ€§è´¨ï¼Œåªä¼šå½±å“åœ¨å¹³é¢ä¸Šè®¡ç®—å…‰ç…§çš„æ–¹å¼ã€‚ä½ç§»è´´å›¾ï¼ˆå¸¸å¬åˆ°çš„ç½®æ¢è´´å›¾æœ‰ç‚¹å‹‰å¼ºï¼‰ï¼Œå¯ä»¥è®©æ¨¡å‹è¡¨é¢äº§ç”Ÿä¸€å®šçš„ä½ç§»å˜åŒ–ã€‚ï¼ˆæ³¨æ„è·ŸBumpå‡¹å‡¸è´´å›¾çš„åŒºåˆ«ï¼Œå®ƒå¯ä»¥å®è´¨æ€§åœ°æ”¹å˜æ¨¡å‹çš„é¢æ•°ï¼Œè€ŒBumpå‡¹å‡¸è´´å›¾å¹¶æ²¡æœ‰å®è´¨æ€§åœ°æ”¹å˜æ¨¡å‹é¢æ•°ï¼‰\(^{[1]}\)</strong><br><strong>é‚£ä¹ˆè¯¥æ€ä¹ˆåšä½ç§»è´´å›¾å‘¢ï¼Ÿæœ€å…³é”®çš„ä¸€æ­¥å°±æ˜¯ä½ç§»äº†ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">point += kn*normal*payload.texture-&gt;getColor(u,v).norm();</span><br></pre></td></tr></table></figure>

<p><strong>é™¤äº†è¿™æ­¥ï¼Œå°±æ˜¯ä¸€ä¸ªç¼åˆäº†æ³•çº¿è´´å›¾å’Œphongæ¨¡å‹çš„ç€è‰²æ–¹æ³•ã€‚è¯´å®è¯ï¼Œè¿™é‡Œè¿˜çœŸä¸æ˜¯å¾ˆæ‡‚ï¼Œä½†æ˜¯ç…§ç€æ³¨é‡Šåšç¡®å®èƒ½çš„è¦æƒ³è¦çš„ç»“æœã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3f <span class="title function_">displacement_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Vector3f ka = Eigen::Vector3f(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::Vector3f(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = payload.color; </span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> kh = <span class="number">0.2</span>, kn = <span class="number">0.1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> Implement displacement mapping here</span></span><br><span class="line">    <span class="comment">// Let n = normal = (x, y, z)</span></span><br><span class="line">    <span class="comment">// Vector t = (x*y/sqrt(x*x+z*z),sqrt(x*x+z*z),z*y/sqrt(x*x+z*z))</span></span><br><span class="line">    <span class="comment">// Vector b = n cross product t</span></span><br><span class="line">    <span class="comment">// Matrix TBN = [t b n]</span></span><br><span class="line">    <span class="comment">// dU = kh * kn * (h(u+1/w,v)-h(u,v))</span></span><br><span class="line">    <span class="comment">// dV = kh * kn * (h(u,v+1/h)-h(u,v))</span></span><br><span class="line">    <span class="comment">// Vector ln = (-dU, -dV, 1)</span></span><br><span class="line">    <span class="comment">// Position p = p + kn * n * h(u,v)</span></span><br><span class="line">    <span class="comment">// Normal n = normalize(TBN * ln)</span></span><br><span class="line">    <span class="type">float</span> x=normal.x(),y=normal.y(),z=normal.z();</span><br><span class="line">    Vector3f t =Vector3f(x*y/<span class="built_in">sqrt</span>(x*x+z*z),<span class="built_in">sqrt</span>(x*x+z*z),z*y/<span class="built_in">sqrt</span>(x*x+z*z));</span><br><span class="line">    Vector3f b = normal.cross(t);</span><br><span class="line">    Eigen:Matrix3f TBN ;</span><br><span class="line">    TBN&lt;&lt;t.x(),b.x(),normal.x(),</span><br><span class="line">         t.y(),b.y(),normal.y(),</span><br><span class="line">         t.z(),b.z(),normal.z();</span><br><span class="line">    <span class="type">float</span> u=payload.tex_coords.x();</span><br><span class="line">    <span class="type">float</span> v=payload.tex_coords.y();</span><br><span class="line">    <span class="type">float</span> w=payload.texture-&gt;width;</span><br><span class="line">    <span class="type">float</span> h=payload.texture-&gt;height;</span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (payload.texture-&gt;getColor(<span class="built_in">std</span>::clamp(u+<span class="number">1</span>/w,<span class="number">0.f</span>,<span class="number">1.f</span>),v).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (payload.texture-&gt;getColor(u,<span class="built_in">std</span>::clamp(v+<span class="number">1</span>/h,<span class="number">0.f</span>,<span class="number">1.f</span>)).norm()-payload.texture-&gt;getColor(u,v).norm());</span><br><span class="line">    Vector3f ln = Vector3f(-dU, -dV, <span class="number">1</span>);</span><br><span class="line">	<span class="comment">//ä½ç§»</span></span><br><span class="line">    point += kn*normal*payload.texture-&gt;getColor(u,v).norm();</span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    normal = (TBN * ln).normalized();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f ViewDir=eye_pos-point;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> For each light source in the code, calculate what the *ambient*, *diffuse*, and *specular* </span></span><br><span class="line">        <span class="comment">// components are. Then, accumulate that result on the *result_color* object.</span></span><br><span class="line">        Eigen::Vector3f LightDir=light.position-point;</span><br><span class="line">        <span class="type">float</span> d=LightDir.dot(LightDir);</span><br><span class="line">        Eigen::Vector3f H=(LightDir.normalized()+ViewDir.normalized()).normalized();</span><br><span class="line">        Eigen::Vector3f Ambient= ka.cwiseProduct(amb_light_intensity);</span><br><span class="line">        <span class="type">float</span> LdotN=(normal.normalized()).dot(LightDir.normalized());</span><br><span class="line">        <span class="type">float</span> NdotH=(H.normalized()).dot(normal.normalized());</span><br><span class="line">        Eigen::Vector3f Diffuse= <span class="built_in">std</span>::max( LdotN , <span class="number">0.0f</span>)*kd.cwiseProduct(light.intensity/d);</span><br><span class="line">        Eigen::Vector3f Specular= <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="built_in">std</span>::max( NdotH , <span class="number">0.0f</span>),<span class="number">150</span>)*ks.cwiseProduct(light.intensity/d);</span><br><span class="line">        result_color+=Ambient+Diffuse+Specular;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="è¿è¡Œ-Rasterizer-displacement-png-displacement"><a href="#è¿è¡Œ-Rasterizer-displacement-png-displacement" class="headerlink" title="è¿è¡Œ./Rasterizer displacement.png displacement"></a>è¿è¡Œ<code>./Rasterizer displacement.png displacement</code></h4><p>displacement.png<br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727170304928-975418181_1726324439052.png" alt="image"></p>
<h3 id="åŒçº¿æ€§æ’å€¼"><a href="#åŒçº¿æ€§æ’å€¼" class="headerlink" title="åŒçº¿æ€§æ’å€¼"></a>åŒçº¿æ€§æ’å€¼</h3><p><strong>è¿™ä¸ªè™½ç„¶ç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ¥è®²ä¸€ä¸‹å…·ä½“å®ç°ï¼š</strong><br><strong>å‡½æ•°åŸå‹å¦‚ä¸‹</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3f <span class="title function_">getColorBilinear</span><span class="params">(<span class="type">float</span> u,<span class="type">float</span> v)</span>;</span><br></pre></td></tr></table></figure>

<p><strong>æ ¹æ®ä¸‹é¢è¿™å¼ åŸç†å›¾ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å®ç°</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230727143136416-982621662_1726324439052.png" alt="image"><br><strong>ç¬¬ä¸€æ­¥ï¼Œå°†<code>u</code>å’Œ<code>v</code>é™åˆ¶åœ¨\(0-1\)</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">u = <span class="built_in">std</span>::clamp(u, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br><span class="line">v = <span class="built_in">std</span>::clamp(v, <span class="number">0.0f</span>, <span class="number">1.0f</span>);</span><br></pre></td></tr></table></figure>

<p><strong>æŠŠæ¯”ä¾‹è½¬åŒ–ä¸ºçº¹ç†åæ ‡ï¼Œå¹¶è®¡ç®—ç›¸é‚»çš„å››ä¸ªåƒç´ ç‚¹</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> u_img = u * width;</span><br><span class="line"><span class="keyword">auto</span> v_img = (<span class="number">1</span> - v) * height;</span><br><span class="line"><span class="type">float</span> uMax=<span class="built_in">std</span>::min((<span class="type">float</span>)width,<span class="built_in">std</span>::<span class="built_in">ceil</span>(u_img));</span><br><span class="line"><span class="type">float</span> uMin=<span class="built_in">std</span>::max(<span class="number">0.0f</span>,<span class="built_in">std</span>::<span class="built_in">floor</span>(u_img));</span><br><span class="line"><span class="type">float</span> vMax=<span class="built_in">std</span>::min((<span class="type">float</span>)height,<span class="built_in">std</span>::<span class="built_in">ceil</span>(v_img));</span><br><span class="line"><span class="type">float</span> vMin=<span class="built_in">std</span>::max(<span class="number">0.0f</span>,<span class="built_in">std</span>::<span class="built_in">floor</span>(v_img));</span><br></pre></td></tr></table></figure>

<p><strong>å…¶ä¸­</strong></p>
<ul>
<li><code>ceil()</code>å‘ä¸Šå»æ•´</li>
<li><code>floor()</code>å‘ä¸‹å–æ•´</li>
</ul>
<p>  <strong>è®°å½•å››ä¸ªç‚¹çš„é¢œè‰²</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Up Left Point</span></span><br><span class="line"><span class="keyword">auto</span> colorUL = image_data.at&lt;cv::Vec3b&gt;(vMax,uMin );</span><br><span class="line"><span class="comment">//Up Right Point</span></span><br><span class="line"><span class="keyword">auto</span> colorUR = image_data.at&lt;cv::Vec3b&gt;(vMax, uMax);</span><br><span class="line"><span class="comment">//Down Left Point</span></span><br><span class="line"><span class="keyword">auto</span> colorDL = image_data.at&lt;cv::Vec3b&gt;(vMin, uMin);</span><br><span class="line"><span class="comment">//Down Right Point</span></span><br><span class="line"><span class="keyword">auto</span> colorDR = image_data.at&lt;cv::Vec3b&gt;(vMin, uMax);</span><br></pre></td></tr></table></figure>

<p><strong>å•çº¿æ€§æ’å€¼</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> uLerpNum=(u_img-uMin)/(uMax-uMin);</span><br><span class="line"><span class="type">float</span> vLerpNum=(v_img-vMin)/(vMax-vMin);</span><br><span class="line"><span class="comment">//U Up Lerp</span></span><br><span class="line"><span class="keyword">auto</span> colorUp_U_Lerp=uLerpNum*colorUL+(<span class="number">1</span>-uLerpNum)*colorUR;</span><br><span class="line"><span class="comment">//U Down Lerp</span></span><br><span class="line"><span class="keyword">auto</span> colorDown_U_Lerp= uLerpNum*colorDL+(<span class="number">1</span>-uLerpNum)*colorDR;</span><br></pre></td></tr></table></figure>

<p><strong>å†è¿›è¡Œä¸€æ¬¡æ’å€¼</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//V Lerp</span></span><br><span class="line"><span class="keyword">auto</span> color = vLerpNum*colorDown_U_Lerp+(<span class="number">1</span>-vLerpNum)*colorUp_U_Lerp;</span><br></pre></td></tr></table></figure>

<p><strong>å¹¶ä¿®æ”¹texture_fragment_shaderä¸­è·å–æè´¨çš„è¯­å¥</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Eigen::Vector3f <span class="title function_">texture_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span><br><span class="line">&#123;</span><br><span class="line">    Eigen::Vector3f return_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (payload.texture)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> Get the texture value at the texture coordinates of the current fragment</span></span><br><span class="line">		<span class="comment">//åŒçº¿æ€§æ’å€¼</span></span><br><span class="line">        return_color=payload.texture-&gt;getColorBilinear(payload.tex_coords.x(),payload.tex_coords.y());</span><br><span class="line">    &#125;</span><br><span class="line">    Eigen::Vector3f texture_color;</span><br><span class="line">    texture_color &lt;&lt; return_color.x(), return_color.y(), return_color.z();</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f ka = Eigen::Vector3f(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = texture_color / <span class="number">255.f</span>;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::Vector3f(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = texture_color;</span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> For each light source in the code, calculate what the *ambient*, *diffuse*, and *specular*</span></span><br><span class="line">        <span class="comment">// components are. Then, accumulate that result on the *result_color* object.</span></span><br><span class="line">        Eigen::Vector3f LightDir=light.position-point;</span><br><span class="line">        Eigen::Vector3f ViewDir=eye_pos-point;</span><br><span class="line">        <span class="type">float</span> d=LightDir.dot(LightDir);</span><br><span class="line">        Eigen::Vector3f H=(LightDir.normalized()+ViewDir.normalized()).normalized();</span><br><span class="line">        Eigen::Vector3f Ambient= ka.cwiseProduct(amb_light_intensity);</span><br><span class="line">        <span class="type">float</span> LdotN=(normal.normalized()).dot(LightDir.normalized());</span><br><span class="line">        <span class="type">float</span> NdotH=(H.normalized()).dot(normal.normalized());</span><br><span class="line">        Eigen::Vector3f Diffuse= <span class="built_in">std</span>::max( LdotN , <span class="number">0.0f</span>)*kd.cwiseProduct(light.intensity/d);</span><br><span class="line">        Eigen::Vector3f Specular= <span class="built_in">std</span>::<span class="built_in">pow</span>(<span class="built_in">std</span>::max( NdotH , <span class="number">0.0f</span>),<span class="number">150</span>)*ks.cwiseProduct(light.intensity/d);</span><br><span class="line">        result_color+=Ambient+Diffuse+Specular;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨å…¶ä»–æ¨¡å‹"><a href="#ä½¿ç”¨å…¶ä»–æ¨¡å‹" class="headerlink" title="ä½¿ç”¨å…¶ä»–æ¨¡å‹"></a>ä½¿ç”¨å…¶ä»–æ¨¡å‹</h3><p><strong>ç”±äºå‡¹å‡¸è´´å›¾å’Œä½ç§»è´´å›¾æ˜¯éœ€è¦æ³•çº¿è´´å›¾çš„ï¼Œæ‰€ä»¥åªæœ‰spotæ¨¡å‹ï¼ˆå°ç‰›ï¼‰æ˜¯å¯ä»¥è¿›è¡Œçš„ï¼Œå…¶ä»–çš„æ¨¡å‹éƒ½è¿›è¡Œä¸æ–™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸åšäº†ã€‚ä½†æ˜¯æˆ‘åœ¨åšçº¹ç†æ˜ å°„çš„æ—¶å€™ï¼Œå¤§æŠµæ˜¯å‘ç”Ÿäº†å¥‡æ€ªçš„äº‹æƒ…ï¼Œæ²¡æœ‰åŠæ³•å¾ˆå¥½çš„ä½œå‡ºçº¹ç†è´´å›¾ã€‚é‚£æˆ‘æ‘†æ äº†ï¼Œæ•ˆæœå¦‚ä¸‹ï¼šæŒºå·®çš„ï¼Œæˆ‘ä¹Ÿè§£å†³ä¸äº†äº†</strong><br><strong>æˆ‘è‡ªå·±åšäº†ä¸€äº›æŒ‡ä»¤ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728150251896-1866767253_1726324439052.png" alt="image"></p>
<h4 id="bunny"><a href="#bunny" class="headerlink" title="bunny"></a>bunny</h4><p><code>./Rasterizer \- normal bunny 2</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728151501544-1113996278_1726324449461.png" alt="image"><br><code>./Rasterizer \- phong bunny 2</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728151503837-676167363_1726324449461.png" alt="image"></p>
<h4 id="Crate"><a href="#Crate" class="headerlink" title="Crate"></a>Crate</h4><p><code>./Rasterizer \- normal crate</code><br><strong>å…·ä½“ä¸ºä»€ä¹ˆç”»å‡ºæ¥è¿™ä¸ªæ ·å­æˆ‘ä¹Ÿä¸æ¸…æ¥šï¼Œæäº†ä¸€ä¸‹åˆï¼Œæ‘†æ äº†</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728152651037-615293228_1726324449461.png" alt="image"><br><code>./Rasterizer \- phong crate</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728152836476-1104393584_1726324449461.png" alt="image"><br><strong>æˆ‘æœ¬æ¥ä»¥ä¸ºæ˜¯å› ä¸ºæ‘„åƒæœºçš„ä½ç½®ï¼Œç„¶åæˆ‘è°ƒæ•´äº†æ‘„åƒæœºçš„ä½ç½®ï¼Œåˆç”»å‡ºäº†è¿™æ ·çš„å›¾ç‰‡ï¼šè¿™ä¸‹æ²¡åŠæ³•äº†</strong><br><code>./Rasterizer \- phong crate 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153017561-293420920_1726324449461.png" alt="image"><br><code>./Rasterizer \- texture crate</code><br><strong>è´´å›¾ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆéå¸¸å¥‡æ€ªï¼Œç½¢äº†ç½¢äº†</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153127067-1582248841_1726324464669.png" alt="image"></p>
<h4 id="cube"><a href="#cube" class="headerlink" title="cube"></a>cube</h4><p><code>./Rasterizer \- normal cube</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153255697-793645420_1726324464669.png" alt="image"><br><strong>è¿˜å¯ä»¥ç§»åŠ¨æ‘„åƒæœºåˆ°(0,0,-10)å»çœ‹çœ‹ <del>(å…¶å®è¿™ä¸ªæˆåƒæ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºåªæ˜¯ç§»åŠ¨äº†eye_posï¼Œæ·±åº¦ä¿¡æ¯çš„è®¡ç®—å¹¶æ²¡æœ‰é‡æ–°è®¡ç®—ï¼Œæ‰€ä»¥æ·±åº¦è¿˜æ˜¯ä»¥(0,0,10)æ¥è®¡ç®—çš„ã€‚çœ‹åˆ°å›¾åƒå°±å¾ˆå¥‡æ€ª)</del></strong><br><code>./Rasterizer \- normal cube \-10</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153344003-1666282860_1726324464669.png" alt="image"><br><code>./Rasterizer \- phong cube</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153751868-999380803_1726324464669.png" alt="image"><br><code>./Rasterizer \- texture cube</code><br><strong><del>å°±ä¹å‘µä¹å‘µå§</del></strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728153846947-867937133_1726324464669.png" alt="image"></p>
<h4 id="rock"><a href="#rock" class="headerlink" title="rock"></a>rock</h4><p><code>./Rasterizer \- normal rock 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728154200513-633371835_1726324474344.png" alt="image"><br><strong>rockè¿™ä¸ªæ¨¡å‹ï¼Œå¦‚æœç”¨10çš„è¯ï¼Œä¼šè¶…å‡ºè§†å£èŒƒå›´ï¼Œä½†æ˜¯getIndexå‡½æ•°å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œè¯¥æœ‰çš„æ“ä½œï¼Œå¯¼è‡´ä¼šå‡ºç°æ®µé”™è¯¯ï¼Œè¿™é‡Œè°ƒè¿œæ‘„åƒæœºçš„ä½ç½®æ¥é˜²æ­¢å‡ºç°æ®µé”™è¯¯ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> rst::rasterizer::get_index(<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> (height-y)*width + x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>./Rasterizer \- phong rock 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728154237464-1535985916_1726324474344.png" alt="image"><br><code>./Rasterizer \- texture rock 20</code><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230728154310832-172869686_1726324474344.png" alt="image"></p>
<h4 id="mainå‡½æ•°æºä»£ç "><a href="#mainå‡½æ•°æºä»£ç " class="headerlink" title="mainå‡½æ•°æºä»£ç "></a>mainå‡½æ•°æºä»£ç </h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span>** argv)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; model_list,shader_list;</span><br><span class="line">    <span class="keyword">if</span>(argc==<span class="number">2</span>&amp;&amp;<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>])==<span class="string">&quot;--help&quot;</span>)&#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The first data is output file name or a &#x27;-&#x27; to defult it&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The second data is shader mode such as : normal phong texture nump displacement&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The Thired data is optional which you can choose whatever model you want :spot cate bunny cube rock &quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;&lt;</span><br><span class="line">        <span class="string">&quot;The fourth data is optional you can change your eye&#x27;s axis z,in range(2,50)&quot;</span></span><br><span class="line">        &lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Triangle*&gt; TriangleList;</span><br><span class="line">    <span class="type">float</span> angle = <span class="number">140.0</span>;</span><br><span class="line">    <span class="type">bool</span> command_line = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title function_">model_name</span><span class="params">(<span class="string">&quot;spot&quot;</span>)</span>,shader_name;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> filename = <span class="string">&quot;output.png&quot;</span>;</span><br><span class="line">    objl::Loader Loader;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> obj_path = <span class="string">&quot;../models&quot;</span>;</span><br><span class="line">    rst::rasterizer <span class="title function_">r</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>)</span>;    </span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> texture_path;</span><br><span class="line">    <span class="comment">// Load .obj File</span></span><br><span class="line">    <span class="type">bool</span> loadout =<span class="literal">false</span>;</span><br><span class="line">    texture_path = <span class="string">&quot;/spot/hmap.jpg&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt;= <span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        loadout = Loader.LoadFile(<span class="string">&quot;../models/spot/spot_triangulated_good.obj&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(argc&gt;=<span class="number">4</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;rock&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/rock/rock.obj&quot;</span>);</span><br><span class="line">            texture_path = <span class="string">&quot;/rock/rock.png&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;cube&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/cube/cube.obj&quot;</span>);</span><br><span class="line">            texture_path = <span class="string">&quot;/cube/wall.tif&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;bunny&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/bunny/bunny.obj&quot;</span>);</span><br><span class="line">            texture_path.clear();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;crate&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/Crate/Crate1.obj&quot;</span>);</span><br><span class="line">            texture_path = <span class="string">&quot;/Crate/crate_1.jpg&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;spot&quot;</span>)&#123;</span><br><span class="line">            loadout = Loader.LoadFile(<span class="string">&quot;../models/spot/spot_triangulated_good.obj&quot;</span>);</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Model Load succes&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            texture_path = <span class="string">&quot;/spot/hmap.jpg&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Model is &quot;</span>&lt;&lt;argv[<span class="number">3</span>]&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        model_name=argv[<span class="number">3</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if(!texture_path.empty())</span></span><br><span class="line">    <span class="comment">//     r.set_texture(Texture(obj_path + texture_path));</span></span><br><span class="line">    <span class="keyword">if</span> (argc==<span class="number">3</span>||argc&gt;=<span class="number">4</span>&amp;&amp;<span class="built_in">string</span>(argv[<span class="number">3</span>])==<span class="string">&quot;spot&quot;</span>)</span><br><span class="line">        r.set_texture(Texture(obj_path + texture_path));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> mesh : Loader.LoadedMeshes)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; mesh.Vertices.size(); i += <span class="number">3</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Triangle *t = new Triangle();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                t-&gt;setVertex(j, Vector4f(mesh.Vertices[i + j].Position.X, mesh.Vertices[i + j].Position.Y, mesh.Vertices[i + j].Position.Z, <span class="number">1.0</span>));</span><br><span class="line">                t-&gt;setNormal(j, Vector3f(mesh.Vertices[i + j].Normal.X, mesh.Vertices[i + j].Normal.Y, mesh.Vertices[i + j].Normal.Z));</span><br><span class="line">                t-&gt;setTexCoord(j, Vector2f(mesh.Vertices[i + j].TextureCoordinate.X, mesh.Vertices[i + j].TextureCoordinate.Y));</span><br><span class="line">            &#125;</span><br><span class="line">            TriangleList.push_back(t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">std</span>::function&lt;Eigen::Vector3f(fragment_shader_payload)&gt; active_shader = phong_fragment_shader;</span><br><span class="line">    <span class="keyword">if</span> (argc &gt;= <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        command_line = <span class="literal">true</span>;</span><br><span class="line">        filename = <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span>(argc&gt;=<span class="number">3</span>)shader_name=argv[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;texture&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the texture shader\n&quot;</span>;</span><br><span class="line">            active_shader = texture_fragment_shader;</span><br><span class="line">            <span class="keyword">if</span>(argc &gt;=<span class="number">4</span> &amp;&amp; argv[<span class="number">3</span>]==<span class="string">&quot;spot&quot;</span>||argc==<span class="number">3</span>)&#123;</span><br><span class="line">                texture_path = <span class="string">&quot;/spot/spot_texture.png&quot;</span>;</span><br><span class="line">            r.set_texture(Texture(obj_path + texture_path));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;normal&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the normal shader\n&quot;</span>;</span><br><span class="line">            active_shader = normal_fragment_shader;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;phong&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the phong shader\n&quot;</span>;</span><br><span class="line">            active_shader = phong_fragment_shader;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;bump&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(model_name!=<span class="string">&quot;spot&quot;</span>)&#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;There is no normal texture!&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the bump shader\n&quot;</span>;</span><br><span class="line">            active_shader = bump_fragment_shader;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (argc &gt;= <span class="number">3</span> &amp;&amp; <span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">2</span>]) == <span class="string">&quot;displacement&quot;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(model_name!=<span class="string">&quot;spot&quot;</span>)&#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;There is no normal texture!&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Rasterizing using the bump shader\n&quot;</span>;</span><br><span class="line">            active_shader = displacement_fragment_shader;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">float</span> eye_z=<span class="number">10</span>;</span><br><span class="line">    <span class="keyword">if</span>(argc&gt;=<span class="number">5</span>)eye_z=<span class="built_in">std</span>::stoi(argv[<span class="number">4</span>]);</span><br><span class="line">    Eigen::Vector3f eye_pos = &#123;<span class="number">0</span>,<span class="number">0</span>,eye_z&#125;;</span><br><span class="line">    r.set_vertex_shader(vertex_shader);</span><br><span class="line">    r.set_fragment_shader(active_shader);</span><br><span class="line">    <span class="type">int</span> key = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> frame_count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (command_line)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">std</span>::<span class="built_in">string</span>(argv[<span class="number">1</span>])==<span class="string">&quot;-&quot;</span>)&#123;</span><br><span class="line">            filename=model_name+<span class="string">&quot;_&quot;</span>+shader_name+<span class="string">&quot;_&quot;</span>+<span class="built_in">std</span>::to_string(<span class="type">int</span>(eye_z))+<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        r.clear(rst::Buffers::Color | rst::Buffers::Depth);</span><br><span class="line">        r.set_model(get_model_matrix(angle));</span><br><span class="line">        r.set_view(get_view_matrix(eye_pos));</span><br><span class="line">        r.set_projection(get_projection_matrix(<span class="number">45.0</span>, <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">50</span>));</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;Before Draw&quot;</span>&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        r.draw(TriangleList);</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span>&lt;&lt;<span class="string">&quot;After Draw shader with &quot;</span>&lt;&lt;shader_name&lt;&lt;<span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        cv::Mat <span class="title function_">image</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>, CV_32FC3, r.frame_buffer().data())</span>;</span><br><span class="line">        image.convertTo(image, CV_8UC3, <span class="number">1.0f</span>);</span><br><span class="line">        cv::cvtColor(image, image, cv::COLOR_RGB2BGR);</span><br><span class="line">        cv::imwrite(filename, image);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(key != <span class="number">27</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        r.clear(rst::Buffers::Color | rst::Buffers::Depth);</span><br><span class="line">        r.set_model(get_model_matrix(angle));</span><br><span class="line">        r.set_view(get_view_matrix(eye_pos));</span><br><span class="line">        r.set_projection(get_projection_matrix(<span class="number">45.0</span>, <span class="number">1</span>, <span class="number">0.1</span>, <span class="number">50</span>));</span><br><span class="line">        <span class="comment">//r.draw(pos_id, ind_id, col_id, rst::Primitive::Triangle);</span></span><br><span class="line">        r.draw(TriangleList);</span><br><span class="line">        cv::Mat <span class="title function_">image</span><span class="params">(<span class="number">700</span>, <span class="number">700</span>, CV_32FC3, r.frame_buffer().data())</span>;</span><br><span class="line">        image.convertTo(image, CV_8UC3, <span class="number">1.0f</span>);</span><br><span class="line">        cv::cvtColor(image, image, cv::COLOR_RGB2BGR);</span><br><span class="line">        cv::imshow(<span class="string">&quot;image&quot;</span>, image);</span><br><span class="line">        cv::imwrite(filename, image);</span><br><span class="line">        key = cv::waitKey(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (key == <span class="string">&#x27;a&#x27;</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            angle -= <span class="number">0.1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (key == <span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            angle += <span class="number">0.1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h2><p>\({[1]}\) <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/137449232">ã€Blenderã€‘ è¯¦è§£ å‡¹å‡¸è´´å›¾ Bump&#x2F;Normal&#x2F;Displacement ä¸‰è€…çš„åŒºåˆ«</a></p>
<h2 id="ä»£ç åˆé›†"><a href="#ä»£ç åˆé›†" class="headerlink" title="ä»£ç åˆé›†"></a>ä»£ç åˆé›†</h2><p><strong>ä»£ç æœ‰äº›å¤šï¼Œæˆ‘å°±ç›´æ¥æ”¾githubäº†ã€‚</strong><br><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/tree/master/Assignment3">zhywyt-github</a></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589119.html">ä¸‹ä¸€ç¯‡ï¼šBezieræ›²çº¿çš„ç»˜åˆ¶</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576366.html">ä¸Šä¸€ç¯‡ï¼šå›¾å½¢å¡«å……</a></p>
<hr>
<h2 id="2023-10-18"><a href="#2023-10-18" class="headerlink" title="2023-10-18"></a>2023-10-18</h2><p>é¸½äº†è¿™ä¹ˆä¹…åˆå›æ¥å†™101çš„æ¡†æ¶è§£è¯»äº†</p>
<h2 id="æ¡†æ¶è§£è¯»"><a href="#æ¡†æ¶è§£è¯»" class="headerlink" title="æ¡†æ¶è§£è¯»"></a>æ¡†æ¶è§£è¯»</h2><h3 id="æ–°å¢æ–‡ä»¶ä¸€è§ˆ"><a href="#æ–°å¢æ–‡ä»¶ä¸€è§ˆ" class="headerlink" title="æ–°å¢æ–‡ä»¶ä¸€è§ˆ"></a>æ–°å¢æ–‡ä»¶ä¸€è§ˆ</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;global.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Shader.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Texture.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;OBJ_Loader.h&quot;</span></span></span><br></pre></td></tr></table></figure>
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-Linux/ubuntu/Ubuntuè§£å†³é«˜åˆ†å±ä¸‹Matlabå·¥å…·æ å­—ä½“è¿‡å°" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/6886/" class="article-date">
      <time datetime="2023-07-25T18:43:00.000Z" itemprop="datePublished">2023-07-25</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/6886/">Ubuntuè§£å†³é«˜åˆ†å±ä¸‹Matlabå·¥å…·æ å­—ä½“è¿‡å°</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<p><strong>èƒ½å¤Ÿçœ‹åˆ°å·¥å…·æ ï¼Œè¯´æ˜ä½ å·²ç»èƒ½å¤Ÿæ‰“å¼€matlabäº†ï¼Œä¸ç®¡ä½ æ˜¯ä»¥ä½•ç§æ–¹å¼æ‰“å¼€çš„ã€‚</strong><br><strong>é¦–å…ˆæ‰“å¼€matlabï¼Œç„¶ååœ¨å‘½ä»¤è¡Œè¾“å…¥ä¸€ä¸‹ä»£ç ï¼š</strong></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#åœ¨å‘½ä»¤è¡Œå†…è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼Œå…¶ä¸­<span class="number">2.0</span>æ˜¯æ”¾å¤§çš„å°ºåº¦ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œè®¾ç½®</span><br><span class="line">s = settings;</span><br><span class="line">s.matlab.desktop.DisplayScaleFactor;</span><br><span class="line">s.matlab.desktop.DisplayScaleFactor.PersonalValue = <span class="number">2.0</span>;</span><br></pre></td></tr></table></figure>

<p><strong>ä¼šç»™å‡ºä¸€ä¸ªé‡å¯ä»¥é€‚åº”ç¼©æ”¾çš„æç¤ºï¼Œé‡å¯matlabå°±å¥½äº†ã€‚</strong></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/Linux/">Linux</a><a class="article-category-link" href="/Yelee/categories/Linux/Ubuntu/">Ubuntu</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/6615/" class="article-date">
      <time datetime="2023-07-24T13:51:00.000Z" itemprop="datePublished">2023-07-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/6615/">games101 HomeWork2</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="Games101-HomeWork2"><a href="#Games101-HomeWork2" class="headerlink" title="Games101 HomeWork2"></a>Games101 HomeWork2</h1><h2 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576370.html">å¯¼èˆª</a></p>
<h2 id="ä½œä¸šè¦æ±‚"><a href="#ä½œä¸šè¦æ±‚" class="headerlink" title="ä½œä¸šè¦æ±‚"></a>ä½œä¸šè¦æ±‚</h2><ul>
<li><strong>rasterize_triangle(): æ‰§è¡Œä¸‰è§’å½¢æ …æ ¼åŒ–ç®—æ³•</strong></li>
<li><strong>static bool insideTriangle(): æµ‹è¯•ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ã€‚ä½ å¯ä»¥ä¿®æ”¹æ­¤å‡½æ•°çš„å®šä¹‰ï¼Œè¿™æ„å‘³ç€ï¼Œä½ å¯ä»¥æŒ‰ç…§è‡ªå·±çš„æ–¹å¼æ›´æ–°è¿”å›ç±»å‹æˆ–å‡½æ•°å‚æ•°ã€‚</strong></li>
</ul>
<p><strong>å…ˆä»ç®€å•çš„å‡½æ•°å¼€å§‹</strong></p>
<h3 id="insideTriangle"><a href="#insideTriangle" class="headerlink" title="insideTriangle"></a>insideTriangle</h3><p><strong><code>insideTriangle</code>åªéœ€è¦æ£€æŸ¥ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…éƒ¨ï¼Œæˆ‘å¹¶æ²¡æœ‰ä¿®æ”¹å‡½æ•°çš„å®šä¹‰ï¼Œæ˜¯å¦åœ¨ä¸‰è§’å½¢ä¸­ï¼Œè¿”å›ä¸€ä¸ªbool ç±»å‹çš„å€¼ä¼¼ä¹æŒºæ­£å¸¸çš„ã€‚</strong><br><strong>åˆ¤æ–­ä¸€ä¸ªç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢ä¸­å…¶å®æ˜¯æŒºç®€å•çš„ï¼Œè¿™é‡Œç”¨äº†è¯¾ç¨‹ä¸­ç”¨åˆ°çš„å·®ä¹˜æ³•ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">bool</span> <span class="title function_">insideTriangle</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">const</span> Vector3f* _v)</span></span><br><span class="line">&#123;   </span><br><span class="line">    <span class="comment">// TODO : Implement this function to check if the point (x, y) is inside the triangle represented by _v[0], _v[1], _v[2]</span></span><br><span class="line">    Vector3f P=Vector3f(x,y,_v[<span class="number">0</span>].z());</span><br><span class="line">	<span class="comment">//ä¸‰è¾¹å‘é‡</span></span><br><span class="line">    Vector3f AC=_v[<span class="number">2</span>]-_v[<span class="number">0</span>];</span><br><span class="line">    Vector3f CB=_v[<span class="number">1</span>]-_v[<span class="number">2</span>];</span><br><span class="line">    Vector3f BA=_v[<span class="number">0</span>]-_v[<span class="number">1</span>];</span><br><span class="line">    <span class="comment">//é¡¶ç‚¹ä¸ç›®æ ‡ç‚¹å‘é‡</span></span><br><span class="line">	Vector3f AP=P-_v[<span class="number">0</span>];</span><br><span class="line">    Vector3f BP=P-_v[<span class="number">1</span>];</span><br><span class="line">    Vector3f CP=P-_v[<span class="number">2</span>];</span><br><span class="line">    <span class="comment">//if cross product in the same direction ,its inside the triangle</span></span><br><span class="line">    <span class="keyword">if</span>(AP.cross(AC).dot(BP.cross(BA))&gt;<span class="number">0.0f</span>&amp;&amp;</span><br><span class="line">        BP.cross(BA).dot(CP.cross(CB))&gt;<span class="number">0.0f</span>&amp;&amp;</span><br><span class="line">        CP.cross(CB).dot(AP.cross(AC))&gt;<span class="number">0.0f</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç„¶åæ˜¯å…‰æ …åŒ–çš„å®ç°äº†</strong></p>
<h3 id="rasterize-triangle"><a href="#rasterize-triangle" class="headerlink" title="rasterize_triangle"></a>rasterize_triangle</h3><p><strong>é¦–å…ˆæˆ‘ä»¬è¦æ‰¾åˆ°ä¸‰è§’å½¢çš„ä¸€ä¸ªåŒ…å›´ç›’(Bunding Box)ç„¶åéå†åŒ…å›´ç›’ä¸­çš„ç‚¹ï¼Œå¦‚æœç‚¹åœ¨ä¸‰è§’å½¢å†…éƒ¨ï¼Œä½¿ç”¨é‡å¿ƒå…¬å¼æ’å€¼å¾—åˆ°zå€¼ï¼ˆ<code>è¿™éƒ¨åˆ†æ¡†æ¶ä¸­å·²ç»ç»™å‡ºå®ç°</code>ï¼‰ï¼Œå¹¶ä¸”æ·±åº¦å°äºz-Bufferä¸­çš„ç¼“å­˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç»™è¿™ä¸ªåƒç´ çš„é¢œè‰²é‡ç½®ä¸ºä¸‰è§’å½¢çš„é¢œè‰²ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> rst::rasterizer::rasterize_triangle(<span class="type">const</span> Triangle&amp; t) &#123;</span><br><span class="line">    <span class="keyword">auto</span> v = t.toVector4();</span><br><span class="line">	<span class="comment">//åŒ…å›´ç›’çš„å»ºç«‹</span></span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">float</span>&gt; arr_x&#123;t.v[<span class="number">0</span>].x(),t.v[<span class="number">1</span>].x(),t.v[<span class="number">2</span>].x()&#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="type">float</span>&gt; arr_y&#123;t.v[<span class="number">0</span>].y(),t.v[<span class="number">1</span>].y(),t.v[<span class="number">2</span>].y()&#125;;</span><br><span class="line">    <span class="built_in">std</span>::sort(arr_x.begin(),arr_x.end());</span><br><span class="line">    <span class="built_in">std</span>::sort(arr_y.begin(),arr_y.end());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> x=arr_x[<span class="number">0</span>];x&lt;=arr_x[<span class="number">2</span>];x+=<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> y=arr_y[<span class="number">0</span>];y&lt;arr_y[<span class="number">2</span>];y+=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(insideTriangle(x+<span class="number">0.5f</span>,y+<span class="number">0.5f</span>,t.v))&#123;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//è¿™é‡Œæ˜¯æ¡†æ¶ç»™å‡ºçš„é‡å¿ƒå…¬å¼æ’å€¼ä»£ç </span></span><br><span class="line">                <span class="keyword">auto</span>[alpha, beta, gamma] = computeBarycentric2D(x+<span class="number">0.5f</span>, y+<span class="number">0.5f</span>, t.v);</span><br><span class="line">                <span class="type">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].w() + beta / v[<span class="number">1</span>].w() + gamma / v[<span class="number">2</span>].w());</span><br><span class="line">                <span class="type">float</span> z_interpolated = alpha * v[<span class="number">0</span>].z() / v[<span class="number">0</span>].w() + beta * v[<span class="number">1</span>].z() / v[<span class="number">1</span>].w() + gamma * v[<span class="number">2</span>].z() / v[<span class="number">2</span>].w();</span><br><span class="line">                z_interpolated *= w_reciprocal;</span><br><span class="line">				<span class="comment">//\end é‡å¿ƒå…¬å¼æ’å€¼</span></span><br><span class="line">                </span><br><span class="line">				<span class="comment">//å¦‚æœç›®æ ‡ç‚¹çš„zå€¼ï¼ˆç»å¯¹å€¼ï¼‰å°äºç¼“å­˜æ·±åº¦</span></span><br><span class="line">				<span class="keyword">if</span> (z_interpolated &lt; depth_buf[get_index(x, y)]) &#123;</span><br><span class="line">                    Eigen::Vector3f <span class="title function_">point</span><span class="params">(x, y, <span class="number">1.0f</span>)</span>;</span><br><span class="line">                    set_pixel(point, t.getColor());</span><br><span class="line">					<span class="comment">//é‡ç½®æ·±åº¦ç¼“å­˜é¢œè‰²</span></span><br><span class="line">                    depth_buf[get_index(x, y)] = z_interpolated;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>é‚£ä¹ˆå°±å®Œæˆäº†z-Bufferçš„æ­¥éª¤ï¼Œç¼–è¯‘è¿è¡Œå¾—åˆ°è¿™æ ·çš„ç»“æœ<code>æ³¨æ„é®æŒ¡é¡ºåº</code>ï¼Œå¦‚æœä½ çš„é®æŒ¡é¡ºåºé”™äº†ï¼Œè¯·æ£€æŸ¥ä½ çš„é€è§†æŠ•å½±çŸ©é˜µã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724100452047-67767771_1726324474344.png" alt="image"></p>
<p><strong>æ”¾å¤§å¯ä»¥çœ‹åˆ°å­˜åœ¨æ˜æ˜¾çš„é”¯é½¿ï¼Œä½†æ˜¯æ™®é€šè¦æ±‚ä¹Ÿåˆ°è¿™ç»“æŸäº†ã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724100305872-684142493_1726324474344.png" alt="image"></p>
<h2 id="æé«˜é¢˜"><a href="#æé«˜é¢˜" class="headerlink" title="æé«˜é¢˜"></a>æé«˜é¢˜</h2><p><strong>ä½¿ç”¨Surper-Samplingå¯¹ä¸€ä¸ªåƒç´ è¿›2x2è¶…é‡‡æ ·ã€‚</strong><br><strong>é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªäºŒç»´å‘é‡æ¥å­˜å‚¨æ·±åº¦ç¼“å­˜å’Œé¢œè‰²ç¼“å­˜ã€‚</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//rasterizer.hpp</span></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="type">float</span>,<span class="number">4</span>&gt;&gt; surpersample_corlor_buf;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="type">float</span>,<span class="number">4</span>&gt;&gt; surpersample_depth_buf;</span><br></pre></td></tr></table></figure>

<p><strong>åŒæ—¶ä¿®æ”¹æ„é€ å‡½æ•°å’Œé‡ç½®å‡½æ•°</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> rst::rasterizer::clear(rst::Buffers buff)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ((buff &amp; rst::Buffers::Color) == rst::Buffers::Color)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::fill(frame_buf.begin(), frame_buf.end(), Eigen::Vector3f&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ((buff &amp; rst::Buffers::Depth) == rst::Buffers::Depth)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="type">float</span>,<span class="number">4</span>&gt; inf;</span><br><span class="line">        inf.fill(<span class="built_in">std</span>::numeric_limits&lt;<span class="type">float</span>&gt;::infinity()); </span><br><span class="line">		<span class="comment">//DIY</span></span><br><span class="line">        <span class="built_in">std</span>::fill(depth_buf.begin(), depth_buf.end(), <span class="built_in">std</span>::numeric_limits&lt;<span class="type">float</span>&gt;::infinity());</span><br><span class="line">        <span class="built_in">std</span>::fill(surpersample_depth_buf.begin(), surpersample_depth_buf.end(), inf);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rst::rasterizer::rasterizer(<span class="type">int</span> w, <span class="type">int</span> h) : width(w), height(h)</span><br><span class="line">&#123;</span><br><span class="line">    frame_buf.resize(w * h);</span><br><span class="line">    depth_buf.resize(w * h);</span><br><span class="line">	<span class="comment">//DIY</span></span><br><span class="line">    surpersample_corlor_buf.resize(w * h);</span><br><span class="line">    surpersample_depth_buf.resize(w * h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ¥ç€å°±æ˜¯å…‰æ …åŒ–çš„å®ç°äº†ï¼Œä½¿ç”¨é™„è¿‘å››ä¸ªç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ä½œä¸ºå‚æ•°ï¼Œè®¾ç½®é¢œè‰²çš„å€¼ã€‚è¿™é‡Œå…¶å®æ˜¯ä¸€ç§ä¸é‚£ä¹ˆä¸¥è°¨çš„å·æœºï¼ˆä¸ªäººè§‚ç‚¹ï¼‰ï¼Œå¯ä»¥è®©ä¸‰è§’å½¢å’Œå‘¨å›´äº§ç”Ÿçš„é”¯é½¿æ¶ˆå¤±ã€‚ä¸‹é¢æ˜¯å·æœºç›’çš„è®¾è®¡ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724134506994-1124809421_1726324482509.png" alt="image"><br><strong>ä»£ç å®ç°å¦‚ä¸‹ï¼š</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=minX;i&lt;maxX;i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> j=minY;j&lt;maxY;j++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> Index=get_index(i,j);</span><br><span class="line">        <span class="type">int</span> l=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> IsInTriangleCount=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> IsDontBeCover=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(IsUseSurperSampling)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//SurperSampling</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span>&amp;k : SampleOffset)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">float</span> SampleX=i+k.x();</span><br><span class="line">                <span class="type">float</span> SampleY=j+k.y();</span><br><span class="line">                <span class="keyword">if</span>(insideTriangle(SampleX,SampleY,t.v))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">auto</span>[alpha, beta, gamma] = computeBarycentric2D(SampleX, SampleY, t.v);</span><br><span class="line">                    <span class="type">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].w() + beta / v[<span class="number">1</span>].w() + gamma / v[<span class="number">2</span>].w());</span><br><span class="line">                    <span class="type">float</span> z_interpolated = alpha * v[<span class="number">0</span>].z() / v[<span class="number">0</span>].w() + beta * v[<span class="number">1</span>].z() / v[<span class="number">1</span>].w() + gamma * v[<span class="number">2</span>].z() / v[<span class="number">2</span>].w();</span><br><span class="line">                    z_interpolated *= w_reciprocal;</span><br><span class="line">                    <span class="comment">// check zbuff</span></span><br><span class="line">                    <span class="keyword">if</span>(z_interpolated &lt; surpersample_depth_buf[Index][l])</span><br><span class="line">                    &#123;</span><br><span class="line">                        surpersample_depth_buf[Index][l]=z_interpolated;</span><br><span class="line">                        IsDontBeCover++;</span><br><span class="line">                    &#125;</span><br><span class="line">                    IsInTriangleCount++;</span><br><span class="line">                &#125;</span><br><span class="line">                l=l+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Vector3f color= t.getColor()*IsInTriangleCount/<span class="number">4.0f</span>;</span><br><span class="line">            <span class="keyword">if</span>(IsDontBeCover&gt;<span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                set_pixel(Vector3f(i,j,<span class="number">0</span>),color);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(insideTriangle(i+<span class="number">0.5f</span>,j+<span class="number">0.5f</span>,t.v))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">auto</span>[alpha, beta, gamma] = computeBarycentric2D(i+<span class="number">0.5f</span>, j+<span class="number">0.5f</span>, t.v);</span><br><span class="line">                <span class="type">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].w() + beta / v[<span class="number">1</span>].w() + gamma / v[<span class="number">2</span>].w());</span><br><span class="line">                <span class="type">float</span> z_interpolated = alpha * v[<span class="number">0</span>].z() / v[<span class="number">0</span>].w() + beta * v[<span class="number">1</span>].z() / v[<span class="number">1</span>].w() + gamma * v[<span class="number">2</span>].z() / v[<span class="number">2</span>].w();</span><br><span class="line">                z_interpolated *= w_reciprocal;</span><br><span class="line">                <span class="comment">// check zbuff</span></span><br><span class="line">                <span class="keyword">if</span>(z_interpolated&lt;depth_buf[Index])</span><br><span class="line">                &#123;</span><br><span class="line">                    depth_buf[Index]=z_interpolated;</span><br><span class="line">                    set_pixel(Vector3f(i,j,<span class="number">1</span>),t.getColor());</span><br><span class="line">	&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æœ€åçš„è¾“å‡ºå›¾ç‰‡å¦‚ä¸‹ï¼Œæ¯”èµ·è¶…é‡‡æ ·ä¹‹å‰çš„ä¸‰è§’å½¢ï¼Œé”¯é½¿æ˜æ˜¾å°‘äº†ã€‚</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724094635920-1848349468_1726324482509.png" alt="image"><br><strong>æ”¾å¤§åå¯ä»¥çœ‹åˆ°æ˜æ˜¾çš„æŸ”åŒ–ï¼š</strong><br><img src="https://raw.githubusercontent.com/zhywyt/cnblogs_pic/master/img/3080748-20230724134932773-543075237_1726324482509.png" alt="image"></p>
<h2 id="ä¸‹-ä¸Šä¸€ç¯‡"><a href="#ä¸‹-ä¸Šä¸€ç¯‡" class="headerlink" title="ä¸‹&#x2F;ä¸Šä¸€ç¯‡"></a>ä¸‹&#x2F;ä¸Šä¸€ç¯‡</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17577186.html">ä¸‹ä¸€ç¯‡ï¼šobjå¯¼å…¥ä¸phong</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17575190.html">ä¸Šä¸€ç¯‡ï¼šé€è§†æŠ•å½±çŸ©é˜µ</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-CG/gamesç³»åˆ—è¯¾ç¨‹/games101/games101 HomeWork ä½œä¸šä»¥åŠæé«˜è¯¾è¯¦è§£" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/Yelee/posts/44638/" class="article-date">
      <time datetime="2023-07-24T08:54:00.000Z" itemprop="datePublished">2023-07-24</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/Yelee/posts/44638/">games101 HomeWork ä½œä¸šä»¥åŠæé«˜è¯¾è¯¦è§£</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <span id="more"></span>

<h1 id="å¯¼èˆª"><a href="#å¯¼èˆª" class="headerlink" title="å¯¼èˆª"></a>å¯¼èˆª</h1><p><a target="_blank" rel="noopener" href="https://github.com/zhywyt/games101HomeWork/blob/master/GAMES101_Homework_S2021.zip">ä½œä¸šæ¡†æ¶ä¸‹è½½</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17575190.html">HW1 - &gt;é€è§†æŠ•å½±çŸ©é˜µ</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17576366.html">HW2 - &gt;å›¾å½¢å¡«å……</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17577186.html">HW3 - &gt;objå¯¼å…¥ä¸phong</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589119.html">HW4 - &gt;Bezieræ›²çº¿çš„ç»˜åˆ¶</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17589717.html">HW5 - &gt;Ray tracingå…‰çº¿è¿½è¸ª</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17591015.html">HW6 - &gt;Ray tracingå…‰çº¿è¿½è¸ªåŠ é€Ÿ</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhywyt/p/17597301.html">HW7 - &gt;Path Tracing &amp; Microfacet æè´¨</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/Yelee/categories/CG/">CG</a><a class="article-category-link" href="/Yelee/categories/CG/games101/">games101</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/Yelee/page/6/">&laquo; Prev</a><a class="page-number" href="/Yelee/">1</a><span class="space">&hellip;</span><a class="page-number" href="/Yelee/page/5/">5</a><a class="page-number" href="/Yelee/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/Yelee/page/8/">8</a><a class="page-number" href="/Yelee/page/9/">9</a><a class="extend next" rel="next" href="/Yelee/page/8/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2025 zhywyt
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="å¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="ç®€è€Œä¸å‡ Hexo åŒæ åšå®¢ä¸»é¢˜  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="æœ¬ç«™åˆ°è®¿æ•°"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="æœ¬é¡µé˜…è¯»é‡"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/Yelee/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="è¿”å›é¡¶éƒ¨"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="æŸ¥çœ‹è¯„è®º"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="è½¬åˆ°åº•éƒ¨"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>